/*!
 * Form Functionality Library v1.1.0
 * Browser-compatible bundle
 */
!function(e){"use strict";const t='[data-form="multistep"]',i="[data-logic]",n='[data-form="step"]',s="[data-answer]",a='[data-form="next-btn"]',r='[data-form="back-btn"]',o='[data-form="submit"]',l="[data-skip]",d="[data-go-to]",c="[data-step-field-name]",u="[data-summary-field]",p={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},m="active-step",f="error-field",h="error-message",g="disabled";function y(e,t){if(!p.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${p.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function b(e,t=document){return t.querySelectorAll(e)}function v(e,t=document){return t.querySelector(e)}function S(e,t){return e.getAttribute(t)}function $(e,t){e.classList.add(t)}function E(e,t){e.classList.remove(t)}function I(e){return"none"!==e.style.display&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function A(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function F(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function C(e,t,i,n){const s=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,s),()=>{e.removeEventListener(t,s)}}class x{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},y("FormState initialized")}static getInstance(){return x.instance||(x.instance=new x),x.instance}setField(e,t){const i=this.data[e];this.data[e]=t,y(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},y("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&y("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),y(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),y(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),y(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e){this.branchPath.skippedSteps.includes(e)||(this.branchPath.skippedSteps.push(e),y(`Step skipped: ${e}`,this.branchPath.skippedSteps))}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,y(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(e,t,i){const n={};return Object.entries(this.data).forEach(([e,t])=>{n[e]=t}),n}onFieldChange(e,t,i){t!==i&&y(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,y(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}const L=x.getInstance();let w=!1,z=[];function V(e=document){w&&(y("Branching already branchingInitialized, cleaning up first"),D()),y("Initializing branching logic");y(`Found ${b(d,e).length} branch triggers`);y(`Found ${b(s,e).length} conditional steps`),function(e){const t=C(e,"change",d,k),i=C(e,"input",d,k),n=C(e,"click",d,k);z.push(t,i,n)}(e),w=!0,y("Branching initialization complete")}function k(e,t){if(!A(t))return;const i=S(t,"data-go-to"),n=F(t);y("Branch trigger activated",{element:t,goTo:i,value:n,type:t.type||t.tagName});const s=t.name||S(t,"data-step-field-name");var a;s&&L.setField(s,n),t instanceof HTMLInputElement?"radio"===t.type&&t.checked?(!function(e){if(!e.name)return;y(`Handling radio group selection for: ${e.name}`,{selectedValue:e.value,selectedGoTo:S(e,"data-go-to")});document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(t=>{const i=t,n=S(i,"data-go-to");i!==e&&n&&(y(`Deactivating radio option: ${n}`),N(n),n&&T(n))})}(t),P(i,t.value),i&&(y(`Triggering step_item visibility: ${a=i}`),import("./multiStep.js").then(({showStepItem:e})=>{e(a)}).catch(e=>{console.warn("[FormLib] Failed to show step_item:",e)}))):"checkbox"===t.type?t.checked?P(i,t.value):N(i):"radio"!==t.type&&"checkbox"!==t.type&&(n?P(i,n):N(i)):n?P(i,n):N(i);const r=L.getBranchPath().activeConditions;Object.values(r).some(e=>null!=e&&""!==e)&&q()}function T(e){y(`Hiding step_item: ${e}`),import("./multiStep.js").then(({hideStepItem:t})=>{t&&t(e)}).catch(t=>{y(`Manual step_item hiding for: ${e}`);document.querySelectorAll(`[data-answer="${e}"]`).forEach(e=>{const t=e;t.style.display="none",t.style.visibility="hidden",t.classList.add("hidden-step")})})}function P(e,t){e&&(y(`Activating branch: ${e}`,{value:t,valueType:typeof t,targetString:String(e)}),L.setActiveCondition(e,t),function(){const e=b(n),t=[],i=[];e.forEach(e=>{const n=S(e,"data-answer"),s=!n||L.isStepVisible(n);e.querySelectorAll("input, select, textarea").forEach(e=>{const n=e.name||S(e,"data-step-field-name");n&&(s?t.push(n):i.push(n))})});const s=i.filter(e=>!t.includes(e));s.length>0&&L.clearFields(s)}(),y("Active conditions after branch activation",{activeConditions:L.getBranchPath().activeConditions}))}function N(e){e&&(y(`Deactivating branch: ${e}`),L.setActiveCondition(e,null),function(e){const t=v(`[data-answer="${e}"]`);if(!t)return;const i=t.querySelectorAll("input, select, textarea"),n=[];i.forEach(e=>{const t=e.name||S(e,"data-step-field-name");t&&n.push(t)}),n.length>0&&(L.clearFields(n),y(`Cleared fields from branch ${e}`,n))}(e),q())}function q(){const e=b(s),t=L.getBranchPath().activeConditions;y("Updating step visibility",{activeConditions:t}),e.forEach(e=>{const i=S(e,"data-answer"),n=function(e,t){if(!e)return!0;for(const[i,n]of Object.entries(t))if(i===e&&null!=n&&""!==n)return!0;return!1}(i,t);i&&L.setStepInfo(i,{visible:n});const s=e;n?(s.style.display="",s.classList.remove("hidden-step"),y(`Step made visible: ${i}`)):(s.style.display="none",s.classList.add("hidden-step"),y(`Step hidden: ${i}`))})}function D(){y("Resetting branching logic"),z.forEach(e=>e()),z=[];const e=L.getBranchPath().activeConditions;Object.keys(e).forEach(e=>{L.setActiveCondition(e,null)});b(s).forEach(e=>{const t=e;t.style.display="none",t.classList.add("hidden-step")}),w=!1,y("Branching reset complete")}e.debugBranching=function(){const e=L.getBranchPath().activeConditions;y("=== DEBUG: Branching State ==="),y("Active Conditions:",e);const t=b(d);y("All Branch Triggers:"),t.forEach((e,t)=>{const i=S(e,"data-go-to");let n="",s=!1,a=e.tagName;if(A(e)){const t=F(e);n=Array.isArray(t)?t.join(", "):t,e instanceof HTMLInputElement&&(s=e.checked,a=e.type)}y(`Trigger ${t}:`,{element:e,goTo:i,value:n,checked:s,type:a})});const i=b(s);y("All Answer Steps:"),i.forEach((e,t)=>{y(`Answer Step ${t}:`,{element:e,dataAnswer:S(e,"data-answer"),visible:"none"!==e.style.display})}),y("=== END DEBUG ===")};let B=!1,_=[],M=[],O=[],j=0,R=null;function H(e=document){B&&(y("MultiStep already multiStepInitialized, cleaning up first"),y("Resetting multi-step navigation"),_.forEach(e=>e()),_=[],M.forEach((e,t)=>{Z(t)}),M=[],j=0,B=!1,y("Multi-step reset complete")),y("Initializing multi-step navigation with step/step_item architecture");const t=b(n,e);y(`Found ${t.length} parent steps`),M=Array.from(t).map((e,t)=>{const i=e,n=S(e,"data-answer"),s=n||`step-${t}`,a={element:i,id:s,index:t,type:S(e,"data-step-type")||void 0,subtype:S(e,"data-step-subtype")||void 0,number:S(e,"data-step-number")||void 0,isStepItem:!1};return y(`Registering parent step ${t}`,{stepId:s,dataAnswer:n,type:a.type,element:i}),L.setStepInfo(s,{type:a.type,subtype:a.subtype,number:a.number,visible:0===t,visited:!1}),a}),O=[],M.forEach((e,t)=>{const i=e.element.querySelectorAll(".step_item");y(`Found ${i.length} step_items in parent step ${t}`),i.forEach((e,i)=>{const n=e,s=S(e,"data-answer");if(!s)return void console.warn(`[FormLib] Step item ${i} in parent step ${t} missing required data-answer attribute`);const a={element:n,id:s,index:O.length,type:S(e,"data-step-type")||void 0,subtype:S(e,"data-step-subtype")||void 0,number:S(e,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:t};y("Registering step_item",{stepId:s,parentStepIndex:t,globalIndex:O.length,type:a.type,element:n}),L.setStepInfo(s,{type:a.type,subtype:a.subtype,number:a.number,visible:!1,visited:!1}),O.push(a)})}),M.forEach((e,t)=>{U(e.element,`parent step ${t}`)}),O.forEach((e,t)=>{U(e.element,`step_item ${t} (${e.id})`)}),function(e){const t=C(e,"click",a,J),i=C(e,"click",r,W),n=C(e,"click",l,X),s=C(e,"click",o,Y);_.push(t,i,n,s)}(e),M.length>0&&Q(0),B=!0,y("Multi-step initialization complete",{parentStepCount:M.length,stepItemCount:O.length})}function U(e,t){e.style.display="none",e.style.visibility="hidden",$(e,"hidden-step"),E(e,m),e.setAttribute("data-step-hidden","true"),y(`Forcibly hiding ${t}:`,{display:e.style.display,visibility:e.style.visibility,classes:e.className})}function G(e){y(`Attempting to show step_item: ${e}`);const t=O.find(t=>t.id===e);if(!t)return void console.warn(`[FormLib] Step item not found: ${e}`);if(!M[t.parentStepIndex])return void console.warn(`[FormLib] Parent step not found for step_item: ${e}`);y(`Showing step_item ${e} in parent step ${t.parentStepIndex}`);var i,n;O.filter(e=>e.parentStepIndex===t.parentStepIndex).forEach(e=>{U(e.element,`step_item ${e.id}`),L.setStepVisibility(e.id,!1)}),i=t.element,n=`step_item ${e}`,i.style.display="",i.style.visibility="",E(i,"hidden-step"),$(i,m),i.removeAttribute("data-step-hidden"),y(`Showing ${n}:`,{display:i.style.display,visibility:i.style.visibility,classes:i.className}),L.setStepVisibility(e,!0),R=e,y(`Successfully showed step_item: ${e}`)}function T(e){y(`Attempting to hide step_item: ${e}`);const t=O.find(t=>t.id===e);t?(y(`Hiding step_item: ${e}`),U(t.element,`step_item ${e}`),L.setStepVisibility(e,!1),R===e&&(R=null),y(`Successfully hid step_item: ${e}`)):y(`Step item not found for hiding: ${e}`)}function J(e,t){e.preventDefault(),y("Next button clicked");const i=te();if(!i)return;if(R){const e=O.find(e=>e.id===R);if(e&&!K(e.element))return void y("Step item validation failed, staying on current step")}else if(!K(i.element))return void y("Step validation failed, staying on current step");let n=null;if(R){const e=O.find(e=>e.id===R);e&&(n=S(e.element,"data-go-to"),y(`Step item ${R} has data-go-to: ${n}`))}n||(n=function(e){const t=L.getBranchPath().activeConditions;y("Evaluating next step",{currentStep:e,activeConditions:t});for(const[e,i]of Object.entries(t))if(null!=i&&""!==i)return y(`Next step determined by branch: ${e}`),e;return y("No active branch conditions, using sequential navigation"),null}(i.id),y(`Branching logic determined next step: ${n}`)),n?function(e){y(`Attempting to navigate to step: ${e}`);const t=ee(e);if(-1!==t)return y(`Found parent step: ${e} at index ${t}`),R=null,void Q(t);const i=O.find(t=>t.id===e);if(i)return y(`Found step_item: ${e} in parent step ${i.parentStepIndex}`),void(void 0!==i.parentStepIndex&&(Q(i.parentStepIndex),G(e)));console.warn(`[FormLib] Step not found: ${e}`),y("Step not found",{targetStepId:e,availableParentSteps:M.map(e=>e.id),availableStepItems:O.map(e=>e.id)})}(n):function(){const e=j+1;e<M.length?Q(e):y("Already at last step")}()}function W(e,t){e.preventDefault(),y("Back button clicked"),function(){const e=L.goToPreviousStep();if(e){const t=ee(e);if(-1!==t)return void Q(t)}const t=j-1;t>=0?Q(t):y("Already at first step")}()}function X(e,t){e.preventDefault();const i=S(t,"data-skip");if(y("Skip button clicked",{skipTarget:i}),i){const e=ee(i);if(-1!==e){for(let t=j+1;t<e;t++)L.addSkippedStep(M[t].id);Q(e)}else y(`Skip target step not found: ${i}`)}}function Y(e,t){y("Submit button clicked");if(!function(){let e=!0;return M.forEach((t,i)=>{if(L.isStepVisible(t.id)){const i=t.element.querySelectorAll("[required]");for(const n of i){const i=n;i.value.trim()||(y(`Required field empty in step ${t.id}: ${i.name||"unnamed"}`),e=!1)}}}),e}())return e.preventDefault(),void y("Form validation failed, preventing submission");y("Form validation passed, allowing submission")}function K(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(I(t)){if(!t.value||""===t.value.trim())return y("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return y("Validation failed: invalid email format",{element:t,value:t.value}),t.focus(),!1}}}return!0}function Q(e){if(e<0||e>=M.length)return void y(`Invalid step index: ${e}`);const t=j,i=M[e];y(`Navigating to step ${e}`,{from:t,to:e,stepId:i.id}),M[j]&&Z(j),j=e,function(e){if(e<0||e>=M.length)return;const t=M[e],i=t.element;i.style.display="",i.style.visibility="",E(i,"hidden-step"),$(i,m),i.removeAttribute("data-step-hidden"),L.setStepInfo(t.id,{visible:!0,visited:!0}),y(`Step shown: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}(e),L.setCurrentStep(i.id),function(){const e=b(r),t=b(a),i=b(o);e.forEach(e=>{const t=e;0===j?(t.disabled=!0,$(e,g)):(t.disabled=!1,E(e,g))});const n=j===M.length-1;t.forEach(e=>{const t=e;n?t.style.display="none":(t.style.display="",t.disabled=!1,E(e,g))}),i.forEach(e=>{const t=e;n?(t.style.display="",t.disabled=!1,E(e,g)):t.style.display="none"}),y("Navigation buttons updated",{currentStepIndex:j,isLastStep:n,backButtonsCount:e.length,nextButtonsCount:t.length,submitButtonsCount:i.length})}(),y("Step navigation complete",{currentStep:i.id,currentIndex:e})}function Z(e){if(e<0||e>=M.length)return;const t=M[e],i=t.element;i.style.display="none",i.style.visibility="hidden",$(i,"hidden-step"),E(i,m),i.setAttribute("data-step-hidden","true"),L.setStepInfo(t.id,{visible:!1}),y(`Step hidden: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}function ee(e){return M.findIndex(t=>t.id===e)}function te(){return M[j]||null}e.debugFormSteps=function(){y("=== DEBUG: All Registered Steps ==="),M.forEach((e,t)=>{const i=e.element;y(`Step ${t}:`,{stepId:e.id,dataAnswer:i.getAttribute("data-answer"),elementId:i.getAttribute("id"),index:e.index,visible:"none"!==i.style.display,classes:i.className,element:i})}),y("=== END DEBUG ===")};let ie=!1,ne=[],se=new Map;function ae(e=document){ie&&(y("Validation already validationInitialized, cleaning up first"),y("Resetting validation"),ne.forEach(e=>e()),ne=[],y("Clearing all field validation"),se.forEach((e,t)=>{!function(e){const t=se.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,de(t.element,!0),y(`Cleared validation for field: ${e}`))}(t)}),se.clear(),ie=!1,y("Validation reset complete")),y("Initializing form validation");const t=b("input, select, textarea",e);y(`Found ${t.length} form inputs`),t.forEach(e=>{if(!A(e))return;const t=e.name||S(e,"data-step-field-name");if(!t)return;const i=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:S(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=S(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=S(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const s=S(e,"pattern");return s&&t.push({type:"pattern",value:new RegExp(s),message:"Please enter a valid format"}),t}(e);0!==i.length&&(se.set(t,{element:e,rules:i,isValid:!0}),y(`Validation rules set for field: ${t}`,i))}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}(re,p.VALIDATION_DELAY),i=C(e,"input","input, select, textarea",t),n=C(e,"blur","input, select, textarea",re),s=C(e,"change","input, select, textarea",re);ne.push(i,n,s)}(e),ie=!0,y("Validation initialization complete")}function re(e,t){if(!A(t))return;const i=t.name||S(t,"data-step-field-name");if(!i)return;const s=t.closest(n);if(s){const e=S(s,"data-answer");if(e&&!L.isStepVisible(e))return void y(`Skipping validation for field in hidden step: ${i}`)}oe(i)}function oe(e){const t=se.get(e);if(!t)return y(`No validation rules found for field: ${e}`),!0;const i=t.element,n=F(i);y(`Validating field: ${e}`,{value:n});let s=!0,a="";for(const e of t.rules){const t=le(n,e);if(!t.isValid){s=!1,a=t.message||"Validation failed";break}}return t.isValid=s,t.errorMessage=a,de(i,s,a),L.setField(e,n),y(`Field validation result: ${e}`,{isValid:s,errorMessage:a,value:n}),s}function le(e,t){switch(t.type){case"required":return{isValid:!(""===e||null==e||Array.isArray(e)&&0===e.length),message:t.message};case"email":return{isValid:!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e)),message:t.message};case"phone":return{isValid:!e||/^[\+]?[1-9][\d]{0,15}$/.test(String(e).replace(/\D/g,"")),message:t.message};case"min":return{isValid:!e||String(e).length>=t.value,message:t.message};case"max":return{isValid:!e||String(e).length<=t.value,message:t.message};case"pattern":return{isValid:!e||t.value.test(String(e)),message:t.message};case"custom":return{isValid:!t.validator||t.validator(e),message:t.message};default:return{isValid:!0}}}function de(e,t,i){t?E(e,f):$(e,f);const n=ce(e);n&&(t?(n.textContent="",n.style.display="none"):(n.textContent=i||"Validation failed",n.style.display="block"))}function ce(e){const t=e.name||S(e,"data-step-field-name");if(!t)return null;let i=e.parentElement?.querySelector(`.${h}[data-field="${t}"]`);return i||(i=document.createElement("div"),i.className=h,i.setAttribute("data-field",t),i.style.color="red",i.style.fontSize="0.875em",i.style.marginTop="0.25rem",i.style.display="none",e.parentElement?.insertBefore(i,e.nextSibling)),i}function ue(){const e={validationInitialized:ie,totalFields:se.size,validFields:0,invalidFields:0,fields:{}};return se.forEach((t,i)=>{e.fields[i]={isValid:t.isValid,errorMessage:t.errorMessage,rulesCount:t.rules.length},t.isValid?e.validFields++:e.invalidFields++}),e}let pe=new Map;function me(){y("Clearing all field errors"),pe.forEach((e,t)=>{!function(e){const t=pe.get(e);t?(y(`Clearing error for field: ${e}`),E(t.element,f),t.errorElement&&(t.errorElement.textContent="",t.errorElement.style.display="none")):y(`Cannot clear error for unknown field: ${e}`)}(t)})}function fe(){const e=[];return pe.forEach((t,i)=>{(function(e){const t=pe.get(e);return!!t&&t.element.classList.contains(f)})(i)&&e.push(i)}),e}function ce(e){let t=e.element.parentElement?.querySelector(`.${h}[data-field="${e.fieldName}"]`);if(!t){t=document.createElement("div"),t.className=h,t.setAttribute("data-field",e.fieldName),t.style.color="red",t.style.fontSize="0.875em",t.style.marginTop="0.25rem",t.style.display="none";const i=e.element.parentElement;if(!i)return y(`Cannot create error element for field: ${e.fieldName} - no parent element`),null;{const n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t)}y(`Created error element for field: ${e.fieldName}`)}return t}function he(){const e=fe(),t={totalFields:pe.size,fieldsWithErrors:e.length,errors:{}};return e.forEach(e=>{const i=pe.get(e);t.errors[e]={message:i?.errorElement?.textContent||"Unknown error",customMessage:i?.customMessage}}),t}let ge=!1,ye=[],be=[];function ve(e=document){ge&&(y("Summary already summaryInitialized, cleaning up first"),y("Resetting summary functionality"),ye.forEach(e=>e()),ye=[],be.forEach(e=>{Ae(e.element,"")}),be=[],ge=!1,y("Summary reset complete")),y("Initializing summary functionality");const t=b(u,e);y(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=S(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=S(e,"data-join"),s=n&&n in p.JOIN_SEPARATOR?n:"space",a=S(e,"data-summary-type")||void 0,r=S(e,"data-summary-subtype")||void 0,o=S(e,"data-summary-number")||void 0,l={element:e,fieldNames:i,joinType:s,type:a,subtype:r,number:o};be.push(l),y("Summary field configured",{fieldNames:i,joinType:s,type:a,subtype:r,number:o})})}(t),function(e){const t=C(e,"input",c,Se),i=C(e,"change",c,Se),n=C(e,"blur",c,Se);ye.push(t,i,n)}(e),Ee(),ge=!0,y("Summary initialization complete")}function Se(e,t){if(!A(t))return;const i=S(t,"data-step-field-name");if(!i)return;const n=F(t);y(`Summary field changed: ${i}`,{value:n}),L.setField(i,n),$e(i)}function $e(e){be.forEach(t=>{t.fieldNames.includes(e)&&Ie(t)})}function Ee(){be.forEach(e=>{Ie(e)})}function Ie(e){const t=[];e.fieldNames.forEach(e=>{const i=L.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=p.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);Ae(e.element,i),y("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function Ae(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}class Fe{constructor(){this.initialized=!1,this.rootElement=document,y("FormLibrary instance created")}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}init(e=document){this.initialized&&(y("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,y("Initializing FormLibrary",{root:e===document?"document":"custom element"});const s=e.querySelectorAll(t),a=e.querySelectorAll(i),r=e.querySelectorAll(n);if(y("Form detection results",{multistepForms:s.length,logicForms:a.length,stepElements:r.length}),0!==s.length||0!==r.length)try{!function(e=document){y("Initializing error handling"),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||S(e,"data-step-field-name");t&&pe.set(t,{fieldName:t,element:e,customMessage:S(e,"data-error-message")||void 0})}),y(`Error handling errorsInitialized for ${pe.size} fields`)}(e),ae(e),a.length>0&&V(e),(s.length>0||r.length>0)&&H(e),ve(e),this.initialized=!0,y("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw y("FormLibrary initialization failed",e),e}else y("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){y("Destroying FormLibrary");try{D()}catch(e){y("Error during FormLibrary destruction",e)}L.clear(),this.initialized=!1,y("FormLibrary destruction complete")}else y("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:L.getDebugInfo(),branching:{branchingInitialized:w,activeConditions:L.getBranchPath().activeConditions,visibleSteps:Object.entries(L.getAllSteps()).filter(([e,t])=>t.visible).map(([e,t])=>e)},multiStep:{multiStepInitialized:B,currentStepIndex:j,totalSteps:M.length,steps:M.map(e=>({id:e.id,index:e.index,visible:I(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:ue(),errors:he(),summary:{summaryInitialized:ge,totalSummaryFields:be.length,summaryFields:be.map(e=>({fieldNames:e.fieldNames,joinType:e.joinType,type:e.type,subtype:e.subtype,number:e.number,currentValue:e.element.textContent||""})),formStateData:L.getAll()}}}logCurrentState(){y("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return y("Cannot validate form - library not initialized"),!1;y("Validating entire form");const e=function(){y("Validating all visible fields");let e=!0;const t={};for(const[i,s]of se){const a=s.element.closest(n);let r=!0;if(a){const e=S(a,"data-answer");e&&!L.isStepVisible(e)&&(r=!1)}if(r){const n=oe(i);t[i]=n,n||(e=!1)}}return y("All visible fields validation complete",{allValid:e,results:t}),e}();return y("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){var e;y("Resetting form to initial state"),me(),L.clear(),e?(y("Clearing specific summary fields",e),L.clearFields(e),e.forEach(e=>{$e(e)})):(y("Clearing all summaries"),L.clear(),Ee());try{Q(0)}catch(e){y("Could not go to first step during reset",e)}y("Form reset complete")}else y("Cannot reset form - library not initialized")}getFormData(){return L.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{L.setField(e,t)}),y("Updating all summaries"),Ee(),y("Form data set",e)}}const Ce=Fe.getInstance();if(void 0!==e){const e=()=>{const e=document.querySelectorAll(t),i=document.querySelectorAll(n);(e.length>0||i.length>0)&&(y("Auto-initializing FormLibrary on DOM ready"),Ce.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}void 0!==e&&(e.FormLib=Ce,y("FormLib attached to window for debugging")),void 0!==e&&(e.FormLibrary=Fe,e.FormLib=Ce)}("undefined"!=typeof window?window:this);