/*!
 * Form Functionality Library v1.1.0
 * Browser-compatible bundle
 */
!function(e){"use strict";const t='[data-form="multistep"]',i="[data-logic]",n='[data-form="step"]',a="[data-answer]",s='[data-form="next-btn"]',r='[data-form="back-btn"]',o='[data-form="submit"]',l="[data-skip]",d="[data-go-to]",c="[data-step-field-name]",u="[data-summary-field]",p={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},m="active-step",f="error-field",h="error-message",g="disabled";function y(e,t){if(!p.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${p.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function b(e,t=document){return t.querySelectorAll(e)}function v(e,t=document){return t.querySelector(e)}function S(e,t){return e.getAttribute(t)}function $(e,t){e.classList.add(t)}function F(e,t){e.classList.remove(t)}function A(e){return"none"!==e.style.display&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function E(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function I(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function L(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}class w{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},y("FormState initialized")}static getInstance(){return w.instance||(w.instance=new w),w.instance}setField(e,t){const i=this.data[e];this.data[e]=t,y(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},y("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&y("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),y(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),y(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),y(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e){this.branchPath.skippedSteps.includes(e)||(this.branchPath.skippedSteps.push(e),y(`Step skipped: ${e}`,this.branchPath.skippedSteps))}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,y(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(e,t,i){const n={};return Object.entries(this.data).forEach(([e,t])=>{n[e]=t}),n}onFieldChange(e,t,i){t!==i&&y(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,y(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}const C=w.getInstance();let x=!1,k=[];function T(e=document){x&&(y("Branching already branchingInitialized, cleaning up first"),B()),y("Initializing branching logic");y(`Found ${b(d,e).length} branch triggers`);y(`Found ${b(a,e).length} conditional steps`),function(e){const t=L(e,"change",d,z),i=L(e,"input",d,z),n=L(e,"click",d,z),a=L(e,"click","label.radio_field, label.w-radio",N);k.push(t,i,n,a)}(e),x=!0,y("Branching initialization complete")}function N(e,t){console.log("[FormLib] Radio label clicked",{target:t,tagName:t.tagName,className:t.className});const i=t.querySelector('input[type="radio"][data-go-to]');if(!i){console.log("[FormLib] No radio input with data-go-to found in clicked label");const e=t.querySelector('input[type="radio"]');return void(e&&console.log("[FormLib] Found radio input without data-go-to",{radioInput:e,goTo:S(e,"data-go-to"),name:e.name,value:e.value,allAttributes:Array.from(e.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}))}const n=S(i,"data-go-to");console.log("[FormLib] Found radio input in label",{radioInput:i,goTo:n,name:i.name,value:i.value,allAttributes:Array.from(i.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}),i.checked=!0;const a=new Event("change",{bubbles:!0});Object.defineProperty(a,"target",{value:i}),console.log("[FormLib] Triggering branch logic for data-go-to:",n),z(a,i)}function z(e,t){if(console.log("[FormLib] handleBranchTrigger called",{target:t,tagName:t.tagName,type:t.type,isFormInput:E(t)}),!E(t))return void console.log("[FormLib] Target is not a form input, ignoring");const i=S(t,"data-go-to"),n=I(t);console.log("[FormLib] Branch trigger activated",{element:t,goTo:i,value:n,type:t.type||t.tagName,checked:t.checked,name:t.name,allAttributes:Array.from(t.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")});const a=t.name||S(t,"data-step-field-name");var s;a&&C.setField(a,n),t instanceof HTMLInputElement?"radio"===t.type&&t.checked?(!function(e){if(!e.name)return;y(`Handling radio group selection for: ${e.name}`,{selectedValue:e.value,selectedGoTo:S(e,"data-go-to")});document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(t=>{const i=t,n=S(i,"data-go-to");i!==e&&n&&(y(`Deactivating radio option: ${n}`),_(n),n&&V(n))})}(t),P(i,t.value),i&&(y(`Triggering step_item visibility: ${s=i}`),import("./multiStep.js").then(({showStepItem:e})=>{e(s)}).catch(e=>{console.warn("[FormLib] Failed to show step_item:",e)}))):"checkbox"===t.type?t.checked?P(i,t.value):_(i):"radio"!==t.type&&"checkbox"!==t.type&&(n?P(i,n):_(i)):n?P(i,n):_(i);const r=C.getBranchPath().activeConditions;Object.values(r).some(e=>null!=e&&""!==e)&&q()}function V(e){y(`Hiding step_item: ${e}`),import("./multiStep.js").then(({hideStepItem:t})=>{t&&t(e)}).catch(t=>{y(`Manual step_item hiding for: ${e}`);document.querySelectorAll(`[data-answer="${e}"]`).forEach(e=>{const t=e;t.style.display="none",t.style.visibility="hidden",t.classList.add("hidden-step")})})}function P(e,t){e&&(y(`Activating branch: ${e}`,{value:t,valueType:typeof t,targetString:String(e)}),C.setActiveCondition(e,t),function(){const e=b(n),t=[],i=[];e.forEach(e=>{const n=S(e,"data-answer"),a=!n||C.isStepVisible(n);e.querySelectorAll("input, select, textarea").forEach(e=>{const n=e.name||S(e,"data-step-field-name");n&&(a?t.push(n):i.push(n))})});const a=i.filter(e=>!t.includes(e));a.length>0&&C.clearFields(a)}(),y("Active conditions after branch activation",{activeConditions:C.getBranchPath().activeConditions}))}function _(e){e&&(y(`Deactivating branch: ${e}`),C.setActiveCondition(e,null),function(e){const t=v(`[data-answer="${e}"]`);if(!t)return;const i=t.querySelectorAll("input, select, textarea"),n=[];i.forEach(e=>{const t=e.name||S(e,"data-step-field-name");t&&n.push(t)}),n.length>0&&(C.clearFields(n),y(`Cleared fields from branch ${e}`,n))}(e),q())}function q(){const e=b(a),t=C.getBranchPath().activeConditions;y("Updating step visibility",{activeConditions:t}),e.forEach(e=>{const i=S(e,"data-answer"),n=function(e,t){if(!e)return!0;for(const[i,n]of Object.entries(t))if(i===e&&null!=n&&""!==n)return!0;return!1}(i,t);i&&C.setStepInfo(i,{visible:n});const a=e;n?(a.style.display="",a.classList.remove("hidden-step"),y(`Step made visible: ${i}`)):(a.style.display="none",a.classList.add("hidden-step"),y(`Step hidden: ${i}`))})}function B(){y("Resetting branching logic"),k.forEach(e=>e()),k=[];const e=C.getBranchPath().activeConditions;Object.keys(e).forEach(e=>{C.setActiveCondition(e,null)});b(a).forEach(e=>{const t=e;t.style.display="none",t.classList.add("hidden-step")}),x=!1,y("Branching reset complete")}e.debugBranching=function(){const e=C.getBranchPath().activeConditions;y("=== DEBUG: Branching State ==="),y("Active Conditions:",e);const t=b(d);y("All Branch Triggers:"),t.forEach((e,t)=>{const i=S(e,"data-go-to");let n="",a=!1,s=e.tagName;if(E(e)){const t=I(e);n=Array.isArray(t)?t.join(", "):t,e instanceof HTMLInputElement&&(a=e.checked,s=e.type)}y(`Trigger ${t}:`,{element:e,goTo:i,value:n,checked:a,type:s})});const i=b(a);y("All Answer Steps:"),i.forEach((e,t)=>{y(`Answer Step ${t}:`,{element:e,dataAnswer:S(e,"data-answer"),visible:"none"!==e.style.display})}),y("=== END DEBUG ===")};let D=!1,j=[],M=[],O=[],R=0,H=null;function G(e=document){D&&(y("MultiStep already multiStepInitialized, cleaning up first"),y("Resetting multi-step navigation"),j.forEach(e=>e()),j=[],M.forEach((e,t)=>{ee(t)}),M=[],R=0,D=!1,y("Multi-step reset complete")),y("Initializing multi-step navigation with step/step_item architecture");const t=b(n,e);y(`Found ${t.length} parent steps`),M=Array.from(t).map((e,t)=>{const i=e,n=S(e,"data-answer"),a=n||`step-${t}`,s={element:i,id:a,index:t,type:S(e,"data-step-type")||void 0,subtype:S(e,"data-step-subtype")||void 0,number:S(e,"data-step-number")||void 0,isStepItem:!1};return y(`Registering parent step ${t}`,{stepId:a,dataAnswer:n,type:s.type,element:i}),C.setStepInfo(a,{type:s.type,subtype:s.subtype,number:s.number,visible:0===t,visited:!1}),s}),O=[],M.forEach((e,t)=>{const i=e.element.querySelectorAll(".step-item");console.log(`[FormLib] Found ${i.length} step_items in parent step ${t} (${e.id})`),i.forEach((i,n)=>{const a=i,s=S(i,"data-answer"),r=S(i,"data-go-to");if(console.log(`[FormLib] Processing step_item ${n}:`,{dataAnswer:s,dataGoTo:r,parentStepId:e.id,parentStepIndex:t,element:a,allAttributes:Array.from(a.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}),!s)return void console.warn(`[FormLib] Step item ${n} in parent step ${t} missing required data-answer attribute`);const o={element:a,id:s,index:O.length,type:S(i,"data-step-type")||void 0,subtype:S(i,"data-step-subtype")||void 0,number:S(i,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:t};console.log("[FormLib] Registered step_item:",{stepId:s,parentStepIndex:t,globalIndex:O.length,type:o.type,element:a}),C.setStepInfo(s,{type:o.type,subtype:o.subtype,number:o.number,visible:!1,visited:!1}),O.push(o)})}),M.forEach((e,t)=>{U(e.element,`parent step ${t}`)}),O.forEach((e,t)=>{U(e.element,`step_item ${t} (${e.id})`)}),function(e){const t=L(e,"click",s,W),i=L(e,"click",r,X),n=L(e,"click",l,Y),a=L(e,"click",o,K);j.push(t,i,n,a)}(e),M.length>0&&Z(0),D=!0,y("Multi-step initialization complete",{parentStepCount:M.length,stepItemCount:O.length})}function U(e,t){e.style.display="none",e.style.visibility="hidden",$(e,"hidden-step"),F(e,m),e.setAttribute("data-step-hidden","true"),y(`Forcibly hiding ${t}:`,{display:e.style.display,visibility:e.style.visibility,classes:e.className})}function J(e){console.log(`[FormLib] Attempting to show step_item: ${e}`),console.log("[FormLib] Available step_items:",O.map(e=>({id:e.id,dataAnswer:S(e.element,"data-answer"),element:e.element})));const t=O.find(t=>t.id===e);if(!t){console.warn(`[FormLib] Step item not found: ${e}`),console.log(`[FormLib] Looking for step_item with data-answer="${e}"`);const t=O.find(t=>S(t.element,"data-answer")===e);return t?(console.log(`[FormLib] Found step_item by data-answer: ${e}`,t),J(t.id)):void 0}if(!M[t.parentStepIndex])return void console.warn(`[FormLib] Parent step not found for step_item: ${e}`);y(`Showing step_item ${e} in parent step ${t.parentStepIndex}`);var i,n;O.filter(e=>e.parentStepIndex===t.parentStepIndex).forEach(e=>{U(e.element,`step_item ${e.id}`),C.setStepVisibility(e.id,!1)}),i=t.element,n=`step_item ${e}`,i.style.display="",i.style.visibility="",F(i,"hidden-step"),$(i,m),i.removeAttribute("data-step-hidden"),y(`Showing ${n}:`,{display:i.style.display,visibility:i.style.visibility,classes:i.className}),C.setStepVisibility(e,!0),H=e,y(`Successfully showed step_item: ${e}`)}function V(e){y(`Attempting to hide step_item: ${e}`);const t=O.find(t=>t.id===e);t?(y(`Hiding step_item: ${e}`),U(t.element,`step_item ${e}`),C.setStepVisibility(e,!1),H===e&&(H=null),y(`Successfully hid step_item: ${e}`)):y(`Step item not found for hiding: ${e}`)}function W(e,t){e.preventDefault(),y("Next button clicked");const i=ie();if(!i)return;if(H){const e=O.find(e=>e.id===H);if(e&&!Q(e.element))return void y("Step item validation failed, staying on current step")}else if(!Q(i.element))return void y("Step validation failed, staying on current step");let n=null;if(H){const e=O.find(e=>e.id===H);e&&(n=S(e.element,"data-go-to"),y(`Step item ${H} has data-go-to: ${n}`))}n||(n=function(e){const t=C.getBranchPath().activeConditions;y("Evaluating next step",{currentStep:e,activeConditions:t});for(const[e,i]of Object.entries(t))if(null!=i&&""!==i)return y(`Next step determined by branch: ${e}`),e;return y("No active branch conditions, using sequential navigation"),null}(i.id),y(`Branching logic determined next step: ${n}`)),n?function(e){y(`Attempting to navigate to step: ${e}`);const t=te(e);if(-1!==t)return y(`Found parent step: ${e} at index ${t}`),H=null,void Z(t);const i=O.find(t=>t.id===e);if(i)return y(`Found step_item: ${e} in parent step ${i.parentStepIndex}`),void(void 0!==i.parentStepIndex&&(Z(i.parentStepIndex),J(e)));console.warn(`[FormLib] Step not found: ${e}`),y("Step not found",{targetStepId:e,availableParentSteps:M.map(e=>e.id),availableStepItems:O.map(e=>e.id)})}(n):function(){const e=R+1;e<M.length?Z(e):y("Already at last step")}()}function X(e,t){e.preventDefault(),y("Back button clicked"),function(){const e=C.goToPreviousStep();if(e){const t=te(e);if(-1!==t)return void Z(t)}const t=R-1;t>=0?Z(t):y("Already at first step")}()}function Y(e,t){e.preventDefault();const i=S(t,"data-skip");if(y("Skip button clicked",{skipTarget:i}),i){const e=te(i);if(-1!==e){for(let t=R+1;t<e;t++)C.addSkippedStep(M[t].id);Z(e)}else y(`Skip target step not found: ${i}`)}}function K(e,t){y("Submit button clicked");if(!function(){let e=!0;return M.forEach((t,i)=>{if(C.isStepVisible(t.id)){const i=t.element.querySelectorAll("[required]");for(const n of i){const i=n;i.value.trim()||(y(`Required field empty in step ${t.id}: ${i.name||"unnamed"}`),e=!1)}}}),e}())return e.preventDefault(),void y("Form validation failed, preventing submission");y("Form validation passed, allowing submission")}function Q(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(A(t)){if(!t.value||""===t.value.trim())return y("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return y("Validation failed: invalid email format",{element:t,value:t.value}),t.focus(),!1}}}return!0}function Z(e){if(e<0||e>=M.length)return void y(`Invalid step index: ${e}`);const t=R,i=M[e];y(`Navigating to step ${e}`,{from:t,to:e,stepId:i.id}),M[R]&&ee(R),R=e,function(e){if(e<0||e>=M.length)return;const t=M[e],i=t.element;i.style.display="",i.style.visibility="",F(i,"hidden-step"),$(i,m),i.removeAttribute("data-step-hidden"),C.setStepInfo(t.id,{visible:!0,visited:!0}),y(`Step shown: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}(e),C.setCurrentStep(i.id),function(){const e=b(r),t=b(s),i=b(o);e.forEach(e=>{const t=e;0===R?(t.disabled=!0,$(e,g)):(t.disabled=!1,F(e,g))});const n=R===M.length-1;t.forEach(e=>{const t=e;n?t.style.display="none":(t.style.display="",t.disabled=!1,F(e,g))}),i.forEach(e=>{const t=e;n?(t.style.display="",t.disabled=!1,F(e,g)):t.style.display="none"}),y("Navigation buttons updated",{currentStepIndex:R,isLastStep:n,backButtonsCount:e.length,nextButtonsCount:t.length,submitButtonsCount:i.length})}(),y("Step navigation complete",{currentStep:i.id,currentIndex:e})}function ee(e){if(e<0||e>=M.length)return;const t=M[e],i=t.element;i.style.display="none",i.style.visibility="hidden",$(i,"hidden-step"),F(i,m),i.setAttribute("data-step-hidden","true"),C.setStepInfo(t.id,{visible:!1}),y(`Step hidden: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}function te(e){return M.findIndex(t=>t.id===e)}function ie(){return M[R]||null}e.debugFormSteps=function(){y("=== DEBUG: All Registered Steps ==="),M.forEach((e,t)=>{const i=e.element;y(`Step ${t}:`,{stepId:e.id,dataAnswer:i.getAttribute("data-answer"),elementId:i.getAttribute("id"),index:e.index,visible:"none"!==i.style.display,classes:i.className,element:i})}),y("=== END DEBUG ===")};let ne=!1,ae=[],se=new Map;function re(e=document){ne&&(y("Validation already validationInitialized, cleaning up first"),y("Resetting validation"),ae.forEach(e=>e()),ae=[],y("Clearing all field validation"),se.forEach((e,t)=>{!function(e){const t=se.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,ce(t.element,!0),y(`Cleared validation for field: ${e}`))}(t)}),se.clear(),ne=!1,y("Validation reset complete")),y("Initializing form validation");const t=b("input, select, textarea",e);y(`Found ${t.length} form inputs`),t.forEach(e=>{if(!E(e))return;const t=e.name||S(e,"data-step-field-name");if(!t)return;const i=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:S(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=S(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=S(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=S(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==i.length&&(se.set(t,{element:e,rules:i,isValid:!0}),y(`Validation rules set for field: ${t}`,i))}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}(oe,p.VALIDATION_DELAY),i=L(e,"input","input, select, textarea",t),n=L(e,"blur","input, select, textarea",oe),a=L(e,"change","input, select, textarea",oe);ae.push(i,n,a)}(e),ne=!0,y("Validation initialization complete")}function oe(e,t){if(!E(t))return;const i=t.name||S(t,"data-step-field-name");if(!i)return;const a=t.closest(n);if(a){const e=S(a,"data-answer");if(e&&!C.isStepVisible(e))return void y(`Skipping validation for field in hidden step: ${i}`)}le(i)}function le(e){const t=se.get(e);if(!t)return y(`No validation rules found for field: ${e}`),!0;const i=t.element,n=I(i);y(`Validating field: ${e}`,{value:n});let a=!0,s="";for(const e of t.rules){const t=de(n,e);if(!t.isValid){a=!1,s=t.message||"Validation failed";break}}return t.isValid=a,t.errorMessage=s,ce(i,a,s),C.setField(e,n),y(`Field validation result: ${e}`,{isValid:a,errorMessage:s,value:n}),a}function de(e,t){switch(t.type){case"required":return{isValid:!(""===e||null==e||Array.isArray(e)&&0===e.length),message:t.message};case"email":return{isValid:!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e)),message:t.message};case"phone":return{isValid:!e||/^[\+]?[1-9][\d]{0,15}$/.test(String(e).replace(/\D/g,"")),message:t.message};case"min":return{isValid:!e||String(e).length>=t.value,message:t.message};case"max":return{isValid:!e||String(e).length<=t.value,message:t.message};case"pattern":return{isValid:!e||t.value.test(String(e)),message:t.message};case"custom":return{isValid:!t.validator||t.validator(e),message:t.message};default:return{isValid:!0}}}function ce(e,t,i){t?F(e,f):$(e,f);const n=ue(e);n&&(t?(n.textContent="",n.style.display="none"):(n.textContent=i||"Validation failed",n.style.display="block"))}function ue(e){const t=e.name||S(e,"data-step-field-name");if(!t)return null;let i=e.parentElement?.querySelector(`.${h}[data-field="${t}"]`);return i||(i=document.createElement("div"),i.className=h,i.setAttribute("data-field",t),i.style.color="red",i.style.fontSize="0.875em",i.style.marginTop="0.25rem",i.style.display="none",e.parentElement?.insertBefore(i,e.nextSibling)),i}function pe(){const e={validationInitialized:ne,totalFields:se.size,validFields:0,invalidFields:0,fields:{}};return se.forEach((t,i)=>{e.fields[i]={isValid:t.isValid,errorMessage:t.errorMessage,rulesCount:t.rules.length},t.isValid?e.validFields++:e.invalidFields++}),e}let me=new Map;function fe(){y("Clearing all field errors"),me.forEach((e,t)=>{!function(e){const t=me.get(e);t?(y(`Clearing error for field: ${e}`),F(t.element,f),t.errorElement&&(t.errorElement.textContent="",t.errorElement.style.display="none")):y(`Cannot clear error for unknown field: ${e}`)}(t)})}function he(){const e=[];return me.forEach((t,i)=>{(function(e){const t=me.get(e);return!!t&&t.element.classList.contains(f)})(i)&&e.push(i)}),e}function ue(e){let t=e.element.parentElement?.querySelector(`.${h}[data-field="${e.fieldName}"]`);if(!t){t=document.createElement("div"),t.className=h,t.setAttribute("data-field",e.fieldName),t.style.color="red",t.style.fontSize="0.875em",t.style.marginTop="0.25rem",t.style.display="none";const i=e.element.parentElement;if(!i)return y(`Cannot create error element for field: ${e.fieldName} - no parent element`),null;{const n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t)}y(`Created error element for field: ${e.fieldName}`)}return t}function ge(){const e=he(),t={totalFields:me.size,fieldsWithErrors:e.length,errors:{}};return e.forEach(e=>{const i=me.get(e);t.errors[e]={message:i?.errorElement?.textContent||"Unknown error",customMessage:i?.customMessage}}),t}let ye=!1,be=[],ve=[];function Se(e=document){ye&&(y("Summary already summaryInitialized, cleaning up first"),y("Resetting summary functionality"),be.forEach(e=>e()),be=[],ve.forEach(e=>{Ie(e.element,"")}),ve=[],ye=!1,y("Summary reset complete")),y("Initializing summary functionality");const t=b(u,e);y(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=S(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=S(e,"data-join"),a=n&&n in p.JOIN_SEPARATOR?n:"space",s=S(e,"data-summary-type")||void 0,r=S(e,"data-summary-subtype")||void 0,o=S(e,"data-summary-number")||void 0,l={element:e,fieldNames:i,joinType:a,type:s,subtype:r,number:o};ve.push(l),y("Summary field configured",{fieldNames:i,joinType:a,type:s,subtype:r,number:o})})}(t),function(e){const t=L(e,"input",c,$e),i=L(e,"change",c,$e),n=L(e,"blur",c,$e);be.push(t,i,n)}(e),Ae(),ye=!0,y("Summary initialization complete")}function $e(e,t){if(!E(t))return;const i=S(t,"data-step-field-name");if(!i)return;const n=I(t);y(`Summary field changed: ${i}`,{value:n}),C.setField(i,n),Fe(i)}function Fe(e){ve.forEach(t=>{t.fieldNames.includes(e)&&Ee(t)})}function Ae(){ve.forEach(e=>{Ee(e)})}function Ee(e){const t=[];e.fieldNames.forEach(e=>{const i=C.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=p.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);Ie(e.element,i),y("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function Ie(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}class Le{constructor(){this.initialized=!1,this.rootElement=document,y("FormLibrary instance created")}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}init(e=document){this.initialized&&(y("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,y("Initializing FormLibrary",{root:e===document?"document":"custom element"});const a=e.querySelectorAll(t),s=e.querySelectorAll(i),r=e.querySelectorAll(n);if(y("Form detection results",{multistepForms:a.length,logicForms:s.length,stepElements:r.length}),0!==a.length||0!==r.length)try{!function(e=document){y("Initializing error handling"),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||S(e,"data-step-field-name");t&&me.set(t,{fieldName:t,element:e,customMessage:S(e,"data-error-message")||void 0})}),y(`Error handling errorsInitialized for ${me.size} fields`)}(e),re(e),s.length>0&&T(e),(a.length>0||r.length>0)&&G(e),Se(e),this.initialized=!0,y("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw y("FormLibrary initialization failed",e),e}else y("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){y("Destroying FormLibrary");try{B()}catch(e){y("Error during FormLibrary destruction",e)}C.clear(),this.initialized=!1,y("FormLibrary destruction complete")}else y("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:C.getDebugInfo(),branching:{branchingInitialized:x,activeConditions:C.getBranchPath().activeConditions,visibleSteps:Object.entries(C.getAllSteps()).filter(([e,t])=>t.visible).map(([e,t])=>e)},multiStep:{multiStepInitialized:D,currentStepIndex:R,totalSteps:M.length,steps:M.map(e=>({id:e.id,index:e.index,visible:A(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:pe(),errors:ge(),summary:{summaryInitialized:ye,totalSummaryFields:ve.length,summaryFields:ve.map(e=>({fieldNames:e.fieldNames,joinType:e.joinType,type:e.type,subtype:e.subtype,number:e.number,currentValue:e.element.textContent||""})),formStateData:C.getAll()}}}logCurrentState(){y("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return y("Cannot validate form - library not initialized"),!1;y("Validating entire form");const e=function(){y("Validating all visible fields");let e=!0;const t={};for(const[i,a]of se){const s=a.element.closest(n);let r=!0;if(s){const e=S(s,"data-answer");e&&!C.isStepVisible(e)&&(r=!1)}if(r){const n=le(i);t[i]=n,n||(e=!1)}}return y("All visible fields validation complete",{allValid:e,results:t}),e}();return y("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){var e;y("Resetting form to initial state"),fe(),C.clear(),e?(y("Clearing specific summary fields",e),C.clearFields(e),e.forEach(e=>{Fe(e)})):(y("Clearing all summaries"),C.clear(),Ae());try{Z(0)}catch(e){y("Could not go to first step during reset",e)}y("Form reset complete")}else y("Cannot reset form - library not initialized")}getFormData(){return C.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{C.setField(e,t)}),y("Updating all summaries"),Ae(),y("Form data set",e)}}const we=Le.getInstance();if(void 0!==e){const e=()=>{const e=document.querySelectorAll(t),i=document.querySelectorAll(n);(e.length>0||i.length>0)&&(y("Auto-initializing FormLibrary on DOM ready"),we.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}void 0!==e&&(e.FormLib=we,y("FormLib attached to window for debugging")),void 0!==e&&(e.FormLibrary=Le,e.FormLib=we)}("undefined"!=typeof window?window:this);