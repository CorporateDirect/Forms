"use strict";var FormLib=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(a,{FormState:()=>I,clearAllErrors:()=>O,clearError:()=>F,clearSummary:()=>Fe,default:()=>Re,getCurrentStepInfo:()=>Ae,goToStep:()=>ve,initBranching:()=>A,initErrors:()=>V,initMultiStep:()=>ce,initSummary:()=>Me,initValidation:()=>B,resetBranching:()=>$,showError:()=>_,showStep:()=>be,updateSummary:()=>Le,validateAllVisibleFields:()=>W,validateField:()=>U,validateStep:()=>Z});var s={MULTISTEP:'[data-form="multistep"]',LOGIC:"[data-logic]",STEP:'[data-form="step"]',ANSWER:"[data-answer]",GO_TO:"[data-go-to]",SKIP:"[data-skip]",NEXT_BTN:'[data-form="next-btn"]',BACK_BTN:'[data-form="back-btn"]',SUBMIT:'[data-form="submit"]',SUBMIT_BTN:'[data-form="submit-btn"]',ERROR_DISPLAY:'[data-form="error"]',SKIP_IF:"[data-skip-if]",SKIP_UNLESS:"[data-skip-unless]",SKIP_SECTION:"[data-skip-section]",ALLOW_SKIP_UNDO:"[data-allow-skip-undo]",SKIP_REASON:"[data-skip-reason]",SHOW_IF:"[data-show-if]",STEP_TYPE:"[data-step-type]",STEP_SUBTYPE:"[data-step-subtype]",STEP_NUMBER:"[data-step-number]",STEP_FIELD_NAME:"[data-step-field-name]",SUMMARY_FIELD:"[data-summary-field]",SUMMARY_TYPE:"[data-summary-type]",SUMMARY_SUBTYPE:"[data-summary-subtype]",SUMMARY_NUMBER:"[data-summary-number]",JOIN:"[data-join]",REQUIRED:"[required]",ERROR_MESSAGE:"[data-error-message]",VALIDATE:"[data-validate]",ALL_INPUTS:"input, select, textarea"},r={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},o={ACTIVE_STEP:"active-step",HIDDEN_STEP:"hidden-step",HIDDEN_STEP_ITEM:"hidden-step-item",ERROR_FIELD:"error-field",ACTIVE_ERROR:"active-error",DISABLED:"disabled",SKIPPED_STEP:"skipped-step",SKIP_AVAILABLE:"skip-available",SKIP_DISABLED:"skip-disabled"},l=new Map;function d(e,t){if(!r.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${r.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function p(e,t=document){if(t===document){const i=`all:${e}`;if(l.has(i))return l.get(i);const n=t.querySelectorAll(e);return l.set(i,n),n}return t.querySelectorAll(e)}function c(e,t=document){if(t===document){const i=`single:${e}`;if(l.has(i))return l.get(i);const n=t.querySelector(e);return l.set(i,n),n}return t.querySelector(e)}function u(e,t){return e.getAttribute(t)}function m(e,t){e.classList.add(t)}function g(e,t){e.classList.remove(t)}function h(e){g(e,"hidden-step");const t=e.getAttribute("data-original-display")||"";if(t&&"none"!==t)e.style.setProperty("display",t,"important");else{const t=e.classList.contains("flex")||e.classList.contains("d-flex")||e.classList.contains("step_wrapper")||"flex"===getComputedStyle(e).display;e.style.setProperty("display",t?"flex":"block","important")}e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),console.log("🔄 [Utils] Showing element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t||"none stored",currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)})}function f(e){const t=getComputedStyle(e).display;t&&"none"!==t&&e.setAttribute("data-original-display",t),m(e,"hidden-step"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),console.log("🔄 [Utils] Hiding element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t,currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)})}function S(e){const t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function y(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function v(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function b(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}var I=class e{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],skipHistory:[],activeConditions:{}},d("FormState initialized")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setField(e,t){const i=this.data[e];this.data[e]=t,d(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],skipHistory:[],activeConditions:{}},d("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&d("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),d(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),d(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),d(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e,t,i=!0){if(!this.branchPath.skippedSteps.includes(e)){this.branchPath.skippedSteps.push(e);const n={stepId:e,reason:t,timestamp:Date.now(),canUndo:i,fieldsCleared:[]};this.branchPath.skipHistory.push(n),this.setStepInfo(e,{skipped:!0,skipReason:t,allowSkipUndo:i}),d(`Step skipped: ${e}`,{reason:t,canUndo:i,totalSkipped:this.branchPath.skippedSteps.length})}}undoSkipStep(e){const t=this.branchPath.skippedSteps.indexOf(e);if(-1===t)return d(`Cannot undo skip - step not in skipped list: ${e}`),!1;const i=this.getStepInfo(e);if(i&&!1===i.allowSkipUndo)return d(`Cannot undo skip - undo not allowed for step: ${e}`),!1;this.branchPath.skippedSteps.splice(t,1),this.setStepInfo(e,{skipped:!1,skipReason:void 0});const n=this.branchPath.skipHistory.find(t=>t.stepId===e);return n&&(n.canUndo=!1),d(`Skip undone for step: ${e}`,{remainingSkipped:this.branchPath.skippedSteps.length}),!0}isStepSkipped(e){return this.branchPath.skippedSteps.includes(e)}getSkipHistory(){return[...this.branchPath.skipHistory]}getSkippedSteps(){return[...this.branchPath.skippedSteps]}clearSkipHistory(){this.branchPath.skippedSteps=[],this.branchPath.skipHistory=[],Object.keys(this.steps).forEach(e=>{this.steps[e].skipped&&this.setStepInfo(e,{skipped:!1,skipReason:void 0})}),d("Skip history cleared")}getSkipStats(){const e={totalSkipped:this.branchPath.skippedSteps.length,canUndoCount:0,skipReasons:{}};return this.branchPath.skipHistory.forEach(t=>{t.canUndo&&e.canUndoCount++,t.reason&&(e.skipReasons[t.reason]=(e.skipReasons[t.reason]||0)+1)}),e}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,d(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(){const e={};return Object.entries(this.data).forEach(([t,i])=>{e[t]=i}),e}onFieldChange(e,t,i){t!==i&&d(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,d(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}.getInstance(),E=new class{constructor(){this.events={},this.moduleStates=new Map}registerModule(e){this.moduleStates.set(e,{initialized:!0,name:e})}unregisterModule(e){this.moduleStates.delete(e)}isModuleInitialized(e){return this.moduleStates.get(e)?.initialized??!1}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.off(e,t)}}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){const i=String(e);if(console.log(`🔄 [FormEvents] Emitting event: ${i}`,{eventData:t,timestamp:(new Date).toISOString(),hasListeners:!!this.events[e],listenerCount:this.events[e]?.length||0}),!this.events[e])return void console.warn(`⚠️ [FormEvents] No listeners registered for event: ${i}`);if("skip:request"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});if("branch:change"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});let n=0,a=0;this.events[e].forEach((s,r)=>{try{console.log(`📡 [FormEvents] Calling listener ${r+1}/${this.events[e].length} for ${i}`),s(t),n++,console.log(`✅ [FormEvents] Listener ${r+1} completed successfully for ${i}`)}catch(n){a++,console.error(`💥 [FormEvents] LISTENER ERROR ${r+1}/${this.events[e].length} for '${i}':`,{error:n,errorMessage:n instanceof Error?n.message:String(n),errorStack:n instanceof Error?n.stack:void 0,eventData:t,listenerIndex:r})}}),console.log(`📊 [FormEvents] Event ${i} completed:`,{totalListeners:this.events[e].length,successful:n,failed:a,eventData:t})}},N=!1,T=[];function A(e=document){N&&(d("Branching already initialized, cleaning up first"),$()),d("Initializing branching logic");const t=e.querySelectorAll(s.MULTISTEP),i=e.querySelectorAll(s.STEP);0===t.length&&0===i.length&&d("Warning: Branching initialized but no multi-step forms found. Branch events may not be handled."),function(e){const t=b(e,"change",s.GO_TO,w),i=b(e,"input",s.GO_TO,w),n=b(e,"click",s.GO_TO,w),a=b(e,"click","label.radio_field, .w-radio, .radio_button-skip-step, .w-form-formradioinput, .w-radio-input",k);T.push(t,i,n,a)}(e),N=!0,d("Branching initialization complete"),E.registerModule("branching")}function k(e,t){let i=null;if(i=t.querySelector('input[type="radio"][data-go-to]'),!i){const e=t.closest("label");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(!i){const e=t.closest(".radio_field, .w-radio, .radio_component");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(i&&u(i,"data-go-to")){e.preventDefault(),e.stopPropagation(),i.checked=!0,C(i);const t=new Event("change",{bubbles:!0});Object.defineProperty(t,"target",{value:i}),w(t,i)}}function w(e,t){if(console.log("🌿 [Branch] Trigger event detected",{eventType:e.type,element:t,tagName:t.tagName,className:t.className,id:t.id}),!N)return void console.error("❌ [Branch] Module not initialized, ignoring branch trigger",{target:t,initialized:N,eventType:e.type});if(!y(t))return void console.log("ℹ️ [Branch] Element is not a form input, ignoring",{tagName:t.tagName,isInput:t instanceof HTMLInputElement,isSelect:t instanceof HTMLSelectElement,isTextarea:t instanceof HTMLTextAreaElement});const i=u(t,"data-go-to"),n=t.name||u(t,"data-step-field-name"),a=v(t),s=t.type||t.tagName;if(console.log("📋 [Branch] Data attributes analysis:",{"data-go-to":i,"data-step-field-name":u(t,"data-step-field-name"),name:t.name,type:s,value:a,checked:t.checked,allAttributes:Array.from(t.attributes).map(e=>({name:e.name,value:e.value}))}),i&&!function(e){return!!e&&(!!/^[a-zA-Z0-9_-]+$/.test(e)||(d("Invalid data-go-to value format",{goToValue:e}),!1))}(i))return void console.error("❌ [Branch] Invalid data-go-to value format",{goToValue:i,validFormat:"alphanumeric, hyphens, underscores only",pattern:"/^[a-zA-Z0-9_-]+$/"});console.log("🎯 [Branch] Processing branch trigger:",{element:t,goTo:i,value:a,type:s,fieldName:n,hasGoTo:!!i,hasValue:!!a}),n?(I.setField(n,a),console.log("💾 [Branch] Field value stored in FormState:",{fieldName:n,value:a,previousValue:I.getField(n)})):console.warn("⚠️ [Branch] No field name found, cannot store value in FormState",{element:t,name:t.name,dataStepFieldName:u(t,"data-step-field-name")});try{if(t instanceof HTMLInputElement)if("radio"===t.type&&t.checked){if(console.log("📻 [Branch] Processing radio button selection:",{name:t.name,value:t.value,checked:t.checked,goTo:i}),!i)return void console.warn("⚠️ [Branch] Radio button has no data-go-to attribute, skipping navigation",{element:t,name:t.name,value:t.value});if(!document.querySelector(`[data-answer="${i}"]`)){const e=document.querySelectorAll("[data-answer]"),t=Array.from(e).map(e=>u(e,"data-answer"));console.error("❌ [Branch] Target step not found in DOM!",{searchedFor:i,availableSteps:t,suggestion:`Check if element with data-answer="${i}" exists`,possibleMatches:t.filter(e=>e&&e.includes(i))})}!function(e){const t=e.name;if(!t)return;document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{if(t!==e){const e=u(t,"data-go-to");e&&P(e)}})}(t),C(t),M(i,t.value),console.log("🚀 [Branch] Emitting branch:change event:",{targetStepId:i,triggerValue:t.value,triggerType:"radio"}),E.emit("branch:change",{targetStepId:i})}else"checkbox"===t.type?(console.log("☑️ [Branch] Processing checkbox:",{name:t.name,value:t.value,checked:t.checked,goTo:i}),i&&(t.checked?(console.log("✅ [Branch] Checkbox checked, activating branch:",{goToValue:i}),M(i,t.value)):(console.log("❌ [Branch] Checkbox unchecked, deactivating branch:",{goToValue:i}),P(i)))):"radio"!==t.type&&"checkbox"!==t.type&&(console.log("📝 [Branch] Processing text input/other:",{type:t.type,name:t.name,value:a,goTo:i}),i&&(a?(console.log("✅ [Branch] Input has value, activating branch:",{goToValue:i,inputValue:a}),M(i,a)):(console.log("❌ [Branch] Input is empty, deactivating branch:",{goToValue:i}),P(i))));else console.log("📋 [Branch] Processing select/textarea:",{tagName:t.tagName,value:a,goTo:i}),i&&(a?(console.log("✅ [Branch] Element has value, activating branch:",{goToValue:i,inputValue:a}),M(i,a)):(console.log("❌ [Branch] Element is empty, deactivating branch:",{goToValue:i}),P(i)))}catch(e){console.error("💥 [Branch] Error handling branch trigger:",{error:e,errorMessage:e instanceof Error?e.message:String(e),errorStack:e instanceof Error?e.stack:void 0,element:t,goToValue:i,inputValue:a,fieldName:n})}const r=I.getBranchPath().activeConditions;Object.keys(r).length>0?(console.log("🔄 [Branch] Updating step visibility based on active conditions:",{activeConditions:r,conditionCount:Object.keys(r).length}),function(){const e=p("[data-show-if]"),t=I.getBranchPath().activeConditions;e.forEach(e=>{const i=u(e,"data-show-if"),n=u(e,"data-answer");i&&n&&(function(e,t){if(!e||"string"!=typeof e)return d("Invalid condition provided",{condition:e}),!1;try{const i=e.trim();return i.includes(",")?i.split(",").map(e=>e.trim()).some(e=>!!t[e]):i.includes("&")?i.split("&").map(e=>e.trim()).every(e=>!!t[e]):!!t[i]}catch(t){return d("Error evaluating condition",{condition:e,error:t}),!1}}(i,t)?(h(e),I.setStepVisibility(n,!0),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e;"true"===t.getAttribute("data-original-required")&&(t.required=!0)})):(f(e),I.setStepVisibility(n,!1),function(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");t.forEach(e=>{const t=e;t.setAttribute("data-original-required","true"),t.required=!1})}(e)))})}()):console.log("ℹ️ [Branch] No active conditions, skipping step visibility update")}function C(e){const t=e.name;if(!t)return;const i=u(e,"fs-inputactive-class")||"is-active-inputactive";document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{const n=t,a=n.closest("label");n!==e&&(n.classList.remove(i),a?.classList.remove(i))}),e.classList.add(i);const n=e.closest("label");n?.classList.add(i)}function M(e,t){e&&I.setActiveCondition(e,t)}function P(e){e&&(I.setActiveCondition(e,null),function(e){const t=[],i=c(`[data-answer="${e}"]`);if(i){p("[data-step-field-name]",i).forEach(e=>{const i=u(e,"data-step-field-name");i&&t.push(i)})}t.length>0&&I.clearFields(t)}(e))}function $(){if(!N)return void d("Branching module not initialized, nothing to reset");d("Resetting branching module"),E.unregisterModule("branching"),T.forEach(e=>e()),T=[];I.getBranchPath().activeConditions={},N=!1,d("Branching module reset")}var L=new Map,x=new Map;function V(e=document){d("Initializing error handling");e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||u(e,"data-step-field-name");t&&L.set(t,{fieldName:t,element:e,customMessage:u(e,"data-error-message")||void 0})}),d(`Error handling initialized for ${L.size} fields`)}function _(e,t){const i=L.get(e);if(!i)return void d(`Cannot show error for unknown field: ${e}`);const n=t||i.customMessage||"This field has an error";d(`Showing error for field: ${e}`,{message:n}),m(i.element,o.ERROR_FIELD);const a=function(e){if(!e||!e.element)return d("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return d(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`${s.ERROR_DISPLAY}[data-field="${e.fieldName}"]`)}catch(t){return d(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.setAttribute("data-form","error"),t.setAttribute("data-field",e.fieldName);const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),d(`Created error element for field: ${e.fieldName}`)}catch(t){return d(`Error creating error element for field: ${e.fieldName}`,t),null}return t}(i);a&&(a.textContent=n,m(a,o.ACTIVE_ERROR),i.errorElement=a),function(e){const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||(e.scrollIntoView({behavior:"smooth",block:"center"}),d(`Scrolled to field with error: ${e.name||"unnamed"}`))}(i.element)}function F(e){const t=L.get(e);t?(d(`Clearing error for field: ${e}`),g(t.element,o.ERROR_FIELD),t.errorElement&&(t.errorElement.textContent="",g(t.errorElement,o.ACTIVE_ERROR))):d(`Cannot clear error for unknown field: ${e}`)}function O(){d("Clearing all field errors"),L.forEach((e,t)=>{F(t)})}function D(){const e={};return x.forEach((t,i)=>{e[i]={message:t.message}}),e}var z=!1,R=[],q=new Map;function B(e=document){z&&(d("Validation already initialized, cleaning up first"),d("Resetting validation"),R.forEach(e=>e()),R=[],d("Clearing all field validation"),q.forEach((e,t)=>{Y(t)}),q.clear(),z=!1,d("Validation reset complete")),d("Initializing form validation");const t=p("input, select, textarea",e);d(`Found ${t.length} form inputs`),t.forEach(e=>{if(!y(e))return;const t=e,i=t.name||u(e,"data-step-field-name");if(!i)return void d("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:u(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:u(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=u(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=u(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=u(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(q.set(i,{element:e,rules:n,isValid:!0}),d(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):d(`No validation rules found for field: ${i}`)}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}((...e)=>{H(e[0],e[1])},r.VALIDATION_DELAY),i=b(e,"input","input, select, textarea",t),n=b(e,"blur","input, select, textarea",H),a=b(e,"change","input, select, textarea",H);R.push(i,n,a)}(e),z=!0,d("Validation initialization complete")}function H(e,t){if(!y(t))return;const i=t,n=i.name||u(t,"data-step-field-name");if(!n)return void d("Skipping validation - no field name found",{element:t,name:i.name,dataStepFieldName:u(t,"data-step-field-name")});const a=t.closest(s.STEP);if(a){const e=u(a,"data-answer");if(e&&!I.isStepVisible(e))return void d(`Skipping validation for field in hidden step: ${n}`)}U(n)}function U(e){const t=q.get(e);if(!t)return d(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return d(`No element found for field: ${e}`),!0;const n=v(i);d(`Validating field: ${e}`,{value:n,elementExists:!!i});for(const a of t.rules){const{isValid:s,message:r}=j(n,a);if(!s)return t.isValid=!1,t.errorMessage=r||"Invalid field",_(e,t.errorMessage),K(i,!1,t.errorMessage),!1}return t.isValid=!0,F(e),K(i,!0),!0}var G={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1\s?)?(\([0-9]{3}\)|[0-9]{3})[\s\-]?[0-9]{3}[\s\-]?[0-9]{4}$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,zipCode:/^\d{5}(-\d{4})?$/,zipCodeCA:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,creditCard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/,ssn:/^\d{3}-?\d{2}-?\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/};function j(e,t){switch(t.type){case"required":return{isValid:Array.isArray(e)?e.length>0:!!e&&""!==String(e).trim(),message:t.message};case"email":return{isValid:G.email.test(String(e)),message:t.message||"Please enter a valid email address"};case"phone":const i=String(e).replace(/[\s\-\(\)]/g,"");return{isValid:G.phone.test(i)||G.phoneUS.test(String(e)),message:t.message||"Please enter a valid phone number"};case"min":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length>=t.value,message:t.message||`Minimum ${t.value} characters required`};case"max":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length<=t.value,message:t.message||`Maximum ${t.value} characters allowed`};case"pattern":return t.value instanceof RegExp?{isValid:t.value.test(String(e)),message:t.message||"Please enter a valid format"}:{isValid:!0};case"custom":if(!t.validator)return{isValid:!0};try{return{isValid:t.validator(e),message:t.message||"Invalid value"}}catch(e){return d("Error in custom validator",{error:e,rule:t}),{isValid:!1,message:"Validation error occurred"}}default:return{isValid:!0}}}function K(e,t,i){const n=e.name||u(e,"data-step-field-name");n&&(t?F(n):_(n,i))}function Z(e){const t=c(`[data-answer="${e}"]`);if(!t)return d(`Step not found with data-answer="${e}"`),!0;if(!I.isStepVisible(e))return d(`Skipping validation for hidden step: ${e}`),!0;d(`Validating step: ${e}`);const i=t.querySelectorAll("input, select, textarea");let n=!0;return i.forEach(e=>{if(!y(e))return;const t=e.name||u(e,"data-step-field-name");if(t){U(t)||(n=!1)}}),d(`Step validation result: ${e}`,{isValid:n}),n}function W(){d("Validating all visible fields");let e=!0;const t={};for(const[i,n]of q){const a=n.element.closest(s.STEP);let r=!0;if(a){const e=u(a,"data-answer");e&&!I.isStepVisible(e)&&(r=!1)}if(r){const n=U(i);t[i]=n,n||(e=!1)}}return d("All visible fields validation complete",{allValid:e,results:t}),e}function Y(e){const t=q.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,K(t.element,!0),d(`Cleared validation for field: ${e}`))}var X=!1,J=[],Q=new Map,ee=new Map;function te(e=document){X&&(d("Skip module already initialized, cleaning up first"),ae()),d("Initializing enhanced skip functionality"),function(e){const t=p(s.STEP,e);t.forEach(e=>{const t=u(e,"data-answer");if(!t)return;const i=u(e,"data-skip-if"),n=u(e,"data-skip-unless"),a=u(e,"data-skip-to"),s=u(e,"data-skip-reason"),r="false"!==u(e,"data-allow-skip-undo");if(i||n){const e=i||`!(${n})`,o={stepId:t,condition:e,targetStep:a||void 0,reason:s||"Conditional skip",allowUndo:r,clearFields:!0};Q.set(t,o),d(`Skip rule configured for step: ${t}`,{condition:e,targetStep:a,reason:s})}})}(e),function(e){const t=p(s.SKIP_SECTION,e);t.forEach(e=>{const t=u(e,"data-skip-section");if(!t)return;const i=u(e,"data-skip-if"),n=u(e,"data-skip-reason"),a=e.querySelectorAll(s.STEP),r=[];if(a.forEach(e=>{const t=u(e,"data-answer");t&&r.push(t)}),r.length>0){const e={sectionId:t,steps:r,condition:i||void 0,reason:n||`Section skip: ${t}`};ee.set(t,e),d(`Skip section configured: ${t}`,{steps:r.length,condition:i,reason:n})}})}(e),function(e){const t=b(e,"click",s.SKIP,ie);J.push(t)}(e),X=!0,d("Skip initialization complete",{skipRules:Q.size,skipSections:ee.size}),E.registerModule("skip")}function ie(e,t){if(e.preventDefault(),console.log("🔘 [Skip v2.1] Button clicked - NEW VALIDATION ACTIVE",{element:t,tagName:t.tagName,className:t.className,id:t.id,version:"NEW_SKIP_VALIDATION_2024_v2.1",timestamp:(new Date).toISOString()}),!X)return void console.error("❌ [Skip v2.1] Module not initialized, ignoring skip button click",{target:t,initialized:X,skipRulesCount:Q.size,skipSectionsCount:ee.size});const i=u(t,"data-skip"),n=u(t,"data-skip-reason"),a=u(t,"data-allow-skip-undo");if(console.log("📋 [Skip v2.1] Data attributes analysis:",{"data-skip":i,"data-skip-reason":n,"data-allow-skip-undo":a,allAttributes:Array.from(t.attributes).map(e=>({name:e.name,value:e.value}))}),!i||"true"===i||""===i)return void console.error("❌ [Skip v2.0] Invalid data-skip value - must specify target step",{dataSkip:i,isEmpty:""===i,isTrue:"true"===i,isNull:null===i,isUndefined:void 0===i,requirement:"data-skip must contain a value that matches an existing data-answer"});const s=document.querySelector(`[data-answer="${i}"]`),r=document.querySelectorAll("[data-answer]"),o=Array.from(r).map(e=>u(e,"data-answer"));if(console.log("🔍 [Skip v2.0] Target step verification:",{targetStep:i,targetElementExists:!!s,targetElement:s?{tagName:s.tagName,id:s.id,className:s.className,dataAnswer:u(s,"data-answer"),isVisible:s instanceof HTMLElement&&S(s),hasContent:s.children.length>0||""!==s.innerHTML.trim(),innerHTML:s.innerHTML.length>0?`${s.innerHTML.substring(0,100)}...`:"EMPTY"}:null,availableSteps:o,totalStepsWithDataAnswer:r.length,searchQuery:`[data-answer="${i}"]`}),!s)return void console.error("❌ [Skip v2.0] Target step not found in DOM! Skip operation cancelled.",{searchedFor:i,availableSteps:o,suggestion:`Check if element with data-answer="${i}" exists`,possibleMatches:o.filter(e=>e&&e.includes(i)),fix:`Ensure your skip button data-skip="${i}" matches an existing data-answer="${i}"`});0===s.children.length&&""===s.innerHTML.trim()&&console.warn("⚠️ [Skip v2.0] Target step appears to be empty - this may cause blank step issue!",{targetStepId:i,targetElement:{tagName:s.tagName,id:s.id,className:s.className,innerHTML:s.innerHTML,textContent:s.textContent,childrenCount:s.children.length},possibleIssue:"This step may be a blank wrapper without content"});const l=I.getCurrentStep();if(!l)return void console.error("❌ [Skip v2.0] No current step found for skip operation",{formState:I.getDebugInfo(),branchPath:I.getBranchPath(),allSteps:I.getAllSteps()});const d=n||"User skipped",p="false"!==a;console.log("🎯 [Skip v2.0] Processing valid skip request:",{currentStepId:l,targetStepId:i,skipReason:d,allowUndo:p,targetExists:!0,targetHasContent:s.children.length>0||""!==s.innerHTML.trim()}),console.log("🚀 [Skip v2.0] Emitting skip:request event:",{targetStepId:i,currentStep:l,reason:d,allowUndo:p}),E.emit("skip:request",{targetStepId:i}),console.log("✅ [Skip v2.0] Skip request emitted successfully")}function ne(e,t,i=!0,n){if(!X)return d("Skip module not initialized, cannot skip step"),!1;if(!e)return d("Invalid stepId provided to skipStep"),!1;if(d("=== SKIP STEP FUNCTION START ==="),d(`Attempting to skip step: ${e}`,{reason:t,allowUndo:i,targetStep:n}),I.isStepSkipped(e))return d(`Step already skipped: ${e}`),!1;I.addSkippedStep(e,t,i);const a=function(e){const t=[],i=document.querySelector(`[data-answer="${e}"]`);if(!i)return d(`Cannot clear fields - step element not found for ${e}`),[];return i.querySelectorAll(s.ALL_INPUTS).forEach(e=>{const i=e,n=i.name||u(i,"data-step-field-name");n&&(I.clearFields([n]),Y(n),"radio"===i.type||"checkbox"===i.type?i.checked=!1:i.value="",t.push(n))}),d(`Cleared ${t.length} fields in step ${e}`,{clearedFields:t}),t}(e);return function(e,t){const i=document.querySelector(`[data-answer="${e}"]`);if(!i)return;t?(m(i,o.SKIPPED_STEP),g(i,o.SKIP_AVAILABLE)):(g(i,o.SKIPPED_STEP),m(i,o.SKIP_AVAILABLE))}(e,!0),d(`Step ${e} skipped successfully`,{reason:t,allowUndo:i,targetStep:n,clearedFields:a}),!0}function ae(){X?(d("Resetting skip functionality"),E.unregisterModule("skip"),J.forEach(e=>e()),J=[],Q.clear(),ee.clear(),I.clearSkipHistory(),X=!1,d("Skip reset complete")):d("Skip module not initialized, nothing to reset")}var se=!1,re=[],oe=[],le=[],de=[],pe=-1;function ce(e=document){se&&(d("MultiStep already initialized, cleaning up first"),function(){if(!se)return void d("Multi-step module not initialized, nothing to reset");d("Resetting multi-step module"),E.unregisterModule("multiStep"),re.forEach(e=>e()),re=[],le=[],de=[],pe=-1,se=!1,ae(),oe.forEach(e=>e()),oe=[],d("Multi-step module reset")}()),d("Initializing multi-step navigation with step/step_item architecture");const t=p(s.STEP,e);(le=Array.from(t).map((e,t)=>{console.log(`🔍 [MultiStep] Processing step ${t}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataForm:e.hasAttribute("data-form"),dataFormValue:u(e,"data-form")});const i=e.querySelector(".step_wrapper[data-answer]");let n=null;i?(n=u(i,"data-answer"),console.log("📋 [MultiStep] Found step_wrapper with data-answer:",{stepIndex:t,dataAnswer:n,stepWrapper:{tagName:i.tagName,id:i.id,className:i.className}})):(console.log("ℹ️ [MultiStep] No step_wrapper found, checking step element directly"),n=u(e,"data-answer"),n&&console.log("📋 [MultiStep] Found data-answer on step element:",{stepIndex:t,dataAnswer:n}));const a=`step-${t}`;if(console.log(`🎯 [MultiStep] Step ${t} validation:`,{expected:a,found:n||"MISSING",isValid:!!n,matches:n===a}),!n)return console.error("❌ [MultiStep] STEP INITIALIZATION ERROR:",{stepIndex:t,error:`Step ${t} is missing required data-answer attribute`,stepElement:{tagName:e.tagName,id:e.id,className:e.className,hasStepWrapper:!!i,innerHTML:e.innerHTML.substring(0,200)+"..."},expectedDataAnswer:a,solution:`Add data-answer="${a}" to step_wrapper or step element`,examples:{stepWrapper:`<div class="step_wrapper" data-answer="${a}">`,stepElement:`<div data-form="step" data-answer="${a}">`},troubleshooting:{checkStepWrapper:"element.querySelector('.step_wrapper[data-answer]')",checkStepElement:"element.getAttribute('data-answer')",allDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}}),null;const s={element:e,id:n,index:t,type:u(e,"data-step-type")||void 0,subtype:u(e,"data-step-subtype")||void 0,number:u(e,"data-step-number")||void 0,isStepItem:!1};return console.log(`✅ [MultiStep] Step ${t} initialized successfully:`,{stepId:n,stepInfo:{id:s.id,type:s.type,subtype:s.subtype,number:s.number}}),I.setStepInfo(n,{type:s.type,subtype:s.subtype,number:s.number,visible:!1,visited:!1}),s}).filter(e=>null!==e)).forEach((e,t)=>{e.index=t});const i=document.querySelectorAll(".step_item");if(console.log(`🌿 [MultiStep] Found ${i.length} step_items for branching logic`),de=Array.from(i).map((e,i)=>{console.log(`🔍 [MultiStep] Processing step_item ${i}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataAnswer:e.hasAttribute("data-answer"),dataAnswer:u(e,"data-answer")});const n=u(e,"data-answer");if(!n)return console.error("❌ [MultiStep] STEP_ITEM INITIALIZATION ERROR:",{stepItemIndex:i,error:`Step_item ${i} is missing required data-answer attribute`,stepItemElement:{tagName:e.tagName,id:e.id,className:e.className,innerHTML:e.innerHTML.substring(0,200)+"..."},solution:"Add data-answer attribute to step_item element",example:'<div class="step_item" data-answer="some-unique-id">',troubleshooting:{checkElement:"element.getAttribute('data-answer')",allDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}}),null;const a=e.closest('[data-form="step"]');let s;a?(s=Array.from(t).indexOf(a),console.log("🔗 [MultiStep] Found parent step for step_item:",{stepItemId:n,parentStepIndex:s,parentStepId:-1!==s?le[s]?.id:"NOT_FOUND",parentElement:{tagName:a.tagName,id:a.id,className:a.className}})):console.warn("⚠️ [MultiStep] No parent step found for step_item:",{stepItemId:n,stepItemIndex:i,warning:'step_item should be nested within a [data-form="step"] element',suggestion:"Check DOM structure - step_item should be inside a step element"});const r={element:e,id:n,index:i,type:u(e,"data-step-type")||void 0,subtype:u(e,"data-step-subtype")||void 0,number:u(e,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:-1!==s?s:void 0};return console.log(`✅ [MultiStep] Step_item ${i} initialized successfully:`,{stepItemId:n,stepItemInfo:{id:r.id,type:r.type,subtype:r.subtype,number:r.number,parentStepIndex:r.parentStepIndex,parentStepId:void 0!==r.parentStepIndex?le[r.parentStepIndex]?.id:void 0}}),I.setStepInfo(n,{type:r.type,subtype:r.subtype,number:r.number,visible:!1,visited:!1}),r}).filter(e=>null!==e),d("Starting to hide all steps initially",{totalSteps:le.length,totalStepItems:de.length}),le.forEach((e,t)=>{d(`Hiding step ${t} (${e.id})`,{element:e.element,tagName:e.element.tagName,id:e.element.id,className:e.element.className,beforeHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:S(e.element)}}),f(e.element),d(`Step ${t} hidden`,{afterHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:S(e.element)}})}),de.forEach((e,t)=>{d(`Hiding stepItem ${t} (${e.id})`),f(e.element)}),d("Finished hiding all steps and step items"),function(e){const t=b(e,"click",s.NEXT_BTN,ge),i=b(e,"click",s.BACK_BTN,he),n=b(e,"click",s.SUBMIT_BTN,fe);re.push(t,i,n),d("Navigation listeners setup complete (skip handling delegated to skip module)")}(e),function(){const e=E.on("branch:change",({targetStepId:e})=>{d(`Received branch:change event, navigating to: ${e}`),Se(e)}),t=E.on("skip:request",({targetStepId:e})=>{console.log("🎯 [MultiStep] Received skip:request event",{targetStepId:e,currentStepId:I.getCurrentStep(),hasTargetStep:!!e});const t=I.getCurrentStep();t?(t&&ne(t,"User skipped",!0,e||void 0),e?(console.log("🚀 [MultiStep] Navigating to target step:",e),Se(e)):console.error("❌ [MultiStep] No target step provided in skip:request - this should not happen with the new validation")):console.error("❌ [MultiStep] No current step found for skip operation")});oe.push(e,t)}(),te(e),le.length>0){const t=e.querySelector(s.MULTISTEP),i=Ee((t?u(t,"data-start-step"):null)||le[0].id);ve(-1!==i?i:0)}else d("No steps found to initialize");se=!0,d("Multi-step initialization complete"),E.registerModule("multiStep")}function ue(e,t=!0){const i=u(e,"data-step-subtype");if(!i)return;d(`${t?"Enabling":"Disabling"} required fields for subtype: ${i}`);e.querySelectorAll("[data-require-for-subtypes]").forEach(e=>{const n=e.getAttribute("data-require-for-subtypes"),a=e;n&&n.split(",").map(e=>e.trim()).includes(i)&&(t?(a.required=!0,a.disabled=!1):(a.required=!1,a.disabled=!0,a.value=""))})}function me(e){d(`Attempting to show step_item: ${e}`);const t=de.find(t=>t.id===e);if(!t){const t=de.find(t=>u(t.element,"data-answer")===e);return t?(d(`Found step_item by data-answer: ${e}`),me(t.id)):void d(`Step item not found: ${e}`)}if(!le[t.parentStepIndex])return void d(`Parent step not found for step_item: ${e}`);d(`Showing step_item ${e} in parent step ${t.parentStepIndex}`);de.filter(e=>e.parentStepIndex===t.parentStepIndex).forEach(e=>{f(e.element),ue(e.element,!1),I.setStepVisibility(e.id,!1)}),h(t.element);let i=t.element.parentElement;for(;i&&!i.classList.contains("multi-form_step");)i.classList.contains("step_wrapper")&&(i.style.display="",i.style.visibility="",g(i,"hidden-step"),g(i,"hidden-step-item")),i=i.parentElement;ue(t.element,!0),I.setStepVisibility(e,!0),I.setStepInfo(e,{visited:!0}),d(`Successfully showed step_item: ${e}`)}function ge(e){console.log("🔍 NEXT BUTTON CLICK HANDLER TRIGGERED"),console.log("Event target:",e.target),console.log("Event currentTarget:",e.currentTarget);const t=e.target,i=t.getAttribute("data-skip");i?console.log("❌ CONFLICT DETECTED: Skip button triggered next button handler!",{skipAttribute:i,targetElement:t,targetTagName:t.tagName,targetClassName:t.className}):(console.log("✅ Legitimate next button click - proceeding with navigation"),e.preventDefault(),function(){if(!se)return void d("Multi-step module not initialized, ignoring goToNextStep call");d("=== GO TO NEXT STEP FUNCTION START ==="),console.log("🔍 GO TO NEXT STEP CALLED"),console.trace("Call stack for goToNextStep:");const e=Ne();if(!e)return void d("No current step found");d("Current step info",{stepId:e.id,stepIndex:pe,stepElement:{tagName:e.element.tagName,id:e.element.id,className:e.element.className}}),d("Evaluating skip conditions...");const t=pe+1;console.log(`🔍 ATTEMPTING TO NAVIGATE TO NEXT STEP - Current: ${pe}, Next: ${t}`),d("Sequential navigation logic",{currentIndex:pe,nextIndex:t,totalSteps:le.length,hasNextStep:t<le.length}),t<le.length?(d(`Going to next sequential step: index ${t}`),ve(t)):d("Already at last step");d("=== GO TO NEXT STEP FUNCTION END ===")}())}function he(e){e.preventDefault(),function(){const e=I.goToPreviousStep();if(e){const t=Ee(e);if(-1!==t)return void ve(t)}const t=pe-1;t>=0?ve(t):d("Already at first step")}()}function fe(e){if(!e.target.closest("form"))return void d("Form not found, preventing submission");if(!function(){for(const e of le)if(I.isStepVisible(e.id)&&!ye(e.element))return!1;return!0}())return e.preventDefault(),void d("Form validation failed, preventing submission");d("Form validation passed, allowing submission")}function Se(e){if(!se)return void console.error("❌ [MultiStep] Module not initialized, ignoring goToStepById call",{stepId:e,initialized:se,totalSteps:le.length,totalStepItems:de.length});console.log("🎯 [MultiStep] Navigation request received:",{targetStepId:e,currentStepIndex:pe,currentStepId:I.getCurrentStep(),totalSteps:le.length,totalStepItems:de.length});const t=le.map(e=>e.id),i=de.map(e=>e.id);console.log("📋 [MultiStep] Available navigation targets:",{searchingFor:e,parentStepIds:t,branchingStepItemIds:i,totalParentSteps:le.length,totalBranchingItems:de.length});const n=de.find(t=>t.id===e);if(n){if(console.log("✅ [MultiStep] Found as branching step_item:",{stepItemId:e,parentStepIndex:n.parentStepIndex,stepItemIndex:n.index,stepItemElement:{tagName:n.element.tagName,id:n.element.id,className:n.element.className,dataAnswer:u(n.element,"data-answer"),isVisible:S(n.element),parentStep:void 0!==n.parentStepIndex?le[n.parentStepIndex]?.id:"unknown"}}),void 0!==n.parentStepIndex){const i=le[n.parentStepIndex];if(!i)return void console.error("❌ [MultiStep] Parent step not found for step_item!",{stepItemId:e,parentStepIndex:n.parentStepIndex,availableSteps:t,totalSteps:le.length});console.log("🔄 [MultiStep] Navigating to parent step first:",{parentStepId:i.id,parentStepIndex:n.parentStepIndex,currentStepIndex:pe}),ve(n.parentStepIndex),console.log("🌿 [MultiStep] Showing branching option:",{stepItemId:e,withinParentStep:i.id}),me(e)}return void console.log("✅ [MultiStep] Successfully navigated to step_item:",e)}console.log("ℹ️ [MultiStep] Not found in branching step_items, checking regular steps");const a=Ee(e);if(console.log("🔍 [MultiStep] Regular step search result:",{stepId:e,foundIndex:a,isValidIndex:-1!==a,searchMethod:"findStepIndexById"}),-1!==a){const t=le[a];return console.log("✅ [MultiStep] Found as regular step:",{stepId:e,stepIndex:a,stepElement:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:u(t.element,"data-answer"),isVisible:S(t.element)}}),console.log("🚀 [MultiStep] Calling goToStep with index:",{stepIndex:a,stepId:t.id}),ve(a),void console.log("✅ [MultiStep] Successfully navigated to regular step:",e)}console.error("❌ [MultiStep] STEP NOT FOUND:",{searchedFor:e,searchedIn:"both regular steps and branching step_items",availableRegularSteps:t,availableBranchingItems:i,totalElements:{steps:le.length,stepItems:de.length},suggestion:`Check if element with data-answer="${e}" exists in DOM`,troubleshooting:{checkDataAnswer:`document.querySelector('[data-answer="${e}"]')`,listAllDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}});const s=document.querySelector(`[data-answer="${e}"]`);s&&console.error("🔍 [MultiStep] Step exists in DOM but not registered!",{stepId:e,domElement:{tagName:s.tagName,id:s.id,className:s.className,dataAnswer:u(s,"data-answer"),hasStepAttribute:s.hasAttribute("data-form"),stepAttribute:u(s,"data-form"),isVisible:s instanceof HTMLElement&&S(s)},possibleCause:"Element exists but was not properly initialized during module setup"})}function ye(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(S(t)){if(!t.value||""===t.value.trim())return d("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return d("Validation failed: invalid email format"),t.focus(),!1}}}return!0}function ve(e){if(!se)return void d("Multi-step module not initialized, ignoring goToStep call");if(console.log("🎯 [STEP NAVIGATION] Starting goToStep:",{requestedIndex:e,currentIndex:pe,totalSteps:le.length,stepExists:e>=0&&e<le.length}),e<0||e>=le.length)return void console.error("❌ [STEP NAVIGATION] Invalid step index:",{requestedIndex:e,validRange:"0 to "+(le.length-1),totalSteps:le.length,availableStepIds:le.map(e=>e.id)});const t=le[e];if(console.log("📋 [STEP NAVIGATION] Target step details:",{stepIndex:e,stepId:t.id,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:u(t.element,"data-answer"),innerHTML:t.element.innerHTML.length>0?`${t.element.innerHTML.substring(0,100)}...`:"EMPTY",hasContent:t.element.children.length>0,childrenCount:t.element.children.length},visibility:{isVisible:S(t.element),display:getComputedStyle(t.element).display,visibility:getComputedStyle(t.element).visibility,opacity:getComputedStyle(t.element).opacity,hasHiddenClass:t.element.classList.contains("hidden-step")}}),0===t.element.children.length&&""===t.element.innerHTML.trim()&&console.warn("⚠️ [STEP NAVIGATION] Target step appears to be empty!",{stepId:t.id,stepIndex:e,innerHTML:t.element.innerHTML,textContent:t.element.textContent,childrenCount:t.element.children.length,possibleIssue:"This step may be a blank wrapper"}),d(`Attempting to go to step index: ${e}`),-1!==pe){const e=le[pe];console.log("👋 [STEP NAVIGATION] Hiding current step:",{currentIndex:pe,currentStepId:e.id,beforeHide:{isVisible:S(e.element),display:getComputedStyle(e.element).display}}),Ie(pe),console.log("✅ [STEP NAVIGATION] Current step hidden:",{stepId:e.id,afterHide:{isVisible:S(e.element),display:getComputedStyle(e.element).display}})}console.log("👁️ [STEP NAVIGATION] Showing target step:",{stepIndex:e,stepId:t.id,beforeShow:{isVisible:S(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step")}}),be(e),console.log("✅ [STEP NAVIGATION] Target step shown:",{stepId:t.id,afterShow:{isVisible:S(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step"),actuallyVisible:t.element.offsetHeight>0&&t.element.offsetWidth>0}}),pe=e,I.setCurrentStep(t.id),Te(),console.log("🎉 [STEP NAVIGATION] Navigation complete:",{newCurrentIndex:pe,newCurrentStepId:t.id,formStateCurrentStep:I.getCurrentStep(),stepIsVisibleInDOM:S(t.element),stepHasContent:t.element.children.length>0||""!==t.element.innerHTML.trim()}),d(`Successfully navigated to step ${e} (${t.id})`)}function be(e){if(e<0||e>=le.length)return void d(`Invalid step index: ${e}`);const t=le[e];t?(console.log(`🔄 [MultiStep] Showing step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className}}),le.forEach((t,i)=>{i!==e&&(Ie(i),t.element.classList.remove("active-step"))}),h(t.element),t.element.classList.add("active-step"),I.setStepVisibility(t.id,!0),I.setStepInfo(t.id,{visited:!0}),pe=e,I.setCurrentStep(t.id),Te(),E.emit("step:change",{currentStepIndex:e,currentStepId:t.id}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now visible:`,{isVisible:S(t.element),hasActiveClass:t.element.classList.contains("active-step"),formStateVisible:I.isStepVisible(t.id),computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility}),S(t.element)||(console.error(`❌ [MultiStep] Step ${e} (${t.id}) is still not visible after showElement!`),function(e,t){const i=getComputedStyle(e),n=[];let a=e;for(;a&&a!==document.body;)n.push(a),a=a.parentElement;console.log(`🔍 [MultiStep] Diagnosing visibility issues for step ${t}:`,{targetElement:{tagName:e.tagName,id:e.id,className:e.className,computedDisplay:i.display,computedVisibility:i.visibility,computedOpacity:i.opacity,inlineDisplay:e.style.display,inlineVisibility:e.style.visibility,inlineOpacity:e.style.opacity,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)},parentChain:n.map(e=>({tagName:e.tagName,id:e.id,className:e.className,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,computedOpacity:getComputedStyle(e).opacity,hasHiddenClass:e.classList.contains("hidden-step")})),possibleConflicts:{hasDisplayNone:"none"===i.display,hasVisibilityHidden:"hidden"===i.visibility,hasZeroOpacity:"0"===i.opacity,hasHiddenClass:e.classList.contains("hidden-step"),parentWithDisplayNone:n.some(e=>"none"===getComputedStyle(e).display),parentWithVisibilityHidden:n.some(e=>"hidden"===getComputedStyle(e).visibility)}})}(t.element,t.id))):d(`Step not found at index: ${e}`)}function Ie(e){if(e<0||e>=le.length)return;const t=le[e];console.log(`🔄 [MultiStep] Hiding step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,hadActiveClass:t.element.classList.contains("active-step")}}),f(t.element),t.element.classList.remove("active-step"),I.setStepVisibility(t.id,!1),de.forEach(t=>{t.parentStepIndex===e&&(f(t.element),I.setStepVisibility(t.id,!1))}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now hidden:`,{isVisible:S(t.element),hasActiveClass:t.element.classList.contains("active-step"),formStateVisible:I.isStepVisible(t.id),computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility})}function Ee(e){return le.findIndex(t=>t.id===e)}function Ne(){return le[pe]||null}function Te(){const e=document.querySelector(s.NEXT_BTN),t=document.querySelector(s.BACK_BTN),i=document.querySelector(s.SUBMIT_BTN);if(!e||!t||!i)return;const n=0===pe,a=pe===le.length-1;t.style.display=n?"none":"",a?(e.style.display="none",i.style.display=""):(e.style.display="",i.style.display="none")}function Ae(){return{step:Ne(),index:pe,totalSteps:le.length,isFirstStep:0===pe,isLastStep:pe===le.length-1}}var ke=!1,we=[],Ce=[];function Me(e=document){ke&&(d("Summary already initialized, cleaning up first"),d("Resetting summary functionality"),we.forEach(e=>e()),we=[],Ce.forEach(e=>{_e(e.element,"")}),Ce=[],ke=!1,d("Summary reset complete")),d("Initializing summary functionality");const t=p(s.SUMMARY_FIELD,e);d(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=u(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=u(e,"data-join"),a=n&&n in r.JOIN_SEPARATOR?n:"space",s=u(e,"data-summary-type")||void 0,o=u(e,"data-summary-subtype")||void 0,l=u(e,"data-summary-number")||void 0,p={element:e,fieldNames:i,joinType:a,type:s,subtype:o,number:l};Ce.push(p),d("Summary field configured",{fieldNames:i,joinType:a,type:s,subtype:o,number:l})})}(t),function(e){const t=b(e,"input",s.STEP_FIELD_NAME,Pe),i=b(e,"change",s.STEP_FIELD_NAME,Pe),n=b(e,"blur",s.STEP_FIELD_NAME,Pe);we.push(t,i,n)}(e),xe(),ke=!0,d("Summary initialization complete")}function Pe(e,t){if(!y(t))return;const i=u(t,"data-step-field-name");if(!i)return;const n=v(t);d(`Summary field changed: ${i}`,{value:n}),I.setField(i,n),$e(i)}function $e(e){Ce.forEach(t=>{t.fieldNames.includes(e)&&Ve(t)})}function Le(){d("Updating all summaries"),xe()}function xe(){Ce.forEach(e=>{Ve(e)})}function Ve(e){const t=[];e.fieldNames.forEach(e=>{const i=I.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=r.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);_e(e.element,i),d("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function _e(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}function Fe(e){e?(d("Clearing specific summary fields",e),I.clearFields(e),e.forEach(e=>{$e(e)})):(d("Clearing all summaries"),I.clear(),xe())}function Oe(){const e={};return Ce.forEach((t,i)=>{const n=t.type&&t.subtype&&t.number?`${t.type}-${t.subtype}-${t.number}`:`summary-${i}`;e[n]={hasContent:(t.element.textContent||"").trim().length>0}}),e}var De,ze=class e{constructor(){this.initialized=!1,this.rootElement=document,d("FormLibrary instance created")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e=document){this.initialized&&(d("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,d("Initializing FormLibrary with enhanced skip functionality",{root:e===document?"document":"custom element"});const t=e.querySelectorAll(s.MULTISTEP),i=e.querySelectorAll(s.LOGIC),n=e.querySelectorAll(s.STEP);if(d("Form detection results",{multistepForms:t.length,logicForms:i.length,stepElements:n.length}),0!==t.length||0!==n.length)try{V(e),B(e),i.length>0&&A(e),(t.length>0||n.length>0)&&ce(e),Me(e),this.initialized=!0,d("FormLibrary initialization complete with enhanced skip functionality"),this.logCurrentState()}catch(e){throw d("FormLibrary initialization failed",e),e}else d("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){d("Destroying FormLibrary");try{$(),ae()}catch(e){d("Error during FormLibrary destruction",e)}I.clear(),l.clear(),this.initialized=!1,d("FormLibrary destruction complete")}else d("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:I.getDebugInfo(),branching:{initialized:N,activeConditions:I.getBranchPath().activeConditions},multiStep:{initialized:se,currentStepIndex:pe,totalSteps:le.length,steps:le.map(e=>({id:e.id,index:e.index,visible:S(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:{initialized:z,fieldValidations:Array.from(q.entries()).reduce((e,[t,i])=>(e[t]={isValid:i.isValid,errorMessage:i.errorMessage,rules:i.rules.map(e=>e.type)},e),{})},errors:D(),summary:Oe(),skip:{initialized:X,skipRules:Array.from(Q.entries()).map(([e,t])=>({stepId:e,condition:t.condition,targetStep:t.targetStep,reason:t.reason,allowUndo:t.allowUndo,clearFields:t.clearFields})),skipSections:Array.from(ee.entries()).map(([e,t])=>({sectionId:e,steps:t.steps,condition:t.condition,reason:t.reason})),currentSkipStats:I.getSkipStats(),skippedSteps:I.getSkippedSteps(),skipHistory:I.getSkipHistory()}}}logCurrentState(){d("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return d("Cannot validate form - library not initialized"),!1;d("Validating entire form");const e=W();return d("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){d("Resetting form to initial state"),O(),I.clear(),Fe();try{ve(0)}catch(e){d("Could not go to first step during reset",e)}d("Form reset complete")}else d("Cannot reset form - library not initialized")}getFormData(){return I.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{I.setField(e,t)}),Le(),d("Form data set",e)}}.getInstance(),Re=ze;if("undefined"!=typeof window){const e=()=>{const e=document.querySelectorAll(s.MULTISTEP),t=document.querySelectorAll(s.STEP);(e.length>0||t.length>0)&&(d("Auto-initializing FormLibrary on DOM ready"),ze.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}return"undefined"!=typeof window&&(window.FormLib=ze,d("FormLib attached to window for debugging")),De=a,((a,s,r,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let l of i(s))n.call(a,l)||l===r||e(a,l,{get:()=>s[l],enumerable:!(o=t(s,l))||o.enumerable});return a})(e({},"__esModule",{value:!0}),De)})();