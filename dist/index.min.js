"use strict";var FormLib=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(a,{FormState:()=>E,clearAllErrors:()=>ee,clearError:()=>Q,clearSummary:()=>Ie,default:()=>Fe,getCurrentStepInfo:()=>G,getNextStep:()=>C,goToStep:()=>U,initBranching:()=>T,initErrors:()=>X,initMultiStep:()=>k,initSummary:()=>ge,initValidation:()=>re,resetBranching:()=>V,showError:()=>J,showStep:()=>H,updateSummary:()=>ve,validateAllVisibleFields:()=>me,validateField:()=>oe,validateStep:()=>ue});var r={MULTISTEP:'[data-form="multistep"]',LOGIC:"[data-logic]",STEP:'[data-form="step"]',ANSWER:"[data-answer]",NEXT_BTN:'[data-form="next-btn"]',BACK_BTN:'[data-form="back-btn"]',SUBMIT:'[data-form="submit"]',SKIP:"[data-skip]",ERROR_DISPLAY:'[data-form="error"]',GO_TO:"[data-go-to]",SHOW_IF:"[data-show-if]",SKIP_BTN:'[data-form="skip-btn"]',SUBMIT_BTN:'[data-form="submit-btn"]',STEP_TYPE:"[data-step-type]",STEP_SUBTYPE:"[data-step-subtype]",STEP_NUMBER:"[data-step-number]",STEP_FIELD_NAME:"[data-step-field-name]",SUMMARY_FIELD:"[data-summary-field]",SUMMARY_TYPE:"[data-summary-type]",SUMMARY_SUBTYPE:"[data-summary-subtype]",SUMMARY_NUMBER:"[data-summary-number]",JOIN:"[data-join]",REQUIRED:"[required]",ERROR_MESSAGE:"[data-error-message]",VALIDATE:"[data-validate]"},s={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},o={ACTIVE_STEP:"active-step",HIDDEN_STEP:"hidden-step",HIDDEN_STEP_ITEM:"hidden-step-item",ERROR_FIELD:"error-field",ACTIVE_ERROR:"active-error",DISABLED:"disabled"},l=new Map;function d(e,t){if(!s.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${s.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function c(e,t=document){if(t===document){const i=`all:${e}`;if(l.has(i))return l.get(i);const n=t.querySelectorAll(e);return l.set(i,n),n}return t.querySelectorAll(e)}function u(e,t=document){if(t===document){const i=`single:${e}`;if(l.has(i))return l.get(i);const n=t.querySelector(e);return l.set(i,n),n}return t.querySelector(e)}function m(e,t){return e.getAttribute(t)}function p(e,t){e.classList.add(t)}function f(e,t){e.classList.remove(t)}function h(e){f(e,"hidden-step"),e.style.display="",d("Showing element:",e)}function g(e){p(e,"hidden-step"),e.style.display="none",d("Hiding element:",e)}function y(e){return"none"!==e.style.display&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function S(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function v(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function b(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}var E=class e{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},d("FormState initialized")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setField(e,t){const i=this.data[e];this.data[e]=t,d(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},d("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&d("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),d(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),d(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),d(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e){this.branchPath.skippedSteps.includes(e)||(this.branchPath.skippedSteps.push(e),d(`Step skipped: ${e}`,this.branchPath.skippedSteps))}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,d(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(){const e={};return Object.entries(this.data).forEach(([t,i])=>{e[t]=i}),e}onFieldChange(e,t,i){t!==i&&d(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,d(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}.getInstance(),A=!1,I=[];function T(e=document){A&&(d("Branching already initialized, cleaning up first"),V()),d("Initializing branching logic"),function(e){const t=b(e,"change",r.GO_TO,P),i=b(e,"input",r.GO_TO,P),n=b(e,"click",r.GO_TO,P),a=b(e,"click","label.radio_field, .w-radio, .radio_button-skip-step, .w-form-formradioinput, .w-radio-input",$);I.push(t,i,n,a)}(e),A=!0,d("Branching initialization complete")}function $(e,t){let i=null;if(i=t.querySelector('input[type="radio"][data-go-to]'),!i){const e=t.closest("label");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(!i){const e=t.closest(".radio_field, .w-radio, .radio_component");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(i&&m(i,"data-go-to")){e.preventDefault(),e.stopPropagation(),i.checked=!0,F(i);const t=new Event("change",{bubbles:!0});Object.defineProperty(t,"target",{value:i}),P(t,i)}}function P(e,t){if(!S(t))return;const i=m(t,"data-go-to");if(i&&!function(e){return!!e&&(!!/^[a-zA-Z0-9_-]+$/.test(e)||(d("Invalid data-go-to value format",{goToValue:e}),!1))}(i))return void d("Skipping branch trigger due to invalid data-go-to value",{goToValue:i});const n=v(t);d("Branch trigger activated",{element:t,goTo:i,value:n,type:t.type||t.tagName});const a=t.name||m(t,"data-step-field-name");a&&E.setField(a,n);try{if(t instanceof HTMLInputElement)if("radio"===t.type&&t.checked){if(!i)return void d("Radio button has no data-go-to attribute, skipping navigation");!function(e){if(!e.name)return;document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(t=>{const i=t,n=m(i,"data-go-to");var a;i!==e&&n&&(w(n),a=n,E.setStepVisibility(a,!1),d(`Set step item visibility to false in FormState: ${a}`))})}(t),F(t),_(i,t.value),function(e){if(!e)return void d("No stepItemId provided to triggerStepItemVisibility");d(`Triggering visibility for step_item: ${e}`),function(e){E.setStepVisibility(e,!0),d(`Set step item visibility to true in FormState: ${e}`)}(e)}(i)}else"checkbox"===t.type?i&&(t.checked?_(i,t.value):w(i)):"radio"!==t.type&&"checkbox"!==t.type&&i&&(n?_(i,n):w(i));else i&&(n?_(i,n):w(i))}catch(e){d("Error handling branch trigger",{error:e,element:t})}const r=E.getBranchPath().activeConditions;Object.keys(r).length>0&&L()}function F(e){const t=m(e,"fs-inputactive-class")||"is-active-inputactive";if(e.name){document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(i=>{const n=i,a=n.closest("label");n!==e&&(n.classList.remove(t),a?.classList.remove(t))})}e.classList.add(t);const i=e.closest("label");i?.classList.add(t)}function _(e,t){e&&E.setActiveCondition(e,t)}function w(e){e&&(d(`Deactivating branch: ${e}`),E.setActiveCondition(e,null),function(e){const t=[];document.querySelectorAll(`[data-go-to="${e}"]`).forEach(e=>{S(e)&&e.name&&t.push(e.name)}),t.length>0&&E.clearFields(t)}(e),L())}function C(e){const t=E.getBranchPath().activeConditions;return Object.keys(t).find(e=>t[e])||null}function L(){const e=c(r.STEP),t=E.getBranchPath().activeConditions;e.forEach(e=>{const i=m(e,"data-answer"),n=function(e,t){if(!e)return!0;const i=u(`[data-answer="${e}"]`);if(i){const e=m(i,"data-show-if");if(e){const i=function(e,t){if(!e||"string"!=typeof e)return d("Invalid condition provided",{condition:e}),!1;try{const i=e.trim();return i.includes(",")?i.split(",").map(e=>e.trim()).some(e=>!!t[e]):i.includes("&")?i.split("&").map(e=>e.trim()).every(e=>!!t[e]):!!t[i]}catch(t){return d("Error evaluating condition",{condition:e,error:t}),!1}}(e,t);return i}}return!1}(i,t);i&&E.setStepVisibility(i,n)})}function V(){d("Resetting branching logic"),I.forEach(e=>e()),I=[];const e=E.getBranchPath().activeConditions;Object.keys(e).forEach(e=>{E.setActiveCondition(e,null)});c(r.ANSWER).forEach(e=>{const t=e;t.style.display="none",t.classList.add("hidden-step")}),A=!1,d("Branching reset complete")}var N=!1,z=[],M=[],R=[],O=0;function k(e=document){N&&(d("MultiStep already initialized, cleaning up first"),z.forEach(e=>e()),z=[],M=[],R=[],O=0,N=!1,d("Multi-step module reset")),d("Initializing multi-step navigation with step/step_item architecture");const t=c(r.STEP,e);d(`Found ${t.length} parent steps`),M=Array.from(t).map((e,t)=>{const i=e,n=m(e,"data-answer")||`step-${t}`,a={element:i,id:n,index:t,type:m(e,"data-step-type")||void 0,subtype:m(e,"data-step-subtype")||void 0,number:m(e,"data-step-number")||void 0,isStepItem:!1};return E.setStepInfo(n,{type:a.type,subtype:a.subtype,number:a.number,visible:0===t,visited:!1}),a}),R=[],M.forEach((e,t)=>{e.element.querySelectorAll(".step_item, .step-item").forEach(e=>{const i=e,n=m(e,"data-answer");if(!n)return void d(`Step item ${t} in parent step ${t} missing required data-answer attribute`);const a={element:i,id:n,index:R.length,type:m(e,"data-step-type")||void 0,subtype:m(e,"data-step-subtype")||void 0,number:m(e,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:t};E.setStepInfo(n,{type:a.type,subtype:a.subtype,number:a.number,visible:!1,visited:!1}),R.push(a)})}),M.forEach((e,t)=>{g(e.element)}),R.forEach((e,t)=>{g(e.element)}),function(e){const t=b(e,"click",r.NEXT_BTN,D),i=b(e,"click",r.BACK_BTN,x),n=b(e,"click",r.SKIP_BTN,B),a=b(e,"click",r.SUBMIT_BTN,q);z.push(t,i,n,a)}(e),M.length>0&&U(0),N=!0,d("Multi-step initialization complete",{parentStepCount:M.length,stepItemCount:R.length})}function D(e){e.preventDefault(),Z()}function x(e){e.preventDefault(),function(){const e=E.goToPreviousStep();if(e){const i=(t=e,M.findIndex(e=>e.id===t));if(-1!==i)return void U(i)}var t;const i=O-1;i>=0?U(i):d("Already at first step")}()}function B(e){e.preventDefault();const t=Y()?.element;if(t){Array.from(t.querySelectorAll("input, select, textarea")).forEach(e=>{e instanceof HTMLInputElement&&("checkbox"===e.type||"radio"===e.type)?e.checked=!1:e.value="",e.name&&E.setField(e.name,null)})}Z(!0)}function q(e){if(!e.target.closest("form"))return void d("Form not found, preventing submission");if(!function(){for(const e of M)if(E.isStepVisible(e.id)&&!j(e.element))return!1;return!0}())return e.preventDefault(),void d("Form validation failed, preventing submission");d("Form validation passed, allowing submission")}function j(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(y(t)){if(!t.value||""===t.value.trim())return d("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return d("Validation failed: invalid email format"),t.focus(),!1}}}return!0}function U(e){if(d(`Attempting to go to step index: ${e}`),e<0||e>=M.length)return void d(`Invalid step index: ${e}`);-1!==O&&O<M.length&&function(e){if(e<0||e>=M.length)return;const t=M[e];g(t.element),E.setStepVisibility(t.id,!1),R.forEach(t=>{t.parentStepIndex===e&&g(t.element)}),d(`Hiding step ${e} (${t.id})`)}(O),H(e),O=e;const t=M[e];E.setCurrentStep(t.id),function(){const e=document.querySelector(r.NEXT_BTN),t=document.querySelector(r.BACK_BTN),i=document.querySelector(r.SUBMIT_BTN);if(!e||!t||!i)return;const n=0===O,a=O===M.length-1;t.style.display=n?"none":"",a?(e.style.display="none",i.style.display=""):(e.style.display="",i.style.display="none")}()}function H(e){if(e<0||e>=M.length)return;const t=M[e];h(t.element),E.setStepVisibility(t.id,!0),R.forEach(t=>{t.parentStepIndex===e&&E.isStepVisible(t.id)&&h(t.element)}),d(`Showing step ${e} (${t.id})`)}function Z(e=!1){if(!Y())return void d("No current step found");const t=O+1;t<M.length?U(t):d("Already at last step")}function Y(){return M[O]||null}function G(){return{step:Y(),index:O,totalSteps:M.length,isFirstStep:0===O,isLastStep:O===M.length-1}}var K=new Map,W=new Map;function X(e=document){d("Initializing error handling");e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||m(e,"data-step-field-name");t&&K.set(t,{fieldName:t,element:e,customMessage:m(e,"data-error-message")||void 0})}),d(`Error handling initialized for ${K.size} fields`)}function J(e,t){const i=K.get(e);if(!i)return void d(`Cannot show error for unknown field: ${e}`);const n=t||i.customMessage||"This field has an error";d(`Showing error for field: ${e}`,{message:n}),p(i.element,o.ERROR_FIELD);const a=function(e){if(!e||!e.element)return d("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return d(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`${r.ERROR_DISPLAY}[data-field="${e.fieldName}"]`)}catch(t){return d(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.setAttribute("data-form","error"),t.setAttribute("data-field",e.fieldName);const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),d(`Created error element for field: ${e.fieldName}`)}catch(t){return d(`Error creating error element for field: ${e.fieldName}`,t),null}return t}(i);a&&(a.textContent=n,p(a,o.ACTIVE_ERROR),i.errorElement=a),function(e){const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||(e.scrollIntoView({behavior:"smooth",block:"center"}),d(`Scrolled to field with error: ${e.name||"unnamed"}`))}(i.element)}function Q(e){const t=K.get(e);t?(d(`Clearing error for field: ${e}`),f(t.element,o.ERROR_FIELD),t.errorElement&&(t.errorElement.textContent="",f(t.errorElement,o.ACTIVE_ERROR))):d(`Cannot clear error for unknown field: ${e}`)}function ee(){d("Clearing all field errors"),K.forEach((e,t)=>{Q(t)})}function te(){const e={};return W.forEach((t,i)=>{e[i]={message:t.message}}),e}var ie=!1,ne=[],ae=new Map;function re(e=document){ie&&(d("Validation already initialized, cleaning up first"),d("Resetting validation"),ne.forEach(e=>e()),ne=[],d("Clearing all field validation"),ae.forEach((e,t)=>{!function(e){const t=ae.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,ce(t.element,!0),d(`Cleared validation for field: ${e}`))}(t)}),ae.clear(),ie=!1,d("Validation reset complete")),d("Initializing form validation");const t=c("input, select, textarea",e);d(`Found ${t.length} form inputs`),t.forEach(e=>{if(!S(e))return;const t=e,i=t.name||m(e,"data-step-field-name");if(!i)return void d("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:m(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:m(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=m(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=m(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=m(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(ae.set(i,{element:e,rules:n,isValid:!0}),d(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):d(`No validation rules found for field: ${i}`)}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}((...e)=>{se(e[0],e[1])},s.VALIDATION_DELAY),i=b(e,"input","input, select, textarea",t),n=b(e,"blur","input, select, textarea",se),a=b(e,"change","input, select, textarea",se);ne.push(i,n,a)}(e),ie=!0,d("Validation initialization complete")}function se(e,t){if(!S(t))return;const i=t,n=i.name||m(t,"data-step-field-name");if(!n)return void d("Skipping validation - no field name found",{element:t,name:i.name,dataStepFieldName:m(t,"data-step-field-name")});const a=t.closest(r.STEP);if(a){const e=m(a,"data-answer");if(e&&!E.isStepVisible(e))return void d(`Skipping validation for field in hidden step: ${n}`)}oe(n)}function oe(e){const t=ae.get(e);if(!t)return d(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return d(`No element found for field: ${e}`),!0;const n=v(i);d(`Validating field: ${e}`,{value:n,elementExists:!!i});for(const a of t.rules){const{isValid:r,message:s}=de(n,a);if(!r)return t.isValid=!1,t.errorMessage=s||"Invalid field",J(e,t.errorMessage),ce(i,!1,t.errorMessage),!1}return t.isValid=!0,Q(e),ce(i,!0),!0}var le={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1\s?)?(\([0-9]{3}\)|[0-9]{3})[\s\-]?[0-9]{3}[\s\-]?[0-9]{4}$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,zipCode:/^\d{5}(-\d{4})?$/,zipCodeCA:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,creditCard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/,ssn:/^\d{3}-?\d{2}-?\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/};function de(e,t){switch(t.type){case"required":return{isValid:Array.isArray(e)?e.length>0:!!e&&""!==String(e).trim(),message:t.message};case"email":return{isValid:le.email.test(String(e)),message:t.message||"Please enter a valid email address"};case"phone":const i=String(e).replace(/[\s\-\(\)]/g,"");return{isValid:le.phone.test(i)||le.phoneUS.test(String(e)),message:t.message||"Please enter a valid phone number"};case"min":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length>=t.value,message:t.message||`Minimum ${t.value} characters required`};case"max":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length<=t.value,message:t.message||`Maximum ${t.value} characters allowed`};case"pattern":return t.value instanceof RegExp?{isValid:t.value.test(String(e)),message:t.message||"Please enter a valid format"}:{isValid:!0};case"custom":if(!t.validator)return{isValid:!0};try{return{isValid:t.validator(e),message:t.message||"Invalid value"}}catch(e){return d("Error in custom validator",{error:e,rule:t}),{isValid:!1,message:"Validation error occurred"}}default:return{isValid:!0}}}function ce(e,t,i){const n=e.name||m(e,"data-step-field-name");n&&(t?Q(n):J(n,i))}function ue(e){const t=u(`[data-answer="${e}"]`);if(!t)return d(`Step not found with data-answer="${e}"`),!0;if(!E.isStepVisible(e))return d(`Skipping validation for hidden step: ${e}`),!0;d(`Validating step: ${e}`);const i=t.querySelectorAll("input, select, textarea");let n=!0;return i.forEach(e=>{if(!S(e))return;const t=e.name||m(e,"data-step-field-name");if(t){oe(t)||(n=!1)}}),d(`Step validation result: ${e}`,{isValid:n}),n}function me(){d("Validating all visible fields");let e=!0;const t={};for(const[i,n]of ae){const a=n.element.closest(r.STEP);let s=!0;if(a){const e=m(a,"data-answer");e&&!E.isStepVisible(e)&&(s=!1)}if(s){const n=oe(i);t[i]=n,n||(e=!1)}}return d("All visible fields validation complete",{allValid:e,results:t}),e}var pe=!1,fe=[],he=[];function ge(e=document){pe&&(d("Summary already initialized, cleaning up first"),d("Resetting summary functionality"),fe.forEach(e=>e()),fe=[],he.forEach(e=>{Ae(e.element,"")}),he=[],pe=!1,d("Summary reset complete")),d("Initializing summary functionality");const t=c(r.SUMMARY_FIELD,e);d(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=m(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=m(e,"data-join"),a=n&&n in s.JOIN_SEPARATOR?n:"space",r=m(e,"data-summary-type")||void 0,o=m(e,"data-summary-subtype")||void 0,l=m(e,"data-summary-number")||void 0,c={element:e,fieldNames:i,joinType:a,type:r,subtype:o,number:l};he.push(c),d("Summary field configured",{fieldNames:i,joinType:a,type:r,subtype:o,number:l})})}(t),function(e){const t=b(e,"input",r.STEP_FIELD_NAME,ye),i=b(e,"change",r.STEP_FIELD_NAME,ye),n=b(e,"blur",r.STEP_FIELD_NAME,ye);fe.push(t,i,n)}(e),be(),pe=!0,d("Summary initialization complete")}function ye(e,t){if(!S(t))return;const i=m(t,"data-step-field-name");if(!i)return;const n=v(t);d(`Summary field changed: ${i}`,{value:n}),E.setField(i,n),Se(i)}function Se(e){he.forEach(t=>{t.fieldNames.includes(e)&&Ee(t)})}function ve(){d("Updating all summaries"),be()}function be(){he.forEach(e=>{Ee(e)})}function Ee(e){const t=[];e.fieldNames.forEach(e=>{const i=E.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=s.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);Ae(e.element,i),d("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function Ae(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}function Ie(e){e?(d("Clearing specific summary fields",e),E.clearFields(e),e.forEach(e=>{Se(e)})):(d("Clearing all summaries"),E.clear(),be())}function Te(){const e={};return he.forEach((t,i)=>{const n=t.type&&t.subtype&&t.number?`${t.type}-${t.subtype}-${t.number}`:`summary-${i}`;e[n]={hasContent:(t.element.textContent||"").trim().length>0}}),e}var $e,Pe=class e{constructor(){this.initialized=!1,this.rootElement=document,d("FormLibrary instance created")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e=document){this.initialized&&(d("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,d("Initializing FormLibrary",{root:e===document?"document":"custom element"});const t=e.querySelectorAll(r.MULTISTEP),i=e.querySelectorAll(r.LOGIC),n=e.querySelectorAll(r.STEP);if(d("Form detection results",{multistepForms:t.length,logicForms:i.length,stepElements:n.length}),0!==t.length||0!==n.length)try{X(e),re(e),i.length>0&&T(e),(t.length>0||n.length>0)&&k(e),ge(e),this.initialized=!0,d("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw d("FormLibrary initialization failed",e),e}else d("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){d("Destroying FormLibrary");try{V()}catch(e){d("Error during FormLibrary destruction",e)}E.clear(),l.clear(),this.initialized=!1,d("FormLibrary destruction complete")}else d("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:E.getDebugInfo(),branching:{initialized:A,activeConditions:E.getBranchPath().activeConditions,branchPath:E.getBranchPath()},multiStep:{initialized:N,currentStepIndex:O,totalSteps:M.length,steps:M.map(e=>({id:e.id,index:e.index,visible:y(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:{initialized:ie,fieldValidations:Array.from(ae.entries()).reduce((e,[t,i])=>(e[t]={isValid:i.isValid,errorMessage:i.errorMessage,rules:i.rules.map(e=>e.type)},e),{})},errors:te(),summary:Te()}}logCurrentState(){d("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return d("Cannot validate form - library not initialized"),!1;d("Validating entire form");const e=me();return d("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){d("Resetting form to initial state"),ee(),E.clear(),Ie();try{U(0)}catch(e){d("Could not go to first step during reset",e)}d("Form reset complete")}else d("Cannot reset form - library not initialized")}getFormData(){return E.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{E.setField(e,t)}),ve(),d("Form data set",e)}}.getInstance(),Fe=Pe;if("undefined"!=typeof window){const e=()=>{const e=document.querySelectorAll(r.MULTISTEP),t=document.querySelectorAll(r.STEP);(e.length>0||t.length>0)&&(d("Auto-initializing FormLibrary on DOM ready"),Pe.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}return"undefined"!=typeof window&&(window.FormLib=Pe,d("FormLib attached to window for debugging")),$e=a,((a,r,s,o)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let l of i(r))n.call(a,l)||l===s||e(a,l,{get:()=>r[l],enumerable:!(o=t(r,l))||o.enumerable});return a})(e({},"__esModule",{value:!0}),$e)})();