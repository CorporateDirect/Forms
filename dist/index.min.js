"use strict";var FormLib=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};((t,n)=>{for(var i in n)e(t,i,{get:n[i],enumerable:!0})})(a,{FormState:()=>r,clearAllErrors:()=>fe,clearError:()=>ge,clearSummary:()=>Re,default:()=>Be,getCurrentStepInfo:()=>de,goToStep:()=>ae,initBranching:()=>F,initErrors:()=>me,initMultiStep:()=>j,initSummary:()=>Ce,initValidation:()=>Ie,resetBranching:()=>R,showError:()=>pe,showStep:()=>se,updateSummary:()=>Ve,validateAllVisibleFields:()=>Me,validateField:()=>Te,validateStep:()=>we});var s={MULTISTEP:'[data-form="multistep"]',LOGIC:"[data-logic]",STEP:'[data-form="step"]',ANSWER:"[data-answer]",GO_TO:"[data-go-to]",SKIP:"[data-skip]",NEXT_BTN:'[data-form="next-btn"]',BACK_BTN:'[data-form="back-btn"]',SUBMIT:'[data-form="submit"]',SUBMIT_BTN:'[data-form="submit-btn"]',ERROR_DISPLAY:'[data-form="error"]',SHOW_IF:"[data-show-if]",STEP_TYPE:"[data-step-type]",STEP_SUBTYPE:"[data-step-subtype]",STEP_NUMBER:"[data-step-number]",STEP_FIELD_NAME:"[data-step-field-name]",SUMMARY_FIELD:"[data-summary-field]",SUMMARY_TYPE:"[data-summary-type]",SUMMARY_SUBTYPE:"[data-summary-subtype]",SUMMARY_NUMBER:"[data-summary-number]",JOIN:"[data-join]",REQUIRED:"[required]",ERROR_MESSAGE:"[data-error-message]",VALIDATE:"[data-validate]",ALL_INPUTS:"input, select, textarea"},l={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},o={ACTIVE_STEP:"active-step",HIDDEN_STEP:"hidden-step",HIDDEN_STEP_ITEM:"hidden-step-item",ERROR_FIELD:"error-field",ACTIVE_ERROR:"active-error",DISABLED:"disabled"},r=class e{constructor(){this.data={},u("FormState initialized (simplified)")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setField(e,t){const n=this.data[e];this.data[e]=t,u(`Field updated: ${e}`,{oldValue:n,newValue:t})}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},u("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&u("Fields cleared due to branch change",t)}getDebugInfo(){return{data:this.data,fieldCount:Object.keys(this.data).length}}}.getInstance(),d=new class{constructor(){this.events={},this.moduleStates=new Map}registerModule(e){this.moduleStates.set(e,{initialized:!0,name:e})}unregisterModule(e){this.moduleStates.delete(e)}isModuleInitialized(e){return this.moduleStates.get(e)?.initialized??!1}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.off(e,t)}}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){const n=String(e);if(console.log(`🔄 [FormEvents] Emitting event: ${n}`,{eventData:t,timestamp:(new Date).toISOString(),hasListeners:!!this.events[e],listenerCount:this.events[e]?.length||0}),!this.events[e])return void console.warn(`⚠️ [FormEvents] No listeners registered for event: ${n}`);if("skip:request"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${n}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});if("branch:change"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${n}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});let i=0,a=0;this.events[e].forEach((s,l)=>{try{console.log(`📡 [FormEvents] Calling listener ${l+1}/${this.events[e].length} for ${n}`),s(t),i++,console.log(`✅ [FormEvents] Listener ${l+1} completed successfully for ${n}`)}catch(i){a++,console.error(`💥 [FormEvents] LISTENER ERROR ${l+1}/${this.events[e].length} for '${n}':`,{error:i,errorMessage:i instanceof Error?i.message:String(i),errorStack:i instanceof Error?i.stack:void 0,eventData:t,listenerIndex:l})}}),console.log(`📊 [FormEvents] Event ${n} completed:`,{totalListeners:this.events[e].length,successful:i,failed:a,eventData:t})}},c=new Map;function u(e,t){if(!l.DEBUG)return;const n=(new Date).toISOString().split("T")[1].split(".")[0],i=`${l.LOG_PREFIX} [${n}]`;void 0!==t?console.log(`${i} ${e}`,t):console.log(`${i} ${e}`)}function m(e,t=document){if(t===document){const n=`all:${e}`;if(c.has(n))return c.get(n);const i=t.querySelectorAll(e);return c.set(n,i),i}return t.querySelectorAll(e)}function p(e,t=document){if(t===document){const n=`single:${e}`;if(c.has(n))return c.get(n);const i=t.querySelector(e);return c.set(n,i),i}return t.querySelector(e)}function g(e,t){return e.getAttribute(t)}function f(e,t){e.classList.add(t)}function h(e,t){e.classList.remove(t)}function y(e){h(e,"hidden-step");const t=e.getAttribute("data-original-display")||"";if(t&&"none"!==t)e.style.setProperty("display",t,"important");else{const t=e.classList.contains("flex")||e.classList.contains("d-flex")||e.classList.contains("step_wrapper")||"flex"===getComputedStyle(e).display;e.style.setProperty("display",t?"flex":"block","important")}e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),console.log("🔄 [Utils] Showing element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t||"none stored",currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:v(e)})}function S(e){const t=getComputedStyle(e).display;t&&"none"!==t&&e.setAttribute("data-original-display",t),f(e,"hidden-step"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),console.log("🔄 [Utils] Hiding element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t,currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:v(e)})}function v(e){const t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function I(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function b(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function T(e,t,n,i){const a=e=>{const t=e.target?.closest(n);t&&i(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}var E=!1,N=[];function A(e,t){if(!I(t))return;const n=x(t),i=b(t);n&&(r.setField(n,i),u("Field input detected",{fieldName:n,value:i,eventType:"input"}),d.emit("field:input",{fieldName:n,value:i,element:t,eventType:"input"}))}function w(e,t){if(!I(t))return;const n=x(t),i=b(t);n&&(r.setField(n,i),u("Field change detected",{fieldName:n,value:i,eventType:"change"}),d.emit("field:change",{fieldName:n,value:i,element:t,eventType:"change"}))}function M(e,t){if(!I(t))return;const n=x(t),i=b(t);n&&(u("Field blur detected",{fieldName:n,value:i,eventType:"blur"}),d.emit("field:blur",{fieldName:n,value:i,element:t,eventType:"blur"}))}function x(e){return e.name||g(e,"data-step-field-name")||null}function $(){E?(u("Resetting field coordinator"),N.forEach(e=>e()),N=[],E=!1,u("Field coordinator reset complete")):u("Field coordinator not initialized, nothing to reset")}var L=!1,C=[];function F(e=document){L&&(u("Branching already initialized, cleaning up first"),R()),console.log("🌿 [Branching] === INITIALIZATION START ==="),console.log("🔍 [Branching] Root element:",{isDocument:e===document,elementType:e.constructor.name}),u("Initializing branching logic");const t=e.querySelectorAll(s.MULTISTEP),n=e.querySelectorAll(s.STEP);console.log("📋 [Branching] Form detection:",{multistepForms:t.length,stepElements:n.length,multistepSelector:s.MULTISTEP,stepSelector:s.STEP}),0===t.length&&0===n.length&&(console.warn("⚠️ [Branching] Warning: Branching initialized but no multi-step forms found. Branch events may not be handled."),u("Warning: Branching initialized but no multi-step forms found. Branch events may not be handled."));const i=e.querySelectorAll(s.GO_TO);console.log("🎯 [Branching] data-go-to elements found:",{count:i.length,selector:s.GO_TO,elements:Array.from(i).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,dataGoTo:e.getAttribute("data-go-to"),name:e.name,type:e.type||e.tagName,value:e.value}))});const a=e.querySelectorAll(s.ANSWER);console.log("🎯 [Branching] data-answer elements found:",{count:a.length,selector:s.ANSWER,elements:Array.from(a).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,dataAnswer:e.getAttribute("data-answer"),isStep:e.hasAttribute("data-form")&&"step"===e.getAttribute("data-form")}))}),function(e){const t=T(e,"change",s.GO_TO,V),n=T(e,"input",s.GO_TO,V),i=T(e,"click",s.GO_TO,V),a=T(e,"click","label.radio_field, .w-radio, .radio_button-skip-step, .w-form-formradioinput, .w-radio-input",O);C.push(t,n,i,a)}(e),L=!0,console.log("✅ [Branching] Initialization complete"),u("Branching initialization complete"),d.registerModule("branching")}function O(e,t){let n=null;if(n=t.querySelector('input[type="radio"][data-go-to]'),!n){const e=t.closest("label");e&&(n=e.querySelector('input[type="radio"][data-go-to]'))}if(!n){const e=t.closest(".radio_field, .w-radio, .radio_component");e&&(n=e.querySelector('input[type="radio"][data-go-to]'))}if(n&&g(n,"data-go-to")){e.preventDefault(),e.stopPropagation(),n.checked=!0,_(n);const t=new Event("change",{bubbles:!0});Object.defineProperty(t,"target",{value:n}),V(t,n)}}function V(e,t){if(console.log("🌿 [Branch] Trigger event detected",{eventType:e.type,element:t,tagName:t.tagName,className:t.className,id:t.id}),!L)return void console.error("❌ [Branch] Module not initialized, ignoring branch trigger",{target:t,initialized:L,eventType:e.type});if(!I(t))return void console.log("ℹ️ [Branch] Element is not a form input, ignoring",{tagName:t.tagName,isInput:t instanceof HTMLInputElement,isSelect:t instanceof HTMLSelectElement,isTextarea:t instanceof HTMLTextAreaElement});const n=g(t,"data-go-to"),i=t.name||g(t,"data-step-field-name"),a=b(t),s=t.type||t.tagName;if(console.log("📋 [Branch] Data attributes analysis:",{"data-go-to":n,"data-step-field-name":g(t,"data-step-field-name"),name:t.name,type:s,value:a,checked:t.checked,allAttributes:Array.from(t.attributes).map(e=>({name:e.name,value:e.value}))}),n&&!function(e){return!!e&&(!!/^[a-zA-Z0-9_-]+$/.test(e)||(u("Invalid data-go-to value format",{goToValue:e}),!1))}(n))return void console.error("❌ [Branch] Invalid data-go-to value format",{goToValue:n,validFormat:"alphanumeric, hyphens, underscores only",pattern:"/^[a-zA-Z0-9_-]+$/"});console.log("🎯 [Branch] Processing branch trigger:",{element:t,goTo:n,value:a,type:s,fieldName:i,hasGoTo:!!n,hasValue:!!a}),console.log("💾 [Branch] Field change detected for branching logic:",{fieldName:i,value:a,goToValue:n});try{if(t instanceof HTMLInputElement)if("radio"===t.type&&t.checked){if(console.log("📻 [Branch] Processing radio button selection:",{name:t.name,value:t.value,checked:t.checked,goTo:n}),!n)return void console.warn("⚠️ [Branch] Radio button has no data-go-to attribute, skipping navigation",{element:t,name:t.name,value:t.value});if(!document.querySelector(`[data-answer="${n}"]`)){const e=document.querySelectorAll("[data-answer]"),t=Array.from(e).map(e=>g(e,"data-answer"));console.error("❌ [Branch] Target step not found in DOM!",{searchedFor:n,availableSteps:t,suggestion:`Check if element with data-answer="${n}" exists`,possibleMatches:t.filter(e=>e&&e.includes(n))})}!function(e){const t=e.name;if(!t)return;document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{if(t!==e){const e=g(t,"data-go-to");e&&P(e)}})}(t),_(t),z(n),console.log("🚀 [Branch] Emitting branch:change event:",{targetStepId:n,triggerValue:t.value,triggerType:"radio"}),d.emit("branch:change",{targetStepId:n})}else"checkbox"===t.type?(console.log("☑️ [Branch] Processing checkbox:",{name:t.name,value:t.value,checked:t.checked,goTo:n}),n&&(t.checked?(console.log("✅ [Branch] Checkbox checked, activating branch:",{goToValue:n}),z(n)):(console.log("❌ [Branch] Checkbox unchecked, deactivating branch:",{goToValue:n}),P(n)))):"radio"!==t.type&&"checkbox"!==t.type&&(console.log("📝 [Branch] Processing text input/other:",{type:t.type,name:t.name,value:a,goTo:n}),n&&(a?(console.log("✅ [Branch] Input has value, activating branch:",{goToValue:n,inputValue:a}),z(n)):(console.log("❌ [Branch] Input is empty, deactivating branch:",{goToValue:n}),P(n))));else console.log("📋 [Branch] Processing select/textarea:",{tagName:t.tagName,value:a,goTo:n}),n&&(a?(console.log("✅ [Branch] Element has value, activating branch:",{goToValue:n,inputValue:a}),z(n)):(console.log("❌ [Branch] Element is empty, deactivating branch:",{goToValue:n}),P(n)))}catch(e){console.error("💥 [Branch] Error handling branch trigger:",{error:e,errorMessage:e instanceof Error?e.message:String(e),errorStack:e instanceof Error?e.stack:void 0,element:t,goToValue:n,inputValue:a,fieldName:i})}const l={};Object.keys(l).length>0?(console.log("🔄 [Branch] Updating step visibility based on active conditions:",{activeConditions:l,conditionCount:Object.keys(l).length}),function(){const e=m("[data-show-if]"),t={};e.forEach(e=>{const n=g(e,"data-show-if"),i=g(e,"data-answer");n&&i&&(!function(e,t){if(!e||"string"!=typeof e)return u("Invalid condition provided",{condition:e}),!1;try{const n=e.trim();return n.includes(",")?n.split(",").map(e=>e.trim()).some(e=>!!t[e]):n.includes("&")?n.split("&").map(e=>e.trim()).every(e=>!!t[e]):!!t[n]}catch(t){return u("Error evaluating condition",{condition:e,error:t}),!1}}(n,t)?(u("Branching logic determines step should be hidden",{stepId:i}),d.emit("branch:hide",{stepId:i})):(u("Branching logic determines step should be visible",{stepId:i}),d.emit("branch:show",{stepId:i})))})}()):console.log("ℹ️ [Branch] No active conditions, skipping step visibility update")}function _(e){const t=e.name;if(!t)return;const n=g(e,"fs-inputactive-class")||"is-active-inputactive";document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{const i=t,a=i.closest("label");i!==e&&(i.classList.remove(n),a?.classList.remove(n))}),e.classList.add(n);const i=e.closest("label");i?.classList.add(n)}function z(e){}function P(e){e&&function(e){const t=[],n=p(`[data-answer="${e}"]`);if(n){m("[data-step-field-name]",n).forEach(e=>{const n=g(e,"data-step-field-name");n&&t.push(n)})}t.length>0&&r.clearFields(t)}(e)}function R(){L?(u("Resetting branching module"),d.unregisterModule("branching"),C.forEach(e=>e()),C=[],L=!1,u("Branching module reset")):u("Branching module not initialized, nothing to reset")}var D=!1,k=[],q=[],B=[],H=[],G=-1,U=null,W="",Z=[];function j(e=document){D&&(u("MultiStep already initialized, cleaning up first"),function(){if(!D)return void u("Multi-step module not initialized, nothing to reset");u("Resetting multi-step module"),d.unregisterModule("multiStep"),k.forEach(e=>e()),k=[],B=[],H=[],G=-1,U=null,W="",Z=[],D=!1,q.forEach(e=>e()),q=[],u("Multi-step module reset")}()),console.log("🚀 [MultiStep] === INITIALIZATION START ==="),console.log("🔍 [MultiStep] Root element:",{isDocument:e===document,elementType:e.constructor.name,hasQuerySelector:"function"==typeof e.querySelector}),u("Initializing multi-step navigation with step/step_item architecture");const t=m(s.STEP,e);console.log("📋 [MultiStep] Step detection results:",{selector:s.STEP,foundElements:t.length,elements:Array.from(t).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,hasDataForm:e.hasAttribute("data-form"),dataFormValue:e.getAttribute("data-form"),innerHTML:e.innerHTML.substring(0,100)+"..."}))}),0===t.length&&console.error("❌ [MultiStep] CRITICAL: No step elements found!",{selector:s.STEP,searchedIn:e===document?"entire document":"custom root element",possibleIssues:['Form missing data-form="multistep" attribute','Steps missing data-form="step" attributes',"Script loading before DOM is ready"],troubleshooting:{checkForm:"document.querySelector('[data-form=\"multistep\"]')",checkSteps:"document.querySelectorAll('[data-form=\"step\"]')",checkAllDataForm:"document.querySelectorAll('[data-form]')"}}),B=Array.from(t).map((e,t)=>{console.log(`🔍 [MultiStep] Processing step ${t}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataForm:e.hasAttribute("data-form"),dataFormValue:g(e,"data-form")});const n=e.querySelector(".step_wrapper[data-answer]");let i=null;console.log(`🔍 [MultiStep] Step ${t} data-answer search:`,{hasStepWrapper:!!n,stepWrapperInfo:n?{tagName:n.tagName,id:n.id,className:n.className,dataAnswer:n.getAttribute("data-answer")}:null}),n?(i=g(n,"data-answer"),console.log("📋 [MultiStep] Found step_wrapper with data-answer:",{stepIndex:t,dataAnswer:i,stepWrapper:{tagName:n.tagName,id:n.id,className:n.className}})):(console.log("ℹ️ [MultiStep] No step_wrapper found, checking step element directly"),i=g(e,"data-answer"),i?console.log("📋 [MultiStep] Found data-answer on step element:",{stepIndex:t,dataAnswer:i}):console.log("⚠️ [MultiStep] No data-answer found on step element either:",{stepIndex:t,allAttributes:Array.from(e.attributes).map(e=>({name:e.name,value:e.value}))})),i||(i=`step-${t}`,console.warn(`⚠️ [MultiStep] No data-answer found for step ${t}, auto-generating:`,{stepIndex:t,generatedDataAnswer:i,stepElement:{tagName:e.tagName,id:e.id,className:e.className,hasStepWrapper:!!n},recommendation:`Consider adding data-answer="${i}" to step_wrapper or step element for better control`}));const a=`step-${t}`;console.log(`🎯 [MultiStep] Step ${t} validation:`,{expected:a,found:i,isValid:!!i,matches:i===a,wasAutoGenerated:!g(e,"data-answer")&&!n});const s={element:e,id:i,index:t,type:g(e,"data-step-type")||void 0,subtype:g(e,"data-step-subtype")||void 0,number:g(e,"data-step-number")||void 0,isStepItem:!1};return console.log(`✅ [MultiStep] Step ${t} initialized successfully:`,{stepId:i,stepInfo:{id:s.id,type:s.type,subtype:s.subtype,number:s.number}}),s}),console.log("📊 [MultiStep] Step initialization summary:",{totalStepsFound:t.length,totalStepsInitialized:B.length,stepIds:B.map(e=>e.id),stepIndices:B.map(e=>e.index)});const n=document.querySelectorAll(".step_item");if(console.log(`🌿 [MultiStep] Found ${n.length} step_items for branching logic`),H=Array.from(n).map((e,n)=>{console.log(`🔍 [MultiStep] Processing step_item ${n}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataAnswer:e.hasAttribute("data-answer"),dataAnswer:g(e,"data-answer")});const i=g(e,"data-answer");if(!i)return console.error("❌ [MultiStep] STEP_ITEM INITIALIZATION ERROR:",{stepItemIndex:n,error:`Step_item ${n} is missing required data-answer attribute`,stepItemElement:{tagName:e.tagName,id:e.id,className:e.className,innerHTML:e.innerHTML.substring(0,200)+"..."},solution:"Add data-answer attribute to step_item element",example:'<div class="step_item" data-answer="some-unique-id">',troubleshooting:{checkElement:"element.getAttribute('data-answer')",allDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}}),null;const a=e.closest('[data-form="step"]');let s;a?(s=Array.from(t).indexOf(a),console.log("🔗 [MultiStep] Found parent step for step_item:",{stepItemId:i,parentStepIndex:s,parentStepId:-1!==s?B[s]?.id:"NOT_FOUND",parentElement:{tagName:a.tagName,id:a.id,className:a.className}})):console.warn("⚠️ [MultiStep] No parent step found for step_item:",{stepItemId:i,stepItemIndex:n,warning:'step_item should be nested within a [data-form="step"] element',suggestion:"Check DOM structure - step_item should be inside a step element"});const l={element:e,id:i,index:n,type:g(e,"data-step-type")||void 0,subtype:g(e,"data-step-subtype")||void 0,number:g(e,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:-1!==s?s:void 0};return console.log(`✅ [MultiStep] Step_item ${n} initialized successfully:`,{stepItemId:i,stepItemInfo:{id:l.id,type:l.type,subtype:l.subtype,number:l.number,parentStepIndex:l.parentStepIndex,parentStepId:void 0!==l.parentStepIndex?B[l.parentStepIndex]?.id:void 0}}),l}).filter(e=>null!==e),console.log("👁️ [MultiStep] === INITIAL STEP HIDING ==="),u("Starting to hide all steps initially",{totalSteps:B.length,totalStepItems:H.length}),B.forEach((e,t)=>{console.log(`🫥 [MultiStep] Hiding step ${t} (${e.id}):`,{stepId:e.id,element:{tagName:e.element.tagName,id:e.element.id,className:e.element.className},beforeHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:v(e.element),offsetHeight:e.element.offsetHeight,offsetWidth:e.element.offsetWidth}}),S(e.element),console.log(`✅ [MultiStep] Step ${t} hidden:`,{stepId:e.id,afterHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:v(e.element),offsetHeight:e.element.offsetHeight,offsetWidth:e.element.offsetWidth}})}),H.forEach((e,t)=>{console.log(`🫥 [MultiStep] Hiding stepItem ${t} (${e.id})`),S(e.element)}),console.log("✅ [MultiStep] Finished hiding all steps and step items"),u("Finished hiding all steps and step items"),function(e){const t=T(e,"click",s.NEXT_BTN,Q),n=T(e,"click",s.BACK_BTN,ee),i=T(e,"click",s.SUBMIT_BTN,te);k.push(t,n,i),u("Navigation listeners setup complete")}(e),function(){const e=d.on("branch:change",({targetStepId:e})=>{u(`Received branch:change event, navigating to: ${e}`),ne(e)}),t=d.on("skip:request",({targetStepId:e})=>{u("Received skip:request event",{targetStepId:e}),e?(u("Navigating to target step:",e),ne(e)):u("No target step provided in skip:request")}),n=d.on("branch:show",({stepId:e})=>{u("Received branch:show event",{stepId:e});const t=document.querySelector(`[data-answer="${e}"]`);t&&(y(t),Y(t,!0))}),i=d.on("branch:hide",({stepId:e})=>{u("Received branch:hide event",{stepId:e});const t=document.querySelector(`[data-answer="${e}"]`);t&&(S(t),Y(t,!1))});q.push(e,t,n,i)}(),function(e){const t=T(e,"click",s.SKIP,J);k.push(t),u("Skip listeners setup complete")}(e),console.log("🎬 [MultiStep] === INITIAL STEP SHOWING ==="),B.length>0){const t=e.querySelector(s.MULTISTEP),n=t?g(t,"data-start-step"):null,i=n||B[0].id,a=oe(i);console.log("🎯 [MultiStep] Initial step selection:",{totalSteps:B.length,multistepElement:!!t,startStepAttr:n,defaultFirstStepId:B[0].id,selectedStartStepId:i,selectedStartIndex:a,isValidIndex:-1!==a,allStepIds:B.map(e=>e.id)});const l=-1!==a?a:0;console.log(`🚀 [MultiStep] Showing initial step: index ${l} (${B[l]?.id})`),ae(l)}else console.error("❌ [MultiStep] CRITICAL: No steps found to initialize - cannot show initial step!"),u("No steps found to initialize");D=!0,u("Multi-step initialization complete"),d.registerModule("multiStep"),B.length>0?(console.log("✅ [MultiStep] Initialization complete. Going to first step."),ae(0)):console.warn("⚠️ [MultiStep] Initialization complete, but no steps found to display."),console.log("📊 [MultiStep] === INITIALIZATION COMPLETE ===",{totalSteps:B.length,totalStepItems:H.length,initialStepIndex:G,initialStepId:W,initialStepItemId:U})}function Y(e,t=!0){e.querySelectorAll("input, select, textarea").forEach(e=>{const n=e;if(t){"true"===n.getAttribute("data-original-required")&&(n.required=!0,n.disabled=!1)}else n.required&&n.setAttribute("data-original-required","true"),n.required=!1,n.disabled=!0,n.value=""})}function X(e,t=!0){const n=g(e,"data-step-subtype");if(!n)return;u(`${t?"Enabling":"Disabling"} required fields for subtype: ${n}`);e.querySelectorAll("[data-require-for-subtypes]").forEach(e=>{const i=e.getAttribute("data-require-for-subtypes"),a=e;i&&i.split(",").map(e=>e.trim()).includes(n)&&(t?(a.required=!0,a.disabled=!1):(a.required=!1,a.disabled=!0,a.value=""))})}function K(e){u(`Attempting to show step_item: ${e}`);const t=H.find(t=>t.id===e);if(!t){const t=H.find(t=>g(t.element,"data-answer")===e);return t?(u(`Found step_item by data-answer: ${e}`),K(t.id)):void u(`Step item not found: ${e}`)}if(!B[t.parentStepIndex])return void u(`Parent step not found for step_item: ${e}`);u(`Showing step_item ${e} in parent step ${t.parentStepIndex}`);H.filter(e=>e.parentStepIndex===t.parentStepIndex).forEach(e=>{S(e.element),X(e.element,!1)}),y(t.element);let n=t.element.parentElement;for(;n&&!n.classList.contains("multi-form_step");)n.classList.contains("step_wrapper")&&(n.style.display="",n.style.visibility="",h(n,"hidden-step"),h(n,"hidden-step-item")),n=n.parentElement;X(t.element,!0),U=e,u(`Successfully showed step_item: ${e}`)}function J(e,t){if(e.preventDefault(),!D)return void u("MultiStep module not initialized, ignoring skip button click");const n=g(t,"data-skip");if(!n||"true"===n||""===n)return void u("Invalid data-skip value - must specify target step",{dataSkip:n});document.querySelector(`[data-answer="${n}"]`)?(u("Processing skip request",{currentStepId:W,targetStepId:n}),ne(n)):u("Target step not found in DOM",{targetStepId:n})}function Q(e){console.log("🔍 NEXT BUTTON CLICK HANDLER TRIGGERED"),console.log("Event target:",e.target),console.log("Event currentTarget:",e.currentTarget);const t=e.target,n=t.getAttribute("data-skip");n?console.log("❌ CONFLICT DETECTED: Skip button triggered next button handler!",{skipAttribute:n,targetElement:t,targetTagName:t.tagName,targetClassName:t.className}):(console.log("✅ Legitimate next button click - proceeding with navigation"),e.preventDefault(),function(){if(!D)return void u("Multi-step module not initialized, ignoring goToNextStep call");u("=== GO TO NEXT STEP FUNCTION START ==="),console.log("🔍 GO TO NEXT STEP CALLED"),console.trace("Call stack for goToNextStep:");const e=re();if(!e)return void u("No current step found");u("Current step info",{stepId:e.id,stepIndex:G,stepElement:{tagName:e.element.tagName,id:e.element.id,className:e.element.className}});const t=G+1;console.log(`🔍 ATTEMPTING TO NAVIGATE TO NEXT STEP - Current: ${G}, Next: ${t}`),u("Sequential navigation logic",{currentIndex:G,nextIndex:t,totalSteps:B.length,hasNextStep:t<B.length}),t<B.length?(u(`Going to next sequential step: index ${t}`),ae(t)):u("Already at last step");u("=== GO TO NEXT STEP FUNCTION END ===")}())}function ee(e){e.preventDefault(),function(){if(Z.length>1){Z.pop();const e=Z[Z.length-1];if(e){const t=oe(e);if(-1!==t)return void ae(t)}}const e=G-1;e>=0?ae(e):u("Already at first step")}()}function te(e){if(!e.target.closest("form"))return void u("Form not found, preventing submission");if(!function(){for(const e of B)if((e.id===W||v(e.element))&&!ie(e.element))return!1;return!0}())return e.preventDefault(),void u("Form validation failed, preventing submission");u("Form validation passed, allowing submission")}function ne(e){if(!D)return void console.error("❌ [MultiStep] Module not initialized, ignoring goToStepById call",{stepId:e,initialized:D,totalSteps:B.length,totalStepItems:H.length});console.log("🎯 [MultiStep] Navigation request received:",{targetStepId:e,currentStepIndex:G,currentStepId:W,totalSteps:B.length,totalStepItems:H.length});const t=B.map(e=>e.id),n=H.map(e=>e.id);console.log("📋 [MultiStep] Available navigation targets:",{searchingFor:e,parentStepIds:t,branchingStepItemIds:n,totalParentSteps:B.length,totalBranchingItems:H.length});const i=H.find(t=>t.id===e);if(i){if(console.log("✅ [MultiStep] Found as branching step_item:",{stepItemId:e,parentStepIndex:i.parentStepIndex,stepItemIndex:i.index,stepItemElement:{tagName:i.element.tagName,id:i.element.id,className:i.element.className,dataAnswer:g(i.element,"data-answer"),isVisible:v(i.element),parentStep:void 0!==i.parentStepIndex?B[i.parentStepIndex]?.id:"unknown"}}),void 0!==i.parentStepIndex){const n=B[i.parentStepIndex];if(!n)return void console.error("❌ [MultiStep] Parent step not found for step_item!",{stepItemId:e,parentStepIndex:i.parentStepIndex,availableSteps:t,totalSteps:B.length});console.log("🔄 [MultiStep] Navigating to parent step first:",{parentStepId:n.id,parentStepIndex:i.parentStepIndex,currentStepIndex:G}),ae(i.parentStepIndex),console.log("🌿 [MultiStep] Showing branching option:",{stepItemId:e,withinParentStep:n.id}),K(e)}return void console.log("✅ [MultiStep] Successfully navigated to step_item:",e)}console.log("ℹ️ [MultiStep] Not found in branching step_items, checking regular steps");const a=oe(e);if(console.log("🔍 [MultiStep] Regular step search result:",{stepId:e,foundIndex:a,isValidIndex:-1!==a,searchMethod:"findStepIndexById"}),-1!==a){const t=B[a];return console.log("✅ [MultiStep] Found as regular step:",{stepId:e,stepIndex:a,stepElement:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:g(t.element,"data-answer"),isVisible:v(t.element)}}),U=null,console.log("🚀 [MultiStep] Calling goToStep with index:",{stepIndex:a,stepId:t.id}),ae(a),void console.log("✅ [MultiStep] Successfully navigated to regular step:",e)}console.error("❌ [MultiStep] STEP NOT FOUND:",{searchedFor:e,searchedIn:"both regular steps and branching step_items",availableRegularSteps:t,availableBranchingItems:n,totalElements:{steps:B.length,stepItems:H.length},suggestion:`Check if element with data-answer="${e}" exists in DOM`,troubleshooting:{checkDataAnswer:`document.querySelector('[data-answer="${e}"]')`,listAllDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}});const s=document.querySelector(`[data-answer="${e}"]`);s&&console.error("🔍 [MultiStep] Step exists in DOM but not registered!",{stepId:e,domElement:{tagName:s.tagName,id:s.id,className:s.className,dataAnswer:g(s,"data-answer"),hasStepAttribute:s.hasAttribute("data-form"),stepAttribute:g(s,"data-form"),isVisible:s instanceof HTMLElement&&v(s)},possibleCause:"Element exists but was not properly initialized during module setup"})}function ie(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(v(t)){if(!t.value||""===t.value.trim())return u("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return u("Validation failed: invalid email format"),t.focus(),!1}}}return!0}function ae(e){if(console.log("🎯 [STEP NAVIGATION] === GO TO STEP START ==="),console.log("🎯 [STEP NAVIGATION] Starting goToStep:",{requestedIndex:e,currentIndex:G,totalSteps:B.length,stepExists:e>=0&&e<B.length,initialized:D}),!D)return console.error("❌ [STEP NAVIGATION] Module not initialized!"),void u("Multi-step module not initialized, ignoring goToStep call");if(e<0||e>=B.length)return void console.error("❌ [STEP NAVIGATION] Invalid step index:",{requestedIndex:e,validRange:"0 to "+(B.length-1),totalSteps:B.length,availableStepIds:B.map(e=>e.id)});const t=B[e];if(console.log("📋 [STEP NAVIGATION] Target step details:",{stepIndex:e,stepId:t.id,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:g(t.element,"data-answer"),innerHTML:t.element.innerHTML.length>0?`${t.element.innerHTML.substring(0,100)}...`:"EMPTY",hasContent:t.element.children.length>0,childrenCount:t.element.children.length},visibility:{isVisible:v(t.element),display:getComputedStyle(t.element).display,visibility:getComputedStyle(t.element).visibility,opacity:getComputedStyle(t.element).opacity,hasHiddenClass:t.element.classList.contains("hidden-step"),offsetHeight:t.element.offsetHeight,offsetWidth:t.element.offsetWidth}}),0===t.element.children.length&&""===t.element.innerHTML.trim()&&console.warn("⚠️ [STEP NAVIGATION] Target step appears to be empty!",{stepId:t.id,stepIndex:e,innerHTML:t.element.innerHTML,textContent:t.element.textContent,childrenCount:t.element.children.length,possibleIssue:"This step may be a blank wrapper"}),u(`Attempting to go to step index: ${e}`),-1!==G){const e=B[G];console.log("👋 [STEP NAVIGATION] Hiding current step:",{currentIndex:G,currentStepId:e.id,beforeHide:{isVisible:v(e.element),display:getComputedStyle(e.element).display}}),le(G),console.log("✅ [STEP NAVIGATION] Current step hidden:",{stepId:e.id,afterHide:{isVisible:v(e.element),display:getComputedStyle(e.element).display}})}console.log("👁️ [STEP NAVIGATION] Showing target step:",{stepIndex:e,stepId:t.id,beforeShow:{isVisible:v(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step")}}),se(e),console.log("✅ [STEP NAVIGATION] Target step shown:",{stepId:t.id,afterShow:{isVisible:v(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step"),actuallyVisible:t.element.offsetHeight>0&&t.element.offsetWidth>0}}),console.log("🎯 [STEP NAVIGATION] === GO TO STEP END ===")}function se(e){if(e<0||e>=B.length)return void u(`Invalid step index: ${e}`);const t=B[e];t?(console.log(`🔄 [MultiStep] Showing step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className}}),B.forEach((t,n)=>{n!==e&&(le(n),t.element.classList.remove("active-step"))}),y(t.element),t.element.classList.add("active-step"),G=e,W=t.id,Z[Z.length-1]!==t.id&&Z.push(t.id),function(){const e=document.querySelector(s.NEXT_BTN),t=document.querySelector(s.BACK_BTN),n=document.querySelector(s.SUBMIT_BTN);if(!e||!t||!n)return;const i=0===G,a=G===B.length-1;t.style.display=i?"none":"",a?(e.style.display="none",n.style.display=""):(e.style.display="",n.style.display="none")}(),d.emit("step:change",{currentStepIndex:e,currentStepId:t.id}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now visible:`,{isVisible:v(t.element),hasActiveClass:t.element.classList.contains("active-step"),currentlyTracked:W===t.id,computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility}),v(t.element)||(console.error(`❌ [MultiStep] Step ${e} (${t.id}) is still not visible after showElement!`),function(e,t){const n=getComputedStyle(e),i=[];let a=e;for(;a&&a!==document.body;)i.push(a),a=a.parentElement;console.log(`🔍 [MultiStep] Diagnosing visibility issues for step ${t}:`,{targetElement:{tagName:e.tagName,id:e.id,className:e.className,computedDisplay:n.display,computedVisibility:n.visibility,computedOpacity:n.opacity,inlineDisplay:e.style.display,inlineVisibility:e.style.visibility,inlineOpacity:e.style.opacity,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:v(e)},parentChain:i.map(e=>({tagName:e.tagName,id:e.id,className:e.className,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,computedOpacity:getComputedStyle(e).opacity,hasHiddenClass:e.classList.contains("hidden-step")})),possibleConflicts:{hasDisplayNone:"none"===n.display,hasVisibilityHidden:"hidden"===n.visibility,hasZeroOpacity:"0"===n.opacity,hasHiddenClass:e.classList.contains("hidden-step"),parentWithDisplayNone:i.some(e=>"none"===getComputedStyle(e).display),parentWithVisibilityHidden:i.some(e=>"hidden"===getComputedStyle(e).visibility)}})}(t.element,t.id))):u(`Step not found at index: ${e}`)}function le(e){if(e<0||e>=B.length)return;const t=B[e];console.log(`🔄 [MultiStep] Hiding step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,hadActiveClass:t.element.classList.contains("active-step")}}),S(t.element),t.element.classList.remove("active-step"),H.forEach(t=>{t.parentStepIndex===e&&S(t.element)}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now hidden:`,{isVisible:v(t.element),hasActiveClass:t.element.classList.contains("active-step"),currentlyTracked:W===t.id,computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility})}function oe(e){return B.findIndex(t=>t.id===e)}function re(){return B[G]||null}function de(){return{step:re(),index:G,totalSteps:B.length,isFirstStep:0===G,isLastStep:G===B.length-1}}var ce=new Map,ue=new Map;function me(e=document){u("Initializing error handling");e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||g(e,"data-step-field-name");t&&ce.set(t,{fieldName:t,element:e,customMessage:g(e,"data-error-message")||void 0})}),u(`Error handling initialized for ${ce.size} fields`)}function pe(e,t){const n=ce.get(e);if(!n)return void u(`Cannot show error for unknown field: ${e}`);const i=t||n.customMessage||"This field has an error";u(`Showing error for field: ${e}`,{message:i}),f(n.element,o.ERROR_FIELD);const a=function(e){if(!e||!e.element)return u("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return u(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`${s.ERROR_DISPLAY}[data-field="${e.fieldName}"]`)}catch(t){return u(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.setAttribute("data-form","error"),t.setAttribute("data-field",e.fieldName);const n=e.element.parentElement,i=e.element.nextSibling;i?n.insertBefore(t,i):n.appendChild(t),u(`Created error element for field: ${e.fieldName}`)}catch(t){return u(`Error creating error element for field: ${e.fieldName}`,t),null}return t}(n);a&&(a.textContent=i,f(a,o.ACTIVE_ERROR),n.errorElement=a),function(e){const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||(e.scrollIntoView({behavior:"smooth",block:"center"}),u(`Scrolled to field with error: ${e.name||"unnamed"}`))}(n.element)}function ge(e){const t=ce.get(e);t?(u(`Clearing error for field: ${e}`),h(t.element,o.ERROR_FIELD),t.errorElement&&(t.errorElement.textContent="",h(t.errorElement,o.ACTIVE_ERROR))):u(`Cannot clear error for unknown field: ${e}`)}function fe(){u("Clearing all field errors"),ce.forEach((e,t)=>{ge(t)})}function he(){const e={};return ue.forEach((t,n)=>{e[n]={message:t.message}}),e}var ye=!1,Se=[],ve=new Map;function Ie(e=document){ye&&(u("Validation already initialized, cleaning up first"),u("Resetting validation"),Se.forEach(e=>e()),Se=[],u("Clearing all field validation"),ve.forEach((e,t)=>{!function(e){const t=ve.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,Ae(t.element,!0),u(`Cleared validation for field: ${e}`))}(t)}),ve.clear(),ye=!1,u("Validation reset complete")),u("Initializing form validation");const t=m("input, select, textarea",e);u(`Found ${t.length} form inputs`),t.forEach(e=>{if(!I(e))return;const t=e,n=t.name||g(e,"data-step-field-name");if(!n)return void u("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:g(e,"data-step-field-name"),id:t.id,type:t.type});const i=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:g(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const n=g(e,"minlength");n&&t.push({type:"min",value:parseInt(n),message:`Minimum ${n} characters required`});const i=g(e,"maxlength");i&&t.push({type:"max",value:parseInt(i),message:`Maximum ${i} characters allowed`});const a=g(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==i.length?(ve.set(n,{element:e,rules:i,isValid:!0}),u(`Validation rules set for field: ${n}`,{rules:i.map(e=>e.type),rulesCount:i.length})):u(`No validation rules found for field: ${n}`)}),function(){const e=d.on("field:input",e=>{!function(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}(()=>be(e),l.VALIDATION_DELAY)()}),t=d.on("field:blur",be),n=d.on("field:change",be);Se.push(e,t,n),u("Validation module subscribed to centralized field events")}(),ye=!0,u("Validation initialization complete")}function be(e){const{fieldName:t,element:n}=e;if(!t)return void u("Skipping validation - no field name found",{element:n,eventType:e.eventType});const i=n.closest(s.STEP);if(i){if(g(i,"data-answer")&&!v(i))return void u(`Skipping validation for field in hidden step: ${t}`)}Te(t)}function Te(e){const t=ve.get(e);if(!t)return u(`No validation rules found for field: ${e}`),!0;const n=t.element;if(!n)return u(`No element found for field: ${e}`),!0;const i=b(n);u(`Validating field: ${e}`,{value:i,elementExists:!!n});for(const a of t.rules){const{isValid:s,message:l}=Ne(i,a);if(!s)return t.isValid=!1,t.errorMessage=l||"Invalid field",pe(e,t.errorMessage),Ae(n,!1,t.errorMessage),!1}return t.isValid=!0,ge(e),Ae(n,!0),!0}var Ee={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1\s?)?(\([0-9]{3}\)|[0-9]{3})[\s\-]?[0-9]{3}[\s\-]?[0-9]{4}$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,zipCode:/^\d{5}(-\d{4})?$/,zipCodeCA:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,creditCard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/,ssn:/^\d{3}-?\d{2}-?\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/};function Ne(e,t){switch(t.type){case"required":return{isValid:Array.isArray(e)?e.length>0:!!e&&""!==String(e).trim(),message:t.message};case"email":return{isValid:Ee.email.test(String(e)),message:t.message||"Please enter a valid email address"};case"phone":const n=String(e).replace(/[\s\-\(\)]/g,"");return{isValid:Ee.phone.test(n)||Ee.phoneUS.test(String(e)),message:t.message||"Please enter a valid phone number"};case"min":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length>=t.value,message:t.message||`Minimum ${t.value} characters required`};case"max":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length<=t.value,message:t.message||`Maximum ${t.value} characters allowed`};case"pattern":return t.value instanceof RegExp?{isValid:t.value.test(String(e)),message:t.message||"Please enter a valid format"}:{isValid:!0};case"custom":if(!t.validator)return{isValid:!0};try{return{isValid:t.validator(e),message:t.message||"Invalid value"}}catch(e){return u("Error in custom validator",{error:e,rule:t}),{isValid:!1,message:"Validation error occurred"}}default:return{isValid:!0}}}function Ae(e,t,n){const i=e.name||g(e,"data-step-field-name");i&&(t?ge(i):pe(i,n))}function we(e){const t=p(`[data-answer="${e}"]`);if(!t)return u(`Step not found with data-answer="${e}"`),!0;if(!v(t))return u(`Skipping validation for hidden step: ${e}`),!0;u(`Validating step: ${e}`);const n=t.querySelectorAll("input, select, textarea");let i=!0;return n.forEach(e=>{if(!I(e))return;const t=e.name||g(e,"data-step-field-name");if(t){Te(t)||(i=!1)}}),u(`Step validation result: ${e}`,{isValid:i}),i}function Me(){u("Validating all visible fields");let e=!0;const t={};for(const[n,i]of ve){const a=i.element.closest(s.STEP);let l=!0;if(a){g(a,"data-answer")&&!v(a)&&(l=!1)}if(l){const i=Te(n);t[n]=i,i||(e=!1)}}return u("All visible fields validation complete",{allValid:e,results:t}),e}var xe=!1,$e=[],Le=[];function Ce(e=document){xe&&(u("Summary already initialized, cleaning up first"),u("Resetting summary functionality"),$e.forEach(e=>e()),$e=[],Le.forEach(e=>{Pe(e.element,"")}),Le=[],xe=!1,u("Summary reset complete")),u("Initializing summary functionality");const t=m(s.SUMMARY_FIELD,e);u(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=g(e,"data-summary-field");if(!t)return;const n=t.split("|").map(e=>e.trim()),i=g(e,"data-join"),a=i&&i in l.JOIN_SEPARATOR?i:"space",s=g(e,"data-summary-type")||void 0,o=g(e,"data-summary-subtype")||void 0,r=g(e,"data-summary-number")||void 0,d={element:e,fieldNames:n,joinType:a,type:s,subtype:o,number:r};Le.push(d),u("Summary field configured",{fieldNames:n,joinType:a,type:s,subtype:o,number:r})})}(t),function(){const e=d.on("field:change",Fe),t=d.on("field:input",Fe);$e.push(e,t),u("Summary module subscribed to centralized field events")}(),_e(),xe=!0,u("Summary initialization complete")}function Fe(e){const{fieldName:t,value:n,eventType:i}=e;u(`Summary received field ${i}: ${t}`,{value:n}),Oe(t)}function Oe(e){Le.forEach(t=>{t.fieldNames.includes(e)&&ze(t)})}function Ve(){u("Updating all summaries"),_e()}function _e(){Le.forEach(e=>{ze(e)})}function ze(e){const t=[];e.fieldNames.forEach(e=>{const n=r.getField(e);null!=n&&""!==n&&(Array.isArray(n)?t.push(...n.filter(e=>""!==e)):t.push(String(n)))});const n=function(e,t){if(0===e.length)return"";const n=l.JOIN_SEPARATOR[t];return e.join(n)}(t,e.joinType);Pe(e.element,n),u("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:n})}function Pe(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}function Re(e){e?(u("Clearing specific summary fields",e),r.clearFields(e),e.forEach(e=>{Oe(e)})):(u("Clearing all summaries"),r.clear(),_e())}function De(){const e={};return Le.forEach((t,n)=>{const i=t.type&&t.subtype&&t.number?`${t.type}-${t.subtype}-${t.number}`:`summary-${n}`;e[i]={hasContent:(t.element.textContent||"").trim().length>0}}),e}console.log("🚀 [FormLib] === SCRIPT VERSION CHECK ==="),console.log("📦 [FormLib] Script Version: CACHE_BUST_2025_01_10_14_45_FRESH"),console.log("🔗 [FormLib] Expected URL: @9705259 or newer"),console.log("⏰ [FormLib] Load Time:",(new Date).toISOString());var ke,qe=class e{constructor(){this.initialized=!1,this.rootElement=document,u("FormLibrary instance created")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e=document){this.initialized&&(u("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,u("Initializing FormLibrary",{root:e===document?"document":"custom element"});const t=e.querySelectorAll(s.MULTISTEP),n=e.querySelectorAll(s.LOGIC),i=e.querySelectorAll(s.STEP);if(u("Form detection results",{multistepForms:t.length,logicForms:n.length,stepElements:i.length}),0!==t.length||0!==i.length)try{!function(e=document){E&&(u("Field coordinator already initialized, cleaning up first"),$()),u("Initializing centralized field coordinator");const t=T(e,"input","input, select, textarea",A),n=T(e,"change","input, select, textarea",w),i=T(e,"blur","input, select, textarea",M);N.push(t,n,i),E=!0,u("Field coordinator initialization complete")}(e),me(e),Ie(e),n.length>0&&F(e),(t.length>0||i.length>0)&&j(e),Ce(e),this.initialized=!0,u("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw u("FormLibrary initialization failed",e),e}else u("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){u("Destroying FormLibrary");try{R(),$()}catch(e){u("Error during FormLibrary destruction",e)}r.clear(),c.clear(),this.initialized=!1,u("FormLibrary destruction complete")}else u("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:r.getDebugInfo(),branching:{initialized:L},multiStep:{initialized:D,currentStepIndex:G,totalSteps:B.length,steps:B.map(e=>({id:e.id,index:e.index,visible:v(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:{initialized:ye,fieldValidations:Array.from(ve.entries()).reduce((e,[t,n])=>(e[t]={isValid:n.isValid,errorMessage:n.errorMessage,rules:n.rules.map(e=>e.type)},e),{})},errors:he(),summary:De()}}logCurrentState(){u("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return u("Cannot validate form - library not initialized"),!1;u("Validating entire form");const e=Me();return u("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){u("Resetting form to initial state"),fe(),r.clear(),Re();try{ae(0)}catch(e){u("Could not go to first step during reset",e)}u("Form reset complete")}else u("Cannot reset form - library not initialized")}getFormData(){return r.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{r.setField(e,t)}),Ve(),u("Form data set",e)}}.getInstance(),Be=qe;if("undefined"!=typeof window){const e=()=>{const e=document.querySelectorAll(s.MULTISTEP),t=document.querySelectorAll(s.STEP);(e.length>0||t.length>0)&&(u("Auto-initializing FormLibrary on DOM ready"),qe.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}return"undefined"!=typeof window&&(window.FormLib=qe,u("FormLib attached to window for debugging")),ke=a,((a,s,l,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let r of n(s))i.call(a,r)||r===l||e(a,r,{get:()=>s[r],enumerable:!(o=t(s,r))||o.enumerable});return a})(e({},"__esModule",{value:!0}),ke)})();