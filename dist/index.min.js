"use strict";var FormLib=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(a,{FormState:()=>I,clearAllErrors:()=>re,clearError:()=>le,clearSummary:()=>Le,default:()=>Oe,getCurrentStepInfo:()=>ie,goToStep:()=>K,initBranching:()=>A,initErrors:()=>se,initMultiStep:()=>H,initSummary:()=>Te,initValidation:()=>me,resetBranching:()=>L,showError:()=>oe,showStep:()=>J,updateSummary:()=>Me,validateAllVisibleFields:()=>ve,validateField:()=>fe,validateStep:()=>be});var s={MULTISTEP:'[data-form="multistep"]',LOGIC:"[data-logic]",STEP:'[data-form="step"]',ANSWER:"[data-answer]",GO_TO:"[data-go-to]",SKIP:"[data-skip]",NEXT_BTN:'[data-form="next-btn"]',BACK_BTN:'[data-form="back-btn"]',SUBMIT:'[data-form="submit"]',SUBMIT_BTN:'[data-form="submit-btn"]',ERROR_DISPLAY:'[data-form="error"]',SHOW_IF:"[data-show-if]",STEP_TYPE:"[data-step-type]",STEP_SUBTYPE:"[data-step-subtype]",STEP_NUMBER:"[data-step-number]",STEP_FIELD_NAME:"[data-step-field-name]",SUMMARY_FIELD:"[data-summary-field]",SUMMARY_TYPE:"[data-summary-type]",SUMMARY_SUBTYPE:"[data-summary-subtype]",SUMMARY_NUMBER:"[data-summary-number]",JOIN:"[data-join]",REQUIRED:"[required]",ERROR_MESSAGE:"[data-error-message]",VALIDATE:"[data-validate]",ALL_INPUTS:"input, select, textarea"},o={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},l={ACTIVE_STEP:"active-step",HIDDEN_STEP:"hidden-step",HIDDEN_STEP_ITEM:"hidden-step-item",ERROR_FIELD:"error-field",ACTIVE_ERROR:"active-error",DISABLED:"disabled"},r=new Map;function d(e,t){if(!o.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${o.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function c(e,t=document){if(t===document){const i=`all:${e}`;if(r.has(i))return r.get(i);const n=t.querySelectorAll(e);return r.set(i,n),n}return t.querySelectorAll(e)}function u(e,t=document){if(t===document){const i=`single:${e}`;if(r.has(i))return r.get(i);const n=t.querySelector(e);return r.set(i,n),n}return t.querySelector(e)}function p(e,t){return e.getAttribute(t)}function m(e,t){e.classList.add(t)}function g(e,t){e.classList.remove(t)}function f(e){g(e,"hidden-step");const t=e.getAttribute("data-original-display")||"";if(t&&"none"!==t)e.style.setProperty("display",t,"important");else{const t=e.classList.contains("flex")||e.classList.contains("d-flex")||e.classList.contains("step_wrapper")||"flex"===getComputedStyle(e).display;e.style.setProperty("display",t?"flex":"block","important")}e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),console.log("🔄 [Utils] Showing element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t||"none stored",currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)})}function h(e){const t=getComputedStyle(e).display;t&&"none"!==t&&e.setAttribute("data-original-display",t),m(e,"hidden-step"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),console.log("🔄 [Utils] Hiding element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t,currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)})}function S(e){const t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function y(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function b(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function v(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}var I=class e{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[]},d("FormState initialized")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setField(e,t){const i=this.data[e];this.data[e]=t,d(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[]},d("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&d("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),d(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),d(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),d(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}getFieldsByStep(){const e={};return Object.entries(this.data).forEach(([t,i])=>{e[t]=i}),e}onFieldChange(e,t,i){t!==i&&d(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,d(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}.getInstance(),E=new class{constructor(){this.events={},this.moduleStates=new Map}registerModule(e){this.moduleStates.set(e,{initialized:!0,name:e})}unregisterModule(e){this.moduleStates.delete(e)}isModuleInitialized(e){return this.moduleStates.get(e)?.initialized??!1}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.off(e,t)}}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){const i=String(e);if(console.log(`🔄 [FormEvents] Emitting event: ${i}`,{eventData:t,timestamp:(new Date).toISOString(),hasListeners:!!this.events[e],listenerCount:this.events[e]?.length||0}),!this.events[e])return void console.warn(`⚠️ [FormEvents] No listeners registered for event: ${i}`);if("skip:request"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});if("branch:change"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`❌ [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});let n=0,a=0;this.events[e].forEach((s,o)=>{try{console.log(`📡 [FormEvents] Calling listener ${o+1}/${this.events[e].length} for ${i}`),s(t),n++,console.log(`✅ [FormEvents] Listener ${o+1} completed successfully for ${i}`)}catch(n){a++,console.error(`💥 [FormEvents] LISTENER ERROR ${o+1}/${this.events[e].length} for '${i}':`,{error:n,errorMessage:n instanceof Error?n.message:String(n),errorStack:n instanceof Error?n.stack:void 0,eventData:t,listenerIndex:o})}}),console.log(`📊 [FormEvents] Event ${i} completed:`,{totalListeners:this.events[e].length,successful:n,failed:a,eventData:t})}},N=!1,T=[];function A(e=document){N&&(d("Branching already initialized, cleaning up first"),L()),console.log("🌿 [Branching] === INITIALIZATION START ==="),console.log("🔍 [Branching] Root element:",{isDocument:e===document,elementType:e.constructor.name}),d("Initializing branching logic");const t=e.querySelectorAll(s.MULTISTEP),i=e.querySelectorAll(s.STEP);console.log("📋 [Branching] Form detection:",{multistepForms:t.length,stepElements:i.length,multistepSelector:s.MULTISTEP,stepSelector:s.STEP}),0===t.length&&0===i.length&&(console.warn("⚠️ [Branching] Warning: Branching initialized but no multi-step forms found. Branch events may not be handled."),d("Warning: Branching initialized but no multi-step forms found. Branch events may not be handled."));const n=e.querySelectorAll(s.GO_TO);console.log("🎯 [Branching] data-go-to elements found:",{count:n.length,selector:s.GO_TO,elements:Array.from(n).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,dataGoTo:e.getAttribute("data-go-to"),name:e.name,type:e.type||e.tagName,value:e.value}))});const a=e.querySelectorAll(s.ANSWER);console.log("🎯 [Branching] data-answer elements found:",{count:a.length,selector:s.ANSWER,elements:Array.from(a).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,dataAnswer:e.getAttribute("data-answer"),isStep:e.hasAttribute("data-form")&&"step"===e.getAttribute("data-form")}))}),function(e){const t=v(e,"change",s.GO_TO,M),i=v(e,"input",s.GO_TO,M),n=v(e,"click",s.GO_TO,M),a=v(e,"click","label.radio_field, .w-radio, .radio_button-skip-step, .w-form-formradioinput, .w-radio-input",w);T.push(t,i,n,a)}(e),N=!0,console.log("✅ [Branching] Initialization complete"),d("Branching initialization complete"),E.registerModule("branching")}function w(e,t){let i=null;if(i=t.querySelector('input[type="radio"][data-go-to]'),!i){const e=t.closest("label");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(!i){const e=t.closest(".radio_field, .w-radio, .radio_component");e&&(i=e.querySelector('input[type="radio"][data-go-to]'))}if(i&&p(i,"data-go-to")){e.preventDefault(),e.stopPropagation(),i.checked=!0,C(i);const t=new Event("change",{bubbles:!0});Object.defineProperty(t,"target",{value:i}),M(t,i)}}function M(e,t){if(console.log("🌿 [Branch] Trigger event detected",{eventType:e.type,element:t,tagName:t.tagName,className:t.className,id:t.id}),!N)return void console.error("❌ [Branch] Module not initialized, ignoring branch trigger",{target:t,initialized:N,eventType:e.type});if(!y(t))return void console.log("ℹ️ [Branch] Element is not a form input, ignoring",{tagName:t.tagName,isInput:t instanceof HTMLInputElement,isSelect:t instanceof HTMLSelectElement,isTextarea:t instanceof HTMLTextAreaElement});const i=p(t,"data-go-to"),n=t.name||p(t,"data-step-field-name"),a=b(t),s=t.type||t.tagName;if(console.log("📋 [Branch] Data attributes analysis:",{"data-go-to":i,"data-step-field-name":p(t,"data-step-field-name"),name:t.name,type:s,value:a,checked:t.checked,allAttributes:Array.from(t.attributes).map(e=>({name:e.name,value:e.value}))}),i&&!function(e){return!!e&&(!!/^[a-zA-Z0-9_-]+$/.test(e)||(d("Invalid data-go-to value format",{goToValue:e}),!1))}(i))return void console.error("❌ [Branch] Invalid data-go-to value format",{goToValue:i,validFormat:"alphanumeric, hyphens, underscores only",pattern:"/^[a-zA-Z0-9_-]+$/"});console.log("🎯 [Branch] Processing branch trigger:",{element:t,goTo:i,value:a,type:s,fieldName:n,hasGoTo:!!i,hasValue:!!a}),n?(I.setField(n,a),console.log("💾 [Branch] Field value stored in FormState:",{fieldName:n,value:a,previousValue:I.getField(n)})):console.warn("⚠️ [Branch] No field name found, cannot store value in FormState",{element:t,name:t.name,dataStepFieldName:p(t,"data-step-field-name")});try{if(t instanceof HTMLInputElement)if("radio"===t.type&&t.checked){if(console.log("📻 [Branch] Processing radio button selection:",{name:t.name,value:t.value,checked:t.checked,goTo:i}),!i)return void console.warn("⚠️ [Branch] Radio button has no data-go-to attribute, skipping navigation",{element:t,name:t.name,value:t.value});if(!document.querySelector(`[data-answer="${i}"]`)){const e=document.querySelectorAll("[data-answer]"),t=Array.from(e).map(e=>p(e,"data-answer"));console.error("❌ [Branch] Target step not found in DOM!",{searchedFor:i,availableSteps:t,suggestion:`Check if element with data-answer="${i}" exists`,possibleMatches:t.filter(e=>e&&e.includes(i))})}!function(e){const t=e.name;if(!t)return;document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{if(t!==e){const e=p(t,"data-go-to");e&&x(e)}})}(t),C(t),$(i),console.log("🚀 [Branch] Emitting branch:change event:",{targetStepId:i,triggerValue:t.value,triggerType:"radio"}),E.emit("branch:change",{targetStepId:i})}else"checkbox"===t.type?(console.log("☑️ [Branch] Processing checkbox:",{name:t.name,value:t.value,checked:t.checked,goTo:i}),i&&(t.checked?(console.log("✅ [Branch] Checkbox checked, activating branch:",{goToValue:i}),$(i)):(console.log("❌ [Branch] Checkbox unchecked, deactivating branch:",{goToValue:i}),x(i)))):"radio"!==t.type&&"checkbox"!==t.type&&(console.log("📝 [Branch] Processing text input/other:",{type:t.type,name:t.name,value:a,goTo:i}),i&&(a?(console.log("✅ [Branch] Input has value, activating branch:",{goToValue:i,inputValue:a}),$(i)):(console.log("❌ [Branch] Input is empty, deactivating branch:",{goToValue:i}),x(i))));else console.log("📋 [Branch] Processing select/textarea:",{tagName:t.tagName,value:a,goTo:i}),i&&(a?(console.log("✅ [Branch] Element has value, activating branch:",{goToValue:i,inputValue:a}),$(i)):(console.log("❌ [Branch] Element is empty, deactivating branch:",{goToValue:i}),x(i)))}catch(e){console.error("💥 [Branch] Error handling branch trigger:",{error:e,errorMessage:e instanceof Error?e.message:String(e),errorStack:e instanceof Error?e.stack:void 0,element:t,goToValue:i,inputValue:a,fieldName:n})}const o={};Object.keys(o).length>0?(console.log("🔄 [Branch] Updating step visibility based on active conditions:",{activeConditions:o,conditionCount:Object.keys(o).length}),function(){const e=c("[data-show-if]"),t={};e.forEach(e=>{const i=p(e,"data-show-if"),n=p(e,"data-answer");i&&n&&(function(e,t){if(!e||"string"!=typeof e)return d("Invalid condition provided",{condition:e}),!1;try{const i=e.trim();return i.includes(",")?i.split(",").map(e=>e.trim()).some(e=>!!t[e]):i.includes("&")?i.split("&").map(e=>e.trim()).every(e=>!!t[e]):!!t[i]}catch(t){return d("Error evaluating condition",{condition:e,error:t}),!1}}(i,t)?(f(e),I.setStepVisibility(n,!0),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e;"true"===t.getAttribute("data-original-required")&&(t.required=!0)})):(h(e),I.setStepVisibility(n,!1),function(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");t.forEach(e=>{const t=e;t.setAttribute("data-original-required","true"),t.required=!1})}(e)))})}()):console.log("ℹ️ [Branch] No active conditions, skipping step visibility update")}function C(e){const t=e.name;if(!t)return;const i=p(e,"fs-inputactive-class")||"is-active-inputactive";document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{const n=t,a=n.closest("label");n!==e&&(n.classList.remove(i),a?.classList.remove(i))}),e.classList.add(i);const n=e.closest("label");n?.classList.add(i)}function $(e){}function x(e){e&&function(e){const t=[],i=u(`[data-answer="${e}"]`);if(i){c("[data-step-field-name]",i).forEach(e=>{const i=p(e,"data-step-field-name");i&&t.push(i)})}t.length>0&&I.clearFields(t)}(e)}function L(){N?(d("Resetting branching module"),E.unregisterModule("branching"),T.forEach(e=>e()),T=[],N=!1,d("Branching module reset")):d("Branching module not initialized, nothing to reset")}var V=!1,P=[];function F(e=document){V&&(d("Skip module already initialized, cleaning up first"),_()),d("Initializing basic skip functionality"),function(e){const t=v(e,"click",s.SKIP,O);P.push(t)}(e),V=!0,d("Skip initialization complete"),E.registerModule("skip")}function O(e,t){if(e.preventDefault(),!V)return void d("Skip module not initialized, ignoring skip button click");const i=p(t,"data-skip");if(!i||"true"===i||""===i)return void d("Invalid data-skip value - must specify target step",{dataSkip:i});if(!document.querySelector(`[data-answer="${i}"]`))return void d("Target step not found in DOM",{targetStepId:i});const n=I.getCurrentStep();n?(d("Processing skip request",{currentStepId:n,targetStepId:i}),E.emit("skip:request",{targetStepId:i})):d("No current step found for skip operation")}function _(){V?(d("Resetting skip functionality"),E.unregisterModule("skip"),P.forEach(e=>e()),P=[],V=!1,d("Skip reset complete")):d("Skip module not initialized, nothing to reset")}var k=!1,z=[],D=[],R=[],q=[],B=-1;function H(e=document){k&&(d("MultiStep already initialized, cleaning up first"),function(){if(!k)return void d("Multi-step module not initialized, nothing to reset");d("Resetting multi-step module"),E.unregisterModule("multiStep"),z.forEach(e=>e()),z=[],R=[],q=[],B=-1,k=!1,_(),D.forEach(e=>e()),D=[],d("Multi-step module reset")}()),console.log("🚀 [MultiStep] === INITIALIZATION START ==="),console.log("🔍 [MultiStep] Root element:",{isDocument:e===document,elementType:e.constructor.name,hasQuerySelector:"function"==typeof e.querySelector}),d("Initializing multi-step navigation with step/step_item architecture");const t=c(s.STEP,e);console.log("📋 [MultiStep] Step detection results:",{selector:s.STEP,foundElements:t.length,elements:Array.from(t).map((e,t)=>({index:t,tagName:e.tagName,id:e.id,className:e.className,hasDataForm:e.hasAttribute("data-form"),dataFormValue:e.getAttribute("data-form"),innerHTML:e.innerHTML.substring(0,100)+"..."}))}),0===t.length&&console.error("❌ [MultiStep] CRITICAL: No step elements found!",{selector:s.STEP,searchedIn:e===document?"entire document":"custom root element",possibleIssues:['Form missing data-form="multistep" attribute','Steps missing data-form="step" attributes',"Script loading before DOM is ready"],troubleshooting:{checkForm:"document.querySelector('[data-form=\"multistep\"]')",checkSteps:"document.querySelectorAll('[data-form=\"step\"]')",checkAllDataForm:"document.querySelectorAll('[data-form]')"}}),R=Array.from(t).map((e,t)=>{console.log(`🔍 [MultiStep] Processing step ${t}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataForm:e.hasAttribute("data-form"),dataFormValue:p(e,"data-form")});const i=e.querySelector(".step_wrapper[data-answer]");let n=null;console.log(`🔍 [MultiStep] Step ${t} data-answer search:`,{hasStepWrapper:!!i,stepWrapperInfo:i?{tagName:i.tagName,id:i.id,className:i.className,dataAnswer:i.getAttribute("data-answer")}:null}),i?(n=p(i,"data-answer"),console.log("📋 [MultiStep] Found step_wrapper with data-answer:",{stepIndex:t,dataAnswer:n,stepWrapper:{tagName:i.tagName,id:i.id,className:i.className}})):(console.log("ℹ️ [MultiStep] No step_wrapper found, checking step element directly"),n=p(e,"data-answer"),n?console.log("📋 [MultiStep] Found data-answer on step element:",{stepIndex:t,dataAnswer:n}):console.log("⚠️ [MultiStep] No data-answer found on step element either:",{stepIndex:t,allAttributes:Array.from(e.attributes).map(e=>({name:e.name,value:e.value}))})),n||(n=`step-${t}`,console.warn(`⚠️ [MultiStep] No data-answer found for step ${t}, auto-generating:`,{stepIndex:t,generatedDataAnswer:n,stepElement:{tagName:e.tagName,id:e.id,className:e.className,hasStepWrapper:!!i},recommendation:`Consider adding data-answer="${n}" to step_wrapper or step element for better control`}));const a=`step-${t}`;console.log(`🎯 [MultiStep] Step ${t} validation:`,{expected:a,found:n,isValid:!!n,matches:n===a,wasAutoGenerated:!p(e,"data-answer")&&!i});const s={element:e,id:n,index:t,type:p(e,"data-step-type")||void 0,subtype:p(e,"data-step-subtype")||void 0,number:p(e,"data-step-number")||void 0,isStepItem:!1};return console.log(`✅ [MultiStep] Step ${t} initialized successfully:`,{stepId:n,stepInfo:{id:s.id,type:s.type,subtype:s.subtype,number:s.number}}),I.setStepInfo(n,{type:s.type,subtype:s.subtype,number:s.number,visible:!1,visited:!1}),s}),console.log("📊 [MultiStep] Step initialization summary:",{totalStepsFound:t.length,totalStepsInitialized:R.length,stepIds:R.map(e=>e.id),stepIndices:R.map(e=>e.index)});const i=document.querySelectorAll(".step_item");if(console.log(`🌿 [MultiStep] Found ${i.length} step_items for branching logic`),q=Array.from(i).map((e,i)=>{console.log(`🔍 [MultiStep] Processing step_item ${i}:`,{element:e,tagName:e.tagName,id:e.id,className:e.className,hasDataAnswer:e.hasAttribute("data-answer"),dataAnswer:p(e,"data-answer")});const n=p(e,"data-answer");if(!n)return console.error("❌ [MultiStep] STEP_ITEM INITIALIZATION ERROR:",{stepItemIndex:i,error:`Step_item ${i} is missing required data-answer attribute`,stepItemElement:{tagName:e.tagName,id:e.id,className:e.className,innerHTML:e.innerHTML.substring(0,200)+"..."},solution:"Add data-answer attribute to step_item element",example:'<div class="step_item" data-answer="some-unique-id">',troubleshooting:{checkElement:"element.getAttribute('data-answer')",allDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}}),null;const a=e.closest('[data-form="step"]');let s;a?(s=Array.from(t).indexOf(a),console.log("🔗 [MultiStep] Found parent step for step_item:",{stepItemId:n,parentStepIndex:s,parentStepId:-1!==s?R[s]?.id:"NOT_FOUND",parentElement:{tagName:a.tagName,id:a.id,className:a.className}})):console.warn("⚠️ [MultiStep] No parent step found for step_item:",{stepItemId:n,stepItemIndex:i,warning:'step_item should be nested within a [data-form="step"] element',suggestion:"Check DOM structure - step_item should be inside a step element"});const o={element:e,id:n,index:i,type:p(e,"data-step-type")||void 0,subtype:p(e,"data-step-subtype")||void 0,number:p(e,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:-1!==s?s:void 0};return console.log(`✅ [MultiStep] Step_item ${i} initialized successfully:`,{stepItemId:n,stepItemInfo:{id:o.id,type:o.type,subtype:o.subtype,number:o.number,parentStepIndex:o.parentStepIndex,parentStepId:void 0!==o.parentStepIndex?R[o.parentStepIndex]?.id:void 0}}),I.setStepInfo(n,{type:o.type,subtype:o.subtype,number:o.number,visible:!1,visited:!1}),o}).filter(e=>null!==e),console.log("👁️ [MultiStep] === INITIAL STEP HIDING ==="),d("Starting to hide all steps initially",{totalSteps:R.length,totalStepItems:q.length}),R.forEach((e,t)=>{console.log(`🫥 [MultiStep] Hiding step ${t} (${e.id}):`,{stepId:e.id,element:{tagName:e.element.tagName,id:e.element.id,className:e.element.className},beforeHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:S(e.element),offsetHeight:e.element.offsetHeight,offsetWidth:e.element.offsetWidth}}),h(e.element),console.log(`✅ [MultiStep] Step ${t} hidden:`,{stepId:e.id,afterHide:{display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:S(e.element),offsetHeight:e.element.offsetHeight,offsetWidth:e.element.offsetWidth}})}),q.forEach((e,t)=>{console.log(`🫥 [MultiStep] Hiding stepItem ${t} (${e.id})`),h(e.element)}),console.log("✅ [MultiStep] Finished hiding all steps and step items"),d("Finished hiding all steps and step items"),function(e){const t=v(e,"click",s.NEXT_BTN,W),i=v(e,"click",s.BACK_BTN,j),n=v(e,"click",s.SUBMIT_BTN,Z);z.push(t,i,n),d("Navigation listeners setup complete (skip handling delegated to skip module)")}(e),function(){const e=E.on("branch:change",({targetStepId:e})=>{d(`Received branch:change event, navigating to: ${e}`),Y(e)}),t=E.on("skip:request",({targetStepId:e})=>{d("Received skip:request event",{targetStepId:e}),e?(d("Navigating to target step:",e),Y(e)):d("No target step provided in skip:request")});D.push(e,t)}(),F(e),console.log("🎬 [MultiStep] === INITIAL STEP SHOWING ==="),R.length>0){const t=e.querySelector(s.MULTISTEP),i=t?p(t,"data-start-step"):null,n=i||R[0].id,a=ee(n);console.log("🎯 [MultiStep] Initial step selection:",{totalSteps:R.length,multistepElement:!!t,startStepAttr:i,defaultFirstStepId:R[0].id,selectedStartStepId:n,selectedStartIndex:a,isValidIndex:-1!==a,allStepIds:R.map(e=>e.id)});const o=-1!==a?a:0;console.log(`🚀 [MultiStep] Showing initial step: index ${o} (${R[o]?.id})`),K(o)}else console.error("❌ [MultiStep] CRITICAL: No steps found to initialize - cannot show initial step!"),d("No steps found to initialize");k=!0,d("Multi-step initialization complete"),E.registerModule("multiStep")}function G(e,t=!0){const i=p(e,"data-step-subtype");if(!i)return;d(`${t?"Enabling":"Disabling"} required fields for subtype: ${i}`);e.querySelectorAll("[data-require-for-subtypes]").forEach(e=>{const n=e.getAttribute("data-require-for-subtypes"),a=e;n&&n.split(",").map(e=>e.trim()).includes(i)&&(t?(a.required=!0,a.disabled=!1):(a.required=!1,a.disabled=!0,a.value=""))})}function U(e){d(`Attempting to show step_item: ${e}`);const t=q.find(t=>t.id===e);if(!t){const t=q.find(t=>p(t.element,"data-answer")===e);return t?(d(`Found step_item by data-answer: ${e}`),U(t.id)):void d(`Step item not found: ${e}`)}if(!R[t.parentStepIndex])return void d(`Parent step not found for step_item: ${e}`);d(`Showing step_item ${e} in parent step ${t.parentStepIndex}`);q.filter(e=>e.parentStepIndex===t.parentStepIndex).forEach(e=>{h(e.element),G(e.element,!1),I.setStepVisibility(e.id,!1)}),f(t.element);let i=t.element.parentElement;for(;i&&!i.classList.contains("multi-form_step");)i.classList.contains("step_wrapper")&&(i.style.display="",i.style.visibility="",g(i,"hidden-step"),g(i,"hidden-step-item")),i=i.parentElement;G(t.element,!0),I.setStepVisibility(e,!0),I.setStepInfo(e,{visited:!0}),d(`Successfully showed step_item: ${e}`)}function W(e){console.log("🔍 NEXT BUTTON CLICK HANDLER TRIGGERED"),console.log("Event target:",e.target),console.log("Event currentTarget:",e.currentTarget);const t=e.target,i=t.getAttribute("data-skip");i?console.log("❌ CONFLICT DETECTED: Skip button triggered next button handler!",{skipAttribute:i,targetElement:t,targetTagName:t.tagName,targetClassName:t.className}):(console.log("✅ Legitimate next button click - proceeding with navigation"),e.preventDefault(),function(){if(!k)return void d("Multi-step module not initialized, ignoring goToNextStep call");d("=== GO TO NEXT STEP FUNCTION START ==="),console.log("🔍 GO TO NEXT STEP CALLED"),console.trace("Call stack for goToNextStep:");const e=te();if(!e)return void d("No current step found");d("Current step info",{stepId:e.id,stepIndex:B,stepElement:{tagName:e.element.tagName,id:e.element.id,className:e.element.className}});const t=B+1;console.log(`🔍 ATTEMPTING TO NAVIGATE TO NEXT STEP - Current: ${B}, Next: ${t}`),d("Sequential navigation logic",{currentIndex:B,nextIndex:t,totalSteps:R.length,hasNextStep:t<R.length}),t<R.length?(d(`Going to next sequential step: index ${t}`),K(t)):d("Already at last step");d("=== GO TO NEXT STEP FUNCTION END ===")}())}function j(e){e.preventDefault(),function(){const e=I.goToPreviousStep();if(e){const t=ee(e);if(-1!==t)return void K(t)}const t=B-1;t>=0?K(t):d("Already at first step")}()}function Z(e){if(!e.target.closest("form"))return void d("Form not found, preventing submission");if(!function(){for(const e of R)if(I.isStepVisible(e.id)&&!X(e.element))return!1;return!0}())return e.preventDefault(),void d("Form validation failed, preventing submission");d("Form validation passed, allowing submission")}function Y(e){if(!k)return void console.error("❌ [MultiStep] Module not initialized, ignoring goToStepById call",{stepId:e,initialized:k,totalSteps:R.length,totalStepItems:q.length});console.log("🎯 [MultiStep] Navigation request received:",{targetStepId:e,currentStepIndex:B,currentStepId:I.getCurrentStep(),totalSteps:R.length,totalStepItems:q.length});const t=R.map(e=>e.id),i=q.map(e=>e.id);console.log("📋 [MultiStep] Available navigation targets:",{searchingFor:e,parentStepIds:t,branchingStepItemIds:i,totalParentSteps:R.length,totalBranchingItems:q.length});const n=q.find(t=>t.id===e);if(n){if(console.log("✅ [MultiStep] Found as branching step_item:",{stepItemId:e,parentStepIndex:n.parentStepIndex,stepItemIndex:n.index,stepItemElement:{tagName:n.element.tagName,id:n.element.id,className:n.element.className,dataAnswer:p(n.element,"data-answer"),isVisible:S(n.element),parentStep:void 0!==n.parentStepIndex?R[n.parentStepIndex]?.id:"unknown"}}),void 0!==n.parentStepIndex){const i=R[n.parentStepIndex];if(!i)return void console.error("❌ [MultiStep] Parent step not found for step_item!",{stepItemId:e,parentStepIndex:n.parentStepIndex,availableSteps:t,totalSteps:R.length});console.log("🔄 [MultiStep] Navigating to parent step first:",{parentStepId:i.id,parentStepIndex:n.parentStepIndex,currentStepIndex:B}),K(n.parentStepIndex),console.log("🌿 [MultiStep] Showing branching option:",{stepItemId:e,withinParentStep:i.id}),U(e)}return void console.log("✅ [MultiStep] Successfully navigated to step_item:",e)}console.log("ℹ️ [MultiStep] Not found in branching step_items, checking regular steps");const a=ee(e);if(console.log("🔍 [MultiStep] Regular step search result:",{stepId:e,foundIndex:a,isValidIndex:-1!==a,searchMethod:"findStepIndexById"}),-1!==a){const t=R[a];return console.log("✅ [MultiStep] Found as regular step:",{stepId:e,stepIndex:a,stepElement:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:p(t.element,"data-answer"),isVisible:S(t.element)}}),console.log("🚀 [MultiStep] Calling goToStep with index:",{stepIndex:a,stepId:t.id}),K(a),void console.log("✅ [MultiStep] Successfully navigated to regular step:",e)}console.error("❌ [MultiStep] STEP NOT FOUND:",{searchedFor:e,searchedIn:"both regular steps and branching step_items",availableRegularSteps:t,availableBranchingItems:i,totalElements:{steps:R.length,stepItems:q.length},suggestion:`Check if element with data-answer="${e}" exists in DOM`,troubleshooting:{checkDataAnswer:`document.querySelector('[data-answer="${e}"]')`,listAllDataAnswers:"Array.from(document.querySelectorAll('[data-answer]')).map(el => el.getAttribute('data-answer'))"}});const s=document.querySelector(`[data-answer="${e}"]`);s&&console.error("🔍 [MultiStep] Step exists in DOM but not registered!",{stepId:e,domElement:{tagName:s.tagName,id:s.id,className:s.className,dataAnswer:p(s,"data-answer"),hasStepAttribute:s.hasAttribute("data-form"),stepAttribute:p(s,"data-form"),isVisible:s instanceof HTMLElement&&S(s)},possibleCause:"Element exists but was not properly initialized during module setup"})}function X(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(S(t)){if(!t.value||""===t.value.trim())return d("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return d("Validation failed: invalid email format"),t.focus(),!1}}}return!0}function K(e){if(console.log("🎯 [STEP NAVIGATION] === GO TO STEP START ==="),console.log("🎯 [STEP NAVIGATION] Starting goToStep:",{requestedIndex:e,currentIndex:B,totalSteps:R.length,stepExists:e>=0&&e<R.length,initialized:k}),!k)return console.error("❌ [STEP NAVIGATION] Module not initialized!"),void d("Multi-step module not initialized, ignoring goToStep call");if(e<0||e>=R.length)return void console.error("❌ [STEP NAVIGATION] Invalid step index:",{requestedIndex:e,validRange:"0 to "+(R.length-1),totalSteps:R.length,availableStepIds:R.map(e=>e.id)});const t=R[e];if(console.log("📋 [STEP NAVIGATION] Target step details:",{stepIndex:e,stepId:t.id,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,dataAnswer:p(t.element,"data-answer"),innerHTML:t.element.innerHTML.length>0?`${t.element.innerHTML.substring(0,100)}...`:"EMPTY",hasContent:t.element.children.length>0,childrenCount:t.element.children.length},visibility:{isVisible:S(t.element),display:getComputedStyle(t.element).display,visibility:getComputedStyle(t.element).visibility,opacity:getComputedStyle(t.element).opacity,hasHiddenClass:t.element.classList.contains("hidden-step"),offsetHeight:t.element.offsetHeight,offsetWidth:t.element.offsetWidth}}),0===t.element.children.length&&""===t.element.innerHTML.trim()&&console.warn("⚠️ [STEP NAVIGATION] Target step appears to be empty!",{stepId:t.id,stepIndex:e,innerHTML:t.element.innerHTML,textContent:t.element.textContent,childrenCount:t.element.children.length,possibleIssue:"This step may be a blank wrapper"}),d(`Attempting to go to step index: ${e}`),-1!==B){const e=R[B];console.log("👋 [STEP NAVIGATION] Hiding current step:",{currentIndex:B,currentStepId:e.id,beforeHide:{isVisible:S(e.element),display:getComputedStyle(e.element).display}}),Q(B),console.log("✅ [STEP NAVIGATION] Current step hidden:",{stepId:e.id,afterHide:{isVisible:S(e.element),display:getComputedStyle(e.element).display}})}console.log("👁️ [STEP NAVIGATION] Showing target step:",{stepIndex:e,stepId:t.id,beforeShow:{isVisible:S(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step")}}),J(e),console.log("✅ [STEP NAVIGATION] Target step shown:",{stepId:t.id,afterShow:{isVisible:S(t.element),display:getComputedStyle(t.element).display,hasHiddenClass:t.element.classList.contains("hidden-step"),actuallyVisible:t.element.offsetHeight>0&&t.element.offsetWidth>0}}),console.log("🎯 [STEP NAVIGATION] === GO TO STEP END ===")}function J(e){if(e<0||e>=R.length)return void d(`Invalid step index: ${e}`);const t=R[e];t?(console.log(`🔄 [MultiStep] Showing step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className}}),R.forEach((t,i)=>{i!==e&&(Q(i),t.element.classList.remove("active-step"))}),f(t.element),t.element.classList.add("active-step"),I.setStepVisibility(t.id,!0),I.setStepInfo(t.id,{visited:!0}),B=e,I.setCurrentStep(t.id),function(){const e=document.querySelector(s.NEXT_BTN),t=document.querySelector(s.BACK_BTN),i=document.querySelector(s.SUBMIT_BTN);if(!e||!t||!i)return;const n=0===B,a=B===R.length-1;t.style.display=n?"none":"",a?(e.style.display="none",i.style.display=""):(e.style.display="",i.style.display="none")}(),E.emit("step:change",{currentStepIndex:e,currentStepId:t.id}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now visible:`,{isVisible:S(t.element),hasActiveClass:t.element.classList.contains("active-step"),formStateVisible:I.isStepVisible(t.id),computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility}),S(t.element)||(console.error(`❌ [MultiStep] Step ${e} (${t.id}) is still not visible after showElement!`),function(e,t){const i=getComputedStyle(e),n=[];let a=e;for(;a&&a!==document.body;)n.push(a),a=a.parentElement;console.log(`🔍 [MultiStep] Diagnosing visibility issues for step ${t}:`,{targetElement:{tagName:e.tagName,id:e.id,className:e.className,computedDisplay:i.display,computedVisibility:i.visibility,computedOpacity:i.opacity,inlineDisplay:e.style.display,inlineVisibility:e.style.visibility,inlineOpacity:e.style.opacity,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:S(e)},parentChain:n.map(e=>({tagName:e.tagName,id:e.id,className:e.className,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,computedOpacity:getComputedStyle(e).opacity,hasHiddenClass:e.classList.contains("hidden-step")})),possibleConflicts:{hasDisplayNone:"none"===i.display,hasVisibilityHidden:"hidden"===i.visibility,hasZeroOpacity:"0"===i.opacity,hasHiddenClass:e.classList.contains("hidden-step"),parentWithDisplayNone:n.some(e=>"none"===getComputedStyle(e).display),parentWithVisibilityHidden:n.some(e=>"hidden"===getComputedStyle(e).visibility)}})}(t.element,t.id))):d(`Step not found at index: ${e}`)}function Q(e){if(e<0||e>=R.length)return;const t=R[e];console.log(`🔄 [MultiStep] Hiding step ${e}:`,{stepId:t.id,stepIndex:e,element:{tagName:t.element.tagName,id:t.element.id,className:t.element.className,hadActiveClass:t.element.classList.contains("active-step")}}),h(t.element),t.element.classList.remove("active-step"),I.setStepVisibility(t.id,!1),q.forEach(t=>{t.parentStepIndex===e&&(h(t.element),I.setStepVisibility(t.id,!1))}),console.log(`✅ [MultiStep] Step ${e} (${t.id}) is now hidden:`,{isVisible:S(t.element),hasActiveClass:t.element.classList.contains("active-step"),formStateVisible:I.isStepVisible(t.id),computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility})}function ee(e){return R.findIndex(t=>t.id===e)}function te(){return R[B]||null}function ie(){return{step:te(),index:B,totalSteps:R.length,isFirstStep:0===B,isLastStep:B===R.length-1}}var ne=new Map,ae=new Map;function se(e=document){d("Initializing error handling");e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||p(e,"data-step-field-name");t&&ne.set(t,{fieldName:t,element:e,customMessage:p(e,"data-error-message")||void 0})}),d(`Error handling initialized for ${ne.size} fields`)}function oe(e,t){const i=ne.get(e);if(!i)return void d(`Cannot show error for unknown field: ${e}`);const n=t||i.customMessage||"This field has an error";d(`Showing error for field: ${e}`,{message:n}),m(i.element,l.ERROR_FIELD);const a=function(e){if(!e||!e.element)return d("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return d(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`${s.ERROR_DISPLAY}[data-field="${e.fieldName}"]`)}catch(t){return d(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.setAttribute("data-form","error"),t.setAttribute("data-field",e.fieldName);const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),d(`Created error element for field: ${e.fieldName}`)}catch(t){return d(`Error creating error element for field: ${e.fieldName}`,t),null}return t}(i);a&&(a.textContent=n,m(a,l.ACTIVE_ERROR),i.errorElement=a),function(e){const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||(e.scrollIntoView({behavior:"smooth",block:"center"}),d(`Scrolled to field with error: ${e.name||"unnamed"}`))}(i.element)}function le(e){const t=ne.get(e);t?(d(`Clearing error for field: ${e}`),g(t.element,l.ERROR_FIELD),t.errorElement&&(t.errorElement.textContent="",g(t.errorElement,l.ACTIVE_ERROR))):d(`Cannot clear error for unknown field: ${e}`)}function re(){d("Clearing all field errors"),ne.forEach((e,t)=>{le(t)})}function de(){const e={};return ae.forEach((t,i)=>{e[i]={message:t.message}}),e}var ce=!1,ue=[],pe=new Map;function me(e=document){ce&&(d("Validation already initialized, cleaning up first"),d("Resetting validation"),ue.forEach(e=>e()),ue=[],d("Clearing all field validation"),pe.forEach((e,t)=>{!function(e){const t=pe.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,ye(t.element,!0),d(`Cleared validation for field: ${e}`))}(t)}),pe.clear(),ce=!1,d("Validation reset complete")),d("Initializing form validation");const t=c("input, select, textarea",e);d(`Found ${t.length} form inputs`),t.forEach(e=>{if(!y(e))return;const t=e,i=t.name||p(e,"data-step-field-name");if(!i)return void d("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:p(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:p(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=p(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=p(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=p(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(pe.set(i,{element:e,rules:n,isValid:!0}),d(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):d(`No validation rules found for field: ${i}`)}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}((...e)=>{ge(e[0],e[1])},o.VALIDATION_DELAY),i=v(e,"input","input, select, textarea",t),n=v(e,"blur","input, select, textarea",ge),a=v(e,"change","input, select, textarea",ge);ue.push(i,n,a)}(e),ce=!0,d("Validation initialization complete")}function ge(e,t){if(!y(t))return;const i=t,n=i.name||p(t,"data-step-field-name");if(!n)return void d("Skipping validation - no field name found",{element:t,name:i.name,dataStepFieldName:p(t,"data-step-field-name")});const a=t.closest(s.STEP);if(a){const e=p(a,"data-answer");if(e&&!I.isStepVisible(e))return void d(`Skipping validation for field in hidden step: ${n}`)}fe(n)}function fe(e){const t=pe.get(e);if(!t)return d(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return d(`No element found for field: ${e}`),!0;const n=b(i);d(`Validating field: ${e}`,{value:n,elementExists:!!i});for(const a of t.rules){const{isValid:s,message:o}=Se(n,a);if(!s)return t.isValid=!1,t.errorMessage=o||"Invalid field",oe(e,t.errorMessage),ye(i,!1,t.errorMessage),!1}return t.isValid=!0,le(e),ye(i,!0),!0}var he={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1\s?)?(\([0-9]{3}\)|[0-9]{3})[\s\-]?[0-9]{3}[\s\-]?[0-9]{4}$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,zipCode:/^\d{5}(-\d{4})?$/,zipCodeCA:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,creditCard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/,ssn:/^\d{3}-?\d{2}-?\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/};function Se(e,t){switch(t.type){case"required":return{isValid:Array.isArray(e)?e.length>0:!!e&&""!==String(e).trim(),message:t.message};case"email":return{isValid:he.email.test(String(e)),message:t.message||"Please enter a valid email address"};case"phone":const i=String(e).replace(/[\s\-\(\)]/g,"");return{isValid:he.phone.test(i)||he.phoneUS.test(String(e)),message:t.message||"Please enter a valid phone number"};case"min":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length>=t.value,message:t.message||`Minimum ${t.value} characters required`};case"max":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length<=t.value,message:t.message||`Maximum ${t.value} characters allowed`};case"pattern":return t.value instanceof RegExp?{isValid:t.value.test(String(e)),message:t.message||"Please enter a valid format"}:{isValid:!0};case"custom":if(!t.validator)return{isValid:!0};try{return{isValid:t.validator(e),message:t.message||"Invalid value"}}catch(e){return d("Error in custom validator",{error:e,rule:t}),{isValid:!1,message:"Validation error occurred"}}default:return{isValid:!0}}}function ye(e,t,i){const n=e.name||p(e,"data-step-field-name");n&&(t?le(n):oe(n,i))}function be(e){const t=u(`[data-answer="${e}"]`);if(!t)return d(`Step not found with data-answer="${e}"`),!0;if(!I.isStepVisible(e))return d(`Skipping validation for hidden step: ${e}`),!0;d(`Validating step: ${e}`);const i=t.querySelectorAll("input, select, textarea");let n=!0;return i.forEach(e=>{if(!y(e))return;const t=e.name||p(e,"data-step-field-name");if(t){fe(t)||(n=!1)}}),d(`Step validation result: ${e}`,{isValid:n}),n}function ve(){d("Validating all visible fields");let e=!0;const t={};for(const[i,n]of pe){const a=n.element.closest(s.STEP);let o=!0;if(a){const e=p(a,"data-answer");e&&!I.isStepVisible(e)&&(o=!1)}if(o){const n=fe(i);t[i]=n,n||(e=!1)}}return d("All visible fields validation complete",{allValid:e,results:t}),e}var Ie=!1,Ee=[],Ne=[];function Te(e=document){Ie&&(d("Summary already initialized, cleaning up first"),d("Resetting summary functionality"),Ee.forEach(e=>e()),Ee=[],Ne.forEach(e=>{xe(e.element,"")}),Ne=[],Ie=!1,d("Summary reset complete")),d("Initializing summary functionality");const t=c(s.SUMMARY_FIELD,e);d(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=p(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=p(e,"data-join"),a=n&&n in o.JOIN_SEPARATOR?n:"space",s=p(e,"data-summary-type")||void 0,l=p(e,"data-summary-subtype")||void 0,r=p(e,"data-summary-number")||void 0,c={element:e,fieldNames:i,joinType:a,type:s,subtype:l,number:r};Ne.push(c),d("Summary field configured",{fieldNames:i,joinType:a,type:s,subtype:l,number:r})})}(t),function(e){const t=v(e,"input",s.STEP_FIELD_NAME,Ae),i=v(e,"change",s.STEP_FIELD_NAME,Ae),n=v(e,"blur",s.STEP_FIELD_NAME,Ae);Ee.push(t,i,n)}(e),Ce(),Ie=!0,d("Summary initialization complete")}function Ae(e,t){if(!y(t))return;const i=p(t,"data-step-field-name");if(!i)return;const n=b(t);d(`Summary field changed: ${i}`,{value:n}),I.setField(i,n),we(i)}function we(e){Ne.forEach(t=>{t.fieldNames.includes(e)&&$e(t)})}function Me(){d("Updating all summaries"),Ce()}function Ce(){Ne.forEach(e=>{$e(e)})}function $e(e){const t=[];e.fieldNames.forEach(e=>{const i=I.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=o.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);xe(e.element,i),d("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function xe(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}function Le(e){e?(d("Clearing specific summary fields",e),I.clearFields(e),e.forEach(e=>{we(e)})):(d("Clearing all summaries"),I.clear(),Ce())}function Ve(){const e={};return Ne.forEach((t,i)=>{const n=t.type&&t.subtype&&t.number?`${t.type}-${t.subtype}-${t.number}`:`summary-${i}`;e[n]={hasContent:(t.element.textContent||"").trim().length>0}}),e}console.log("🚀 [FormLib] === SCRIPT VERSION CHECK ==="),console.log("📦 [FormLib] Script Version: CACHE_BUST_2025_01_10_14_45_FRESH"),console.log("🔗 [FormLib] Expected URL: @9705259 or newer"),console.log("⏰ [FormLib] Load Time:",(new Date).toISOString());var Pe,Fe=class e{constructor(){this.initialized=!1,this.rootElement=document,d("FormLibrary instance created")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e=document){this.initialized&&(d("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,d("Initializing FormLibrary with enhanced skip functionality",{root:e===document?"document":"custom element"});const t=e.querySelectorAll(s.MULTISTEP),i=e.querySelectorAll(s.LOGIC),n=e.querySelectorAll(s.STEP);if(d("Form detection results",{multistepForms:t.length,logicForms:i.length,stepElements:n.length}),0!==t.length||0!==n.length)try{se(e),me(e),i.length>0&&A(e),(t.length>0||n.length>0)&&H(e),Te(e),this.initialized=!0,d("FormLibrary initialization complete with enhanced skip functionality"),this.logCurrentState()}catch(e){throw d("FormLibrary initialization failed",e),e}else d("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){d("Destroying FormLibrary");try{L(),_()}catch(e){d("Error during FormLibrary destruction",e)}I.clear(),r.clear(),this.initialized=!1,d("FormLibrary destruction complete")}else d("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:I.getDebugInfo(),branching:{initialized:N},multiStep:{initialized:k,currentStepIndex:B,totalSteps:R.length,steps:R.map(e=>({id:e.id,index:e.index,visible:S(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:{initialized:ce,fieldValidations:Array.from(pe.entries()).reduce((e,[t,i])=>(e[t]={isValid:i.isValid,errorMessage:i.errorMessage,rules:i.rules.map(e=>e.type)},e),{})},errors:de(),summary:Ve(),skip:{initialized:V}}}logCurrentState(){d("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return d("Cannot validate form - library not initialized"),!1;d("Validating entire form");const e=ve();return d("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){d("Resetting form to initial state"),re(),I.clear(),Le();try{K(0)}catch(e){d("Could not go to first step during reset",e)}d("Form reset complete")}else d("Cannot reset form - library not initialized")}getFormData(){return I.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{I.setField(e,t)}),Me(),d("Form data set",e)}}.getInstance(),Oe=Fe;if("undefined"!=typeof window){const e=()=>{const e=document.querySelectorAll(s.MULTISTEP),t=document.querySelectorAll(s.STEP);(e.length>0||t.length>0)&&(d("Auto-initializing FormLibrary on DOM ready"),Fe.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}return"undefined"!=typeof window&&(window.FormLib=Fe,d("FormLib attached to window for debugging")),Pe=a,((a,s,o,l)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let r of i(s))n.call(a,r)||r===o||e(a,r,{get:()=>s[r],enumerable:!(l=t(s,r))||l.enumerable});return a})(e({},"__esModule",{value:!0}),Pe)})();