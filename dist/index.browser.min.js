/*!
 * Form Functionality Library v1.1.0
 * Browser-compatible bundle
 */
!function(e){"use strict";const t='[data-form="multistep"]',i="[data-logic]",n='[data-form="step"]',a="[data-answer]",s='[data-form="next-btn"]',r='[data-form="back-btn"]',o='[data-form="submit"]',l="[data-skip]",d="[data-go-to]",c="[data-step-field-name]",u="[data-summary-field]",p={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},m="active-step",f="hidden-step-item",h="error-field",g="error-message",y="disabled";function b(e,t){if(!p.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${p.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function v(e,t=document){return t.querySelectorAll(e)}function S(e,t=document){return t.querySelector(e)}function $(e,t){return e.getAttribute(t)}function F(e,t){e.classList.add(t)}function E(e,t){e.classList.remove(t)}function A(e){return"none"!==e.style.display&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function I(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function L(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function w(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}class C{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},b("FormState initialized")}static getInstance(){return C.instance||(C.instance=new C),C.instance}setField(e,t){const i=this.data[e];this.data[e]=t,b(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},b("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&b("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),b(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),b(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),b(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e){this.branchPath.skippedSteps.includes(e)||(this.branchPath.skippedSteps.push(e),b(`Step skipped: ${e}`,this.branchPath.skippedSteps))}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,b(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(e,t,i){const n={};return Object.entries(this.data).forEach(([e,t])=>{n[e]=t}),n}onFieldChange(e,t,i){t!==i&&b(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,b(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}const x=C.getInstance();let N=!1,k=[];function T(e=document){N&&(b("Branching already branchingInitialized, cleaning up first"),j()),b("Initializing branching logic");b(`Found ${v(d,e).length} branch triggers`);b(`Found ${v(a,e).length} conditional steps`),function(e){const t=w(e,"change",d,z),i=w(e,"input",d,z),n=w(e,"click",d,z),a=w(e,"click","label.radio_field, label.w-radio, .radio_label, .w-form-label, .w-radio-input",V);k.push(t,i,n,a)}(e),N=!0,b("Branching initialization complete")}function V(e,t){console.log("[FormLib] Radio label clicked",{target:t,tagName:t.tagName,className:t.className});let i=t.querySelector('input[type="radio"][data-go-to]');if(!i){const e=t.closest("label.radio_field, label.w-radio");e&&(i=e.querySelector('input[type="radio"][data-go-to]'),console.log("[FormLib] Found radio input in parent label",{parentLabel:e,radioInput:i}))}if(!i){console.log("[FormLib] No radio input with data-go-to found in clicked label or parent label");const e=t.querySelector('input[type="radio"]')||t.closest("label")?.querySelector('input[type="radio"]');return void(e&&console.log("[FormLib] Found radio input without data-go-to",{radioInput:e,goTo:$(e,"data-go-to"),name:e.name,value:e.value,allAttributes:Array.from(e.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}))}const n=$(i,"data-go-to");console.log("[FormLib] Found radio input in label",{radioInput:i,goTo:n,name:i.name,value:i.value,allAttributes:Array.from(i.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}),i.checked=!0,q(i);const a=new Event("change",{bubbles:!0});Object.defineProperty(a,"target",{value:i}),console.log("[FormLib] Triggering branch logic for data-go-to:",n),z(a,i)}function z(e,t){if(console.log("[FormLib] handleBranchTrigger called",{target:t,tagName:t.tagName,type:t.type,isFormInput:I(t)}),!I(t))return void console.log("[FormLib] Target is not a form input, ignoring");const i=$(t,"data-go-to"),n=L(t);console.log("[FormLib] Branch trigger activated",{element:t,goTo:i,value:n,type:t.type||t.tagName,checked:t.checked,name:t.name,allAttributes:Array.from(t.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")});const a=t.name||$(t,"data-step-field-name");var s;a&&x.setField(a,n),t instanceof HTMLInputElement?"radio"===t.type&&t.checked?(!function(e){if(!e.name)return;b(`Handling radio group selection for: ${e.name}`,{selectedValue:e.value,selectedGoTo:$(e,"data-go-to")});document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(t=>{const i=t,n=$(i,"data-go-to");i!==e&&n&&(b(`Deactivating radio option: ${n}`),D(n),n&&P(n))})}(t),q(t),_(i,t.value),i&&(b(`Triggering step_item visibility: ${s=i}`),import("./multiStep.js").then(({showStepItem:e})=>{e(s)}).catch(e=>{console.warn("[FormLib] Failed to show step_item:",e)}))):"checkbox"===t.type?t.checked?_(i,t.value):D(i):"radio"!==t.type&&"checkbox"!==t.type&&(n?_(i,n):D(i)):n?_(i,n):D(i);const r=x.getBranchPath().activeConditions;Object.values(r).some(e=>null!=e&&""!==e)&&B()}function q(e){const t=$(e,"fs-inputactive-class")||"is-active-inputactive";if(e.name){document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(i=>{const n=i,a=n.closest("label");n!==e&&(n.classList.remove(t),a&&a.classList.remove(t))})}e.classList.add(t);const i=e.closest("label");i&&i.classList.add(t),b(`Applied active class to radio button: ${e.name}`,{activeClass:t,radioClasses:e.className,labelClasses:i?.className})}function P(e){b(`Hiding step_item: ${e}`),import("./multiStep.js").then(({hideStepItem:t})=>{t&&t(e)}).catch(t=>{b(`Manual step_item hiding for: ${e}`);document.querySelectorAll(`[data-answer="${e}"]`).forEach(e=>{const t=e;t.style.display="none",t.style.visibility="hidden",t.classList.add("hidden-step")})})}function _(e,t){e&&(b(`Activating branch: ${e}`,{value:t,valueType:typeof t,targetString:String(e)}),x.setActiveCondition(e,t),function(){const e=v(n),t=[],i=[];e.forEach(e=>{const n=$(e,"data-answer"),a=!n||x.isStepVisible(n);e.querySelectorAll("input, select, textarea").forEach(e=>{const n=e.name||$(e,"data-step-field-name");n&&(a?t.push(n):i.push(n))})});const a=i.filter(e=>!t.includes(e));a.length>0&&x.clearFields(a)}(),b("Active conditions after branch activation",{activeConditions:x.getBranchPath().activeConditions}))}function D(e){e&&(b(`Deactivating branch: ${e}`),x.setActiveCondition(e,null),function(e){const t=S(`[data-answer="${e}"]`);if(!t)return;const i=t.querySelectorAll("input, select, textarea"),n=[];i.forEach(e=>{const t=e.name||$(e,"data-step-field-name");t&&n.push(t)}),n.length>0&&(x.clearFields(n),b(`Cleared fields from branch ${e}`,n))}(e),B())}function B(){const e=v(a),t=x.getBranchPath().activeConditions;b("Updating step visibility",{activeConditions:t}),e.forEach(e=>{const i=$(e,"data-answer"),n=function(e,t){if(!e)return!0;for(const[i,n]of Object.entries(t))if(i===e&&null!=n&&""!==n)return!0;return!1}(i,t);i&&x.setStepInfo(i,{visible:n});const a=e;n?(a.style.display="",a.classList.remove("hidden-step"),b(`Step made visible: ${i}`)):(a.style.display="none",a.classList.add("hidden-step"),b(`Step hidden: ${i}`))})}function j(){b("Resetting branching logic"),k.forEach(e=>e()),k=[];const e=x.getBranchPath().activeConditions;Object.keys(e).forEach(e=>{x.setActiveCondition(e,null)});v(a).forEach(e=>{const t=e;t.style.display="none",t.classList.add("hidden-step")}),N=!1,b("Branching reset complete")}e.debugBranching=function(){const e=x.getBranchPath().activeConditions;b("=== DEBUG: Branching State ==="),b("Active Conditions:",e);const t=v(d);b("All Branch Triggers:"),t.forEach((e,t)=>{const i=$(e,"data-go-to");let n="",a=!1,s=e.tagName;if(I(e)){const t=L(e);n=Array.isArray(t)?t.join(", "):t,e instanceof HTMLInputElement&&(a=e.checked,s=e.type)}b(`Trigger ${t}:`,{element:e,goTo:i,value:n,checked:a,type:s})});const i=v(a);b("All Answer Steps:"),i.forEach((e,t)=>{b(`Answer Step ${t}:`,{element:e,dataAnswer:$(e,"data-answer"),visible:"none"!==e.style.display})}),b("=== END DEBUG ===")};let M=!1,O=[],R=[],H=[],G=0,U=null;function J(e=document){M&&(b("MultiStep already multiStepInitialized, cleaning up first"),b("Resetting multi-step navigation"),O.forEach(e=>e()),O=[],R.forEach((e,t)=>{ae(t)}),R=[],G=0,M=!1,b("Multi-step reset complete")),b("Initializing multi-step navigation with step/step_item architecture");const t=v(n,e);b(`Found ${t.length} parent steps`),R=Array.from(t).map((e,t)=>{const i=e,n=$(e,"data-answer"),a=n||`step-${t}`,s={element:i,id:a,index:t,type:$(e,"data-step-type")||void 0,subtype:$(e,"data-step-subtype")||void 0,number:$(e,"data-step-number")||void 0,isStepItem:!1};return b(`Registering parent step ${t}`,{stepId:a,dataAnswer:n,type:s.type,element:i}),x.setStepInfo(a,{type:s.type,subtype:s.subtype,number:s.number,visible:0===t,visited:!1}),s}),H=[],R.forEach((e,t)=>{const i=e.element.querySelectorAll(".step_item, .step-item");console.log(`[FormLib] Found ${i.length} step_items in parent step ${t} (${e.id})`),i.forEach((i,n)=>{const a=i,s=$(i,"data-answer"),r=$(i,"data-go-to");if(console.log(`[FormLib] Processing step_item ${n}:`,{dataAnswer:s,dataGoTo:r,parentStepId:e.id,parentStepIndex:t,element:a,allAttributes:Array.from(a.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}),!s)return void console.warn(`[FormLib] Step item ${n} in parent step ${t} missing required data-answer attribute`);const o={element:a,id:s,index:H.length,type:$(i,"data-step-type")||void 0,subtype:$(i,"data-step-subtype")||void 0,number:$(i,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:t};console.log("[FormLib] Registered step_item:",{stepId:s,parentStepIndex:t,globalIndex:H.length,type:o.type,element:a}),x.setStepInfo(s,{type:o.type,subtype:o.subtype,number:o.number,visible:!1,visited:!1}),H.push(o)})}),R.forEach((e,t)=>{W(e.element,`parent step ${t}`)}),H.forEach((e,t)=>{W(e.element,`step_item ${t} (${e.id})`)}),function(e){const t=w(e,"click",s,Q),i=w(e,"click",r,Z),n=w(e,"click",l,ee),a=w(e,"click",o,te);O.push(t,i,n,a)}(e),R.length>0&&ne(0),M=!0,b("Multi-step initialization complete",{parentStepCount:R.length,stepItemCount:H.length})}function W(e,t){const i=t.includes("step_item");i?(e.style.display="none !important",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden",e.style.position="absolute",e.style.left="-9999px",F(e,f)):(e.style.display="none",e.style.visibility="hidden"),F(e,"hidden-step"),E(e,m),e.setAttribute("data-step-hidden","true"),console.log(`[FormLib] Hiding ${t}:`,{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity,isStepItem:i,classes:e.className,dataAnswer:$(e,"data-answer")})}function X(e,t){e.style.display="",e.style.visibility="",e.style.opacity="",e.style.height="",e.style.overflow="",e.style.position="",e.style.left="",E(e,"hidden-step"),E(e,f),F(e,m),e.removeAttribute("data-step-hidden"),console.log(`[FormLib] Showing ${t}:`,{display:e.style.display,visibility:e.style.visibility,classes:e.className,dataAnswer:$(e,"data-answer")})}function Y(e,t=!0){const i=$(e,"data-step-subtype");if(!i)return;console.log(`[FormLib] ${t?"Enabling":"Disabling"} required fields for subtype: ${i}`);e.querySelectorAll("[data-require-for-subtypes]").forEach(e=>{const n=e.getAttribute("data-require-for-subtypes"),a=e;n&&n.split(",").map(e=>e.trim()).includes(i)&&(t?(a.required=!0,a.disabled=!1,console.log(`[FormLib] Enabled required field: ${a.name||a.id} for subtype: ${i}`)):(a.required=!1,a.disabled=!0,a.value="",console.log(`[FormLib] Disabled required field: ${a.name||a.id} for subtype: ${i}`)))})}function K(e){console.log(`[FormLib] Attempting to show step_item: ${e}`),console.log("[FormLib] Available step_items:",H.map(e=>({id:e.id,dataAnswer:$(e.element,"data-answer"),element:e.element})));const t=H.find(t=>t.id===e);if(!t){console.warn(`[FormLib] Step item not found: ${e}`),console.log(`[FormLib] Looking for step_item with data-answer="${e}"`);const t=H.find(t=>$(t.element,"data-answer")===e);return t?(console.log(`[FormLib] Found step_item by data-answer: ${e}`,t),K(t.id)):void 0}if(!R[t.parentStepIndex])return void console.warn(`[FormLib] Parent step not found for step_item: ${e}`);b(`Showing step_item ${e} in parent step ${t.parentStepIndex}`),console.log(`[FormLib] Hiding all step_items in parent step ${t.parentStepIndex}`);const i=H.filter(e=>e.parentStepIndex===t.parentStepIndex);console.log(`[FormLib] Found ${i.length} step_items to hide in parent step`),i.forEach(e=>{console.log(`[FormLib] Hiding step_item: ${e.id} (data-answer="${$(e.element,"data-answer")}")`),W(e.element,`step_item ${e.id}`),Y(e.element,!1),x.setStepVisibility(e.id,!1)}),console.log(`[FormLib] Now showing target step_item: ${e}`),X(t.element,`step_item ${e}`),Y(t.element,!0),x.setStepVisibility(e,!0),U=e,console.log(`[FormLib] Successfully showed step_item: ${e}`,{currentStepItemId:U,visibleStepItems:i.filter(t=>t.id===e).length})}function P(e){b(`Attempting to hide step_item: ${e}`);const t=H.find(t=>t.id===e);t?(b(`Hiding step_item: ${e}`),W(t.element,`step_item ${e}`),Y(t.element,!1),x.setStepVisibility(e,!1),U===e&&(U=null),b(`Successfully hid step_item: ${e}`)):b(`Step item not found for hiding: ${e}`)}function Q(e,t){e.preventDefault(),b("Next button clicked");const i=re();if(!i)return;if(U){const e=H.find(e=>e.id===U);if(e&&!ie(e.element))return void b("Step item validation failed, staying on current step")}else if(!ie(i.element))return void b("Step validation failed, staying on current step");let n=null;if(U){const e=H.find(e=>e.id===U);e&&(n=$(e.element,"data-go-to"),b(`Step item ${U} has data-go-to: ${n}`))}n||(n=function(e){const t=x.getBranchPath().activeConditions;b("Evaluating next step",{currentStep:e,activeConditions:t});for(const[e,i]of Object.entries(t))if(null!=i&&""!==i)return b(`Next step determined by branch: ${e}`),e;return b("No active branch conditions, using sequential navigation"),null}(i.id),b(`Branching logic determined next step: ${n}`)),n?function(e){b(`Attempting to navigate to step: ${e}`);const t=se(e);if(-1!==t)return b(`Found parent step: ${e} at index ${t}`),U=null,void ne(t);const i=H.find(t=>t.id===e);if(i)return b(`Found step_item: ${e} in parent step ${i.parentStepIndex}`),void(void 0!==i.parentStepIndex&&(ne(i.parentStepIndex),K(e)));console.warn(`[FormLib] Step not found: ${e}`),b("Step not found",{targetStepId:e,availableParentSteps:R.map(e=>e.id),availableStepItems:H.map(e=>e.id)})}(n):function(){const e=G+1;e<R.length?ne(e):b("Already at last step")}()}function Z(e,t){e.preventDefault(),b("Back button clicked"),function(){const e=x.goToPreviousStep();if(e){const t=se(e);if(-1!==t)return void ne(t)}const t=G-1;t>=0?ne(t):b("Already at first step")}()}function ee(e,t){e.preventDefault();const i=$(t,"data-skip");if(b("Skip button clicked",{skipTarget:i}),i){const e=se(i);if(-1!==e){for(let t=G+1;t<e;t++)x.addSkippedStep(R[t].id);ne(e)}else b(`Skip target step not found: ${i}`)}}function te(e,t){b("Submit button clicked");if(!function(){let e=!0;return R.forEach((t,i)=>{if(x.isStepVisible(t.id)){const i=t.element.querySelectorAll("[required]");for(const n of i){const i=n;i.value.trim()||(b(`Required field empty in step ${t.id}: ${i.name||"unnamed"}`),e=!1)}}}),e}())return e.preventDefault(),void b("Form validation failed, preventing submission");b("Form validation passed, allowing submission")}function ie(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(A(t)){if(!t.value||""===t.value.trim())return b("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return b("Validation failed: invalid email format",{element:t,value:t.value}),t.focus(),!1}}}return!0}function ne(e){if(e<0||e>=R.length)return void b(`Invalid step index: ${e}`);const t=G,i=R[e];b(`Navigating to step ${e}`,{from:t,to:e,stepId:i.id}),R[G]&&ae(G),G=e,function(e){if(e<0||e>=R.length)return;const t=R[e],i=t.element;X(i,`parent step ${e} (${t.id})`),x.setStepInfo(t.id,{visible:!0,visited:!0});const n=H.filter(t=>t.parentStepIndex===e);n.forEach(e=>{W(e.element,`step_item ${e.id} (keeping hidden on parent step show)`),x.setStepVisibility(e.id,!1)}),b(`Step shown: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className,stepItemsHidden:n.length})}(e),x.setCurrentStep(i.id),function(){const e=v(r),t=v(s),i=v(o);e.forEach(e=>{const t=e;0===G?(t.disabled=!0,F(e,y)):(t.disabled=!1,E(e,y))});const n=G===R.length-1;t.forEach(e=>{const t=e;n?t.style.display="none":(t.style.display="",t.disabled=!1,E(e,y))}),i.forEach(e=>{const t=e;n?(t.style.display="",t.disabled=!1,E(e,y)):t.style.display="none"}),b("Navigation buttons updated",{currentStepIndex:G,isLastStep:n,backButtonsCount:e.length,nextButtonsCount:t.length,submitButtonsCount:i.length})}(),b("Step navigation complete",{currentStep:i.id,currentIndex:e})}function ae(e){if(e<0||e>=R.length)return;const t=R[e],i=t.element;W(i,`parent step ${e} (${t.id})`),x.setStepInfo(t.id,{visible:!1}),b(`Step hidden: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}function se(e){return R.findIndex(t=>t.id===e)}function re(){return R[G]||null}e.debugFormSteps=function(){b("=== DEBUG: All Registered Steps ==="),R.forEach((e,t)=>{const i=e.element;b(`Step ${t}:`,{stepId:e.id,dataAnswer:i.getAttribute("data-answer"),elementId:i.getAttribute("id"),index:e.index,visible:"none"!==i.style.display,classes:i.className,element:i})}),b("=== END DEBUG ===")};let oe=!1,le=[],de=new Map;function ce(e=document){oe&&(b("Validation already validationInitialized, cleaning up first"),b("Resetting validation"),le.forEach(e=>e()),le=[],b("Clearing all field validation"),de.forEach((e,t)=>{!function(e){const t=de.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,fe(t.element,!0),b(`Cleared validation for field: ${e}`))}(t)}),de.clear(),oe=!1,b("Validation reset complete")),b("Initializing form validation");const t=v("input, select, textarea",e);b(`Found ${t.length} form inputs`),t.forEach(e=>{if(!I(e))return;const t=e,i=t.name||$(e,"data-step-field-name");if(!i)return void b("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:$(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:$(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=$(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=$(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=$(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(de.set(i,{element:e,rules:n,isValid:!0}),b(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):b(`No validation rules found for field: ${i}`)}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}(ue,p.VALIDATION_DELAY),i=w(e,"input","input, select, textarea",t),n=w(e,"blur","input, select, textarea",ue),a=w(e,"change","input, select, textarea",ue);le.push(i,n,a)}(e),oe=!0,b("Validation initialization complete")}function ue(e,t){if(!I(t))return;const i=t,a=i.name||$(t,"data-step-field-name");if(!a)return void b("Skipping validation - no field name found",{element:t,name:i.name,dataStepFieldName:$(t,"data-step-field-name")});const s=t.closest(n);if(s){const e=$(s,"data-answer");if(e&&!x.isStepVisible(e))return void b(`Skipping validation for field in hidden step: ${a}`)}pe(a)}function pe(e){const t=de.get(e);if(!t)return b(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return b(`No element found for field: ${e}`),!0;const n=L(i);b(`Validating field: ${e}`,{value:n,elementExists:!!i});let a=!0,s="";for(const e of t.rules){const t=me(n,e);if(!t.isValid){a=!1,s=t.message||"Validation failed";break}}t.isValid=a,t.errorMessage=s;try{fe(i,a,s)}catch(t){b(`Error updating visual state for field: ${e}`,t)}return x.setField(e,n),b(`Field validation result: ${e}`,{isValid:a,errorMessage:s,value:n}),a}function me(e,t){switch(t.type){case"required":return{isValid:!(""===e||null==e||Array.isArray(e)&&0===e.length),message:t.message};case"email":return{isValid:!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e)),message:t.message};case"phone":return{isValid:!e||/^[\+]?[1-9][\d]{0,15}$/.test(String(e).replace(/\D/g,"")),message:t.message};case"min":return{isValid:!e||String(e).length>=t.value,message:t.message};case"max":return{isValid:!e||String(e).length<=t.value,message:t.message};case"pattern":return{isValid:!e||t.value.test(String(e)),message:t.message};case"custom":return{isValid:!t.validator||t.validator(e),message:t.message};default:return{isValid:!0}}}function fe(e,t,i){t?E(e,h):F(e,h);const n=he(e);n&&(t?(n.textContent="",n.style.display="none"):(n.textContent=i||"Validation failed",n.style.display="block"))}function he(e){if(!e)return b("Cannot create error element - no input element provided"),null;const t=e.name||$(e,"data-step-field-name");if(!t)return b("Cannot create error element - no field name found",{element:e,name:e.name,dataStepFieldName:$(e,"data-step-field-name")}),null;if(!e.parentElement)return b(`Cannot create error element for field: ${t} - no parent element`,{element:e,parentElement:e.parentElement,nodeName:e.nodeName,id:e.id}),null;let i=null;try{i=e.parentElement.querySelector(`.${g}[data-field="${t}"]`)}catch(e){return b(`Error finding existing error element for field: ${t}`,e),null}if(!i)try{i=document.createElement("div"),i.className=g,i.setAttribute("data-field",t),i.style.color="red",i.style.fontSize="0.875em",i.style.marginTop="0.25rem",i.style.display="none";const n=e.nextSibling;n?e.parentElement.insertBefore(i,n):e.parentElement.appendChild(i),b(`Created error element for field: ${t}`)}catch(e){return b(`Error creating error element for field: ${t}`,e),null}return i}function ge(){const e={validationInitialized:oe,totalFields:de.size,validFields:0,invalidFields:0,fields:{}};return de.forEach((t,i)=>{e.fields[i]={isValid:t.isValid,errorMessage:t.errorMessage,rulesCount:t.rules.length},t.isValid?e.validFields++:e.invalidFields++}),e}let ye=new Map;function be(){b("Clearing all field errors"),ye.forEach((e,t)=>{!function(e){const t=ye.get(e);t?(b(`Clearing error for field: ${e}`),E(t.element,h),t.errorElement&&(t.errorElement.textContent="",t.errorElement.style.display="none")):b(`Cannot clear error for unknown field: ${e}`)}(t)})}function ve(){const e=[];return ye.forEach((t,i)=>{(function(e){const t=ye.get(e);return!!t&&t.element.classList.contains(h)})(i)&&e.push(i)}),e}function he(e){if(!e||!e.element)return b("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return b(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`.${g}[data-field="${e.fieldName}"]`)}catch(t){return b(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.className=g,t.setAttribute("data-field",e.fieldName),t.style.color="red",t.style.fontSize="0.875em",t.style.marginTop="0.25rem",t.style.display="none";const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),b(`Created error element for field: ${e.fieldName}`)}catch(t){return b(`Error creating error element for field: ${e.fieldName}`,t),null}return t}function Se(){const e=ve(),t={totalFields:ye.size,fieldsWithErrors:e.length,errors:{}};return e.forEach(e=>{const i=ye.get(e);t.errors[e]={message:i?.errorElement?.textContent||"Unknown error",customMessage:i?.customMessage}}),t}let $e=!1,Fe=[],Ee=[];function Ae(e=document){$e&&(b("Summary already summaryInitialized, cleaning up first"),b("Resetting summary functionality"),Fe.forEach(e=>e()),Fe=[],Ee.forEach(e=>{xe(e.element,"")}),Ee=[],$e=!1,b("Summary reset complete")),b("Initializing summary functionality");const t=v(u,e);b(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=$(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=$(e,"data-join"),a=n&&n in p.JOIN_SEPARATOR?n:"space",s=$(e,"data-summary-type")||void 0,r=$(e,"data-summary-subtype")||void 0,o=$(e,"data-summary-number")||void 0,l={element:e,fieldNames:i,joinType:a,type:s,subtype:r,number:o};Ee.push(l),b("Summary field configured",{fieldNames:i,joinType:a,type:s,subtype:r,number:o})})}(t),function(e){const t=w(e,"input",c,Ie),i=w(e,"change",c,Ie),n=w(e,"blur",c,Ie);Fe.push(t,i,n)}(e),we(),$e=!0,b("Summary initialization complete")}function Ie(e,t){if(!I(t))return;const i=$(t,"data-step-field-name");if(!i)return;const n=L(t);b(`Summary field changed: ${i}`,{value:n}),x.setField(i,n),Le(i)}function Le(e){Ee.forEach(t=>{t.fieldNames.includes(e)&&Ce(t)})}function we(){Ee.forEach(e=>{Ce(e)})}function Ce(e){const t=[];e.fieldNames.forEach(e=>{const i=x.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=p.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);xe(e.element,i),b("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function xe(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}class Ne{constructor(){this.initialized=!1,this.rootElement=document,b("FormLibrary instance created")}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}init(e=document){this.initialized&&(b("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,b("Initializing FormLibrary",{root:e===document?"document":"custom element"});const a=e.querySelectorAll(t),s=e.querySelectorAll(i),r=e.querySelectorAll(n);if(b("Form detection results",{multistepForms:a.length,logicForms:s.length,stepElements:r.length}),0!==a.length||0!==r.length)try{!function(e=document){b("Initializing error handling"),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||$(e,"data-step-field-name");t&&ye.set(t,{fieldName:t,element:e,customMessage:$(e,"data-error-message")||void 0})}),b(`Error handling errorsInitialized for ${ye.size} fields`)}(e),ce(e),s.length>0&&T(e),(a.length>0||r.length>0)&&J(e),Ae(e),this.initialized=!0,b("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw b("FormLibrary initialization failed",e),e}else b("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){b("Destroying FormLibrary");try{j()}catch(e){b("Error during FormLibrary destruction",e)}x.clear(),this.initialized=!1,b("FormLibrary destruction complete")}else b("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:x.getDebugInfo(),branching:{branchingInitialized:N,activeConditions:x.getBranchPath().activeConditions,visibleSteps:Object.entries(x.getAllSteps()).filter(([e,t])=>t.visible).map(([e,t])=>e)},multiStep:{multiStepInitialized:M,currentStepIndex:G,totalSteps:R.length,steps:R.map(e=>({id:e.id,index:e.index,visible:A(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:ge(),errors:Se(),summary:{summaryInitialized:$e,totalSummaryFields:Ee.length,summaryFields:Ee.map(e=>({fieldNames:e.fieldNames,joinType:e.joinType,type:e.type,subtype:e.subtype,number:e.number,currentValue:e.element.textContent||""})),formStateData:x.getAll()}}}logCurrentState(){b("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return b("Cannot validate form - library not initialized"),!1;b("Validating entire form");const e=function(){b("Validating all visible fields");let e=!0;const t={};for(const[i,a]of de){const s=a.element.closest(n);let r=!0;if(s){const e=$(s,"data-answer");e&&!x.isStepVisible(e)&&(r=!1)}if(r){const n=pe(i);t[i]=n,n||(e=!1)}}return b("All visible fields validation complete",{allValid:e,results:t}),e}();return b("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){var e;b("Resetting form to initial state"),be(),x.clear(),e?(b("Clearing specific summary fields",e),x.clearFields(e),e.forEach(e=>{Le(e)})):(b("Clearing all summaries"),x.clear(),we());try{ne(0)}catch(e){b("Could not go to first step during reset",e)}b("Form reset complete")}else b("Cannot reset form - library not initialized")}getFormData(){return x.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{x.setField(e,t)}),b("Updating all summaries"),we(),b("Form data set",e)}}const ke=Ne.getInstance();if(void 0!==e){const e=()=>{const e=document.querySelectorAll(t),i=document.querySelectorAll(n);(e.length>0||i.length>0)&&(b("Auto-initializing FormLibrary on DOM ready"),ke.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}void 0!==e&&(e.FormLib=ke,b("FormLib attached to window for debugging")),void 0!==e&&(e.FormLibrary=Ne,e.FormLib=ke)}("undefined"!=typeof window?window:this);