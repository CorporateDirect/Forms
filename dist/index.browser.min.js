"use strict";var FormLib=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(a,{FormState:()=>r,clearAllErrors:()=>pe,clearError:()=>me,clearSummary:()=>ze,default:()=>He,getCleanState:()=>Y,getDiagnosticState:()=>le,goToStep:()=>z,goToStepById:()=>_,goToStepByIdClean:()=>Z,goToStepByIdDiagnostic:()=>se,initErrors:()=>ce,initMultiStep:()=>O,initMultiStepClean:()=>G,initMultiStepDiagnostic:()=>ie,initSummary:()=>$e,initValidation:()=>Se,showError:()=>ue,updateSummary:()=>Me,validateAllVisibleFields:()=>Te,validateField:()=>Ee,validateStep:()=>Ne});var o={MULTISTEP:'[data-form="multistep"]',LOGIC:"[data-logic]",STEP:'[data-form="step"]',ANSWER:"[data-answer]",GO_TO:"[data-go-to]",SKIP:"[data-skip]",NEXT_BTN:'[data-form="next-btn"]',BACK_BTN:'[data-form="back-btn"]',SUBMIT:'[data-form="submit"]',SUBMIT_BTN:'[data-form="submit-btn"]',ERROR_DISPLAY:'[data-form="error"]',SHOW_IF:"[data-show-if]",STEP_TYPE:"[data-step-type]",STEP_SUBTYPE:"[data-step-subtype]",STEP_NUMBER:"[data-step-number]",STEP_FIELD_NAME:"[data-step-field-name]",SUMMARY_FIELD:"[data-summary-field]",SUMMARY_TYPE:"[data-summary-type]",SUMMARY_SUBTYPE:"[data-summary-subtype]",SUMMARY_NUMBER:"[data-summary-number]",JOIN:"[data-join]",REQUIRED:"[required]",ERROR_MESSAGE:"[data-error-message]",VALIDATE:"[data-validate]",ALL_INPUTS:"input, select, textarea"},s={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},l={ACTIVE_STEP:"active-step",HIDDEN_STEP:"hidden-step",HIDDEN_STEP_ITEM:"hidden-step-item",ERROR_FIELD:"error-field",ACTIVE_ERROR:"active-error",DISABLED:"disabled"},r=class e{constructor(){this.data={},u("FormState initialized (simplified)")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setField(e,t){const i=this.data[e];this.data[e]=t,u(`Field updated: ${e}`,{oldValue:i,newValue:t})}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},u("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&u("Fields cleared due to branch change",t)}getDebugInfo(){return{data:this.data,fieldCount:Object.keys(this.data).length}}}.getInstance(),d=new class{constructor(){this.events={},this.moduleStates=new Map}registerModule(e){this.moduleStates.set(e,{initialized:!0,name:e})}unregisterModule(e){this.moduleStates.delete(e)}isModuleInitialized(e){return this.moduleStates.get(e)?.initialized??!1}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.off(e,t)}}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){const i=String(e);if(console.log(`üîÑ [FormEvents] Emitting event: ${i}`,{eventData:t,timestamp:(new Date).toISOString(),hasListeners:!!this.events[e],listenerCount:this.events[e]?.length||0}),!this.events[e])return void console.warn(`‚ö†Ô∏è [FormEvents] No listeners registered for event: ${i}`);if("skip:request"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`‚ùå [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});if("branch:change"===e&&!this.isModuleInitialized("multiStep"))return void console.error(`‚ùå [FormEvents] CRITICAL: Skipping '${i}' event - multiStep module not initialized`,{eventData:t,registeredModules:Array.from(this.moduleStates.keys()),multiStepState:this.moduleStates.get("multiStep")});let n=0,a=0;this.events[e].forEach((o,s)=>{try{console.log(`üì° [FormEvents] Calling listener ${s+1}/${this.events[e].length} for ${i}`),o(t),n++,console.log(`‚úÖ [FormEvents] Listener ${s+1} completed successfully for ${i}`)}catch(n){a++,console.error(`üí• [FormEvents] LISTENER ERROR ${s+1}/${this.events[e].length} for '${i}':`,{error:n,errorMessage:n instanceof Error?n.message:String(n),errorStack:n instanceof Error?n.stack:void 0,eventData:t,listenerIndex:s})}}),console.log(`üìä [FormEvents] Event ${i} completed:`,{totalListeners:this.events[e].length,successful:n,failed:a,eventData:t})}},c=new Map;function u(e,t){if(!s.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${s.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function m(e,t=document){if(t===document){const i=`all:${e}`;if(c.has(i))return c.get(i);const n=t.querySelectorAll(e);return c.set(i,n),n}return t.querySelectorAll(e)}function p(e,t){return e.getAttribute(t)}function f(e,t){e.classList.add(t)}function g(e,t){e.classList.remove(t)}function y(e){const t=getComputedStyle(e).display;t&&"none"!==t&&e.setAttribute("data-original-display",t),f(e,"hidden-step"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),console.log("üîÑ [Utils] Hiding element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t,currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:h(e)})}function h(e){const t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function S(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function v(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function E(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}var b=!1,I=[];function A(e,t){if(!S(t))return;const i=L(t),n=v(t);i&&(r.setField(i,n),u("Field input detected",{fieldName:i,value:n,eventType:"input"}),d.emit("field:input",{fieldName:i,value:n,element:t,eventType:"input"}))}function N(e,t){if(!S(t))return;const i=L(t),n=v(t);i&&(r.setField(i,n),u("Field change detected",{fieldName:i,value:n,eventType:"change"}),d.emit("field:change",{fieldName:i,value:n,element:t,eventType:"change"}))}function T(e,t){if(!S(t))return;const i=L(t),n=v(t);i&&(u("Field blur detected",{fieldName:i,value:n,eventType:"blur"}),d.emit("field:blur",{fieldName:i,value:n,element:t,eventType:"blur"}))}function L(e){return e.name||p(e,"data-step-field-name")||null}function C(){b?(u("Resetting field coordinator"),I.forEach(e=>e()),I=[],b=!1,u("Field coordinator reset complete")):u("Field coordinator not initialized, nothing to reset")}var w=!1,$=[],R=[],F=[],M=-1,D=[];function O(e=document){w&&(u("MultiStep already initialized, cleaning up first"),function(){if(!w)return void u("Multi-step module not initialized, nothing to reset");u("Resetting multi-step module"),d.unregisterModule("multiStep"),$.forEach(e=>e()),$=[],F=[],M=-1,D=[],w=!1,R.forEach(e=>e()),R=[],u("Multi-step module reset")}()),console.log("üöÄ [MultiStep] === LINEAR STRUCTURE INITIALIZATION ===");const t=m(o.STEP,e);console.log("üìã [MultiStep] Found main steps:",{count:t.length,selector:o.STEP}),0!==t.length?(F=Array.from(t).map((e,t)=>{const i=e.querySelector(".step_wrapper[data-answer]");let n=p(i||e,"data-answer");return n||(n=`step-${t}`,console.warn(`‚ö†Ô∏è [MultiStep] Auto-generated ID for step ${t}: ${n}`)),console.log(`‚úÖ [MultiStep] Registered main step ${t}: ${n}`),{element:e,id:n,index:t}}),console.log("üìä [MultiStep] Step registration complete:",{totalSteps:F.length,stepIds:F.map(e=>e.id)}),F.forEach((e,t)=>{console.log(`ü´• [MultiStep] Hiding step ${t} (${e.id})`),y(e.element)}),function(e){const t=E(e,"click",o.NEXT_BTN,V),i=E(e,"click",o.BACK_BTN,x),n=E(e,"click",o.SUBMIT_BTN,H),a=E(e,"change",'input[type="radio"][data-go-to]',P),s=E(e,"click",'input[type="radio"][data-go-to]',P);$.push(t,i,n,a,s),u("Navigation listeners setup complete")}(e),function(){const e=d.on("step:navigate",e=>{const t=e;console.log("üéØ [MultiStep] Navigation event received:",{targetStepId:t.targetStepId,reason:t.reason}),t.targetStepId&&_(t.targetStepId)});R.push(e)}(),function(e){const t=E(e,"click",o.SKIP,k);$.push(t),u("Skip listeners setup complete")}(e),F.length>0&&(console.log("üé¨ [MultiStep] Showing initial step: 0"),z(0)),w=!0,d.registerModule("multiStep"),console.log("‚úÖ [MultiStep] Linear initialization complete")):console.error("‚ùå [MultiStep] No main steps found!")}function _(e){if(console.log("üéØ [MultiStep] LINEAR NAVIGATION to:",e),!w)return void console.error("‚ùå [MultiStep] Not initialized");const t=F.findIndex(t=>t.id===e);if(-1===t){console.error("‚ùå [MultiStep] Step not found:",{searchedFor:e,availableSteps:F.map(e=>e.id),totalSteps:F.length});const t=document.querySelector(`[data-answer="${e}"]`);return void(t&&console.error("üîç [MultiStep] Step exists in DOM but not registered:",{stepId:e,element:{tagName:t.tagName,id:t.id,className:t.className,hasStepAttribute:t.hasAttribute("data-form"),dataForm:p(t,"data-form")}}))}console.log("‚úÖ [MultiStep] Found step, navigating:",{stepId:e,stepIndex:t,currentIndex:M}),z(t)}function z(e){if(console.log("üéØ [MultiStep] LINEAR GO TO STEP:",{targetIndex:e,currentIndex:M,totalSteps:F.length}),!w||e<0||e>=F.length)return void console.error("‚ùå [MultiStep] Invalid navigation:",{initialized:w,stepIndex:e,totalSteps:F.length});const t=F[e];if(-1!==M&&M!==e){const e=F[M];console.log("üëã [MultiStep] Hiding current step:",e.id),y(e.element),e.element.classList.remove("active-step")}console.log("üëÅÔ∏è [MultiStep] Showing target step:",t.id),function(e){g(e,"hidden-step");const t=e.getAttribute("data-original-display")||"";if(t&&"none"!==t)e.style.setProperty("display",t,"important");else{const t=e.classList.contains("flex")||e.classList.contains("d-flex")||e.classList.contains("step_wrapper")||"flex"===getComputedStyle(e).display;e.style.setProperty("display",t?"flex":"block","important")}e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),console.log("üîÑ [Utils] Showing element:",{element:e,tagName:e.tagName,id:e.id,className:e.className,originalDisplay:t||"none stored",currentDisplay:e.style.display,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:h(e)})}(t.element),t.element.classList.add("active-step"),M=e,t.id,D[D.length-1]!==t.id&&D.push(t.id),function(){const e=document.querySelector(o.NEXT_BTN),t=document.querySelector(o.BACK_BTN),i=document.querySelector(o.SUBMIT_BTN);if(!e||!t||!i)return;const n=0===M,a=M===F.length-1;t.style.display=n?"none":"",a?(e.style.display="none",i.style.display=""):(e.style.display="",i.style.display="none")}(),d.emit("step:change",{currentStepIndex:e,currentStepId:t.id}),console.log("‚úÖ [MultiStep] Navigation complete:",{stepId:t.id,isVisible:h(t.element),hasActiveClass:t.element.classList.contains("active-step")}),h(t.element)||(console.error("‚ùå [MultiStep] Step still not visible after show!"),function(e,t){const i=getComputedStyle(e),n=[];let a=e;for(;a&&a!==document.body;)n.push(a),a=a.parentElement;console.log(`üîç [MultiStep] Diagnosing visibility issues for step ${t}:`,{targetElement:{tagName:e.tagName,id:e.id,className:e.className,computedDisplay:i.display,computedVisibility:i.visibility,computedOpacity:i.opacity,inlineDisplay:e.style.display,inlineVisibility:e.style.visibility,inlineOpacity:e.style.opacity,hasHiddenClass:e.classList.contains("hidden-step"),isVisible:h(e)},parentChain:n.map(e=>({tagName:e.tagName,id:e.id,className:e.className,computedDisplay:getComputedStyle(e).display,computedVisibility:getComputedStyle(e).visibility,computedOpacity:getComputedStyle(e).opacity,hasHiddenClass:e.classList.contains("hidden-step")})),possibleConflicts:{hasDisplayNone:"none"===i.display,hasVisibilityHidden:"hidden"===i.visibility,hasZeroOpacity:"0"===i.opacity,hasHiddenClass:e.classList.contains("hidden-step"),parentWithDisplayNone:n.some(e=>"none"===getComputedStyle(e).display),parentWithVisibilityHidden:n.some(e=>"hidden"===getComputedStyle(e).visibility)}})}(t.element,t.id))}function P(e,t){const i=t;if(console.log("üéØ [MultiStep] Radio button navigation:",{radioName:i.name,radioValue:i.value,isChecked:i.checked,dataGoTo:p(i,"data-go-to")}),!i.checked)return;const n=p(i,"data-go-to");n?(!function(e){const t=e.name;if(!t)return;const i=p(e,"fs-inputactive-class")||"is-active-inputactive";document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(t=>{const n=t,a=n.closest("label");n!==e&&(n.classList.remove(i),a?.classList.remove(i))}),e.classList.add(i);const n=e.closest("label");n?.classList.add(i)}(i),console.log("üöÄ [MultiStep] Navigating to step via radio button:",n),_(n)):console.warn("‚ö†Ô∏è [MultiStep] Radio button missing data-go-to attribute")}function V(e){e.preventDefault();const t=M+1;t<F.length&&z(t)}function x(e){e.preventDefault();const t=M-1;t>=0&&z(t)}function H(e){u("Form submission - allowing default behavior")}function k(e,t){e.preventDefault();const i=p(t,"data-skip");i&&"true"!==i&&""!==i&&_(i)}var q=!1,U=[],B=0;function G(e=document){console.log("üöÄ [CLEAN] Ultra-minimal initialization starting...");const t=m(o.STEP,e);0!==t.length?(U=Array.from(t).map((e,t)=>{const i=e.querySelector(".step_wrapper[data-answer]");return{element:e,id:p(i||e,"data-answer")||`step-${t}`,index:t}}),console.log("‚úÖ [CLEAN] Steps registered:",U.map(e=>e.id)),W(),j(0),function(e){E(e,"change",'input[type="radio"][data-go-to]',(e,t)=>{const i=t;if(!i.checked)return;const n=p(i,"data-go-to");n?(console.log(`üîò [CLEAN] Radio clicked: ${i.name} ‚Üí ${n}`),function(e){const t=e.name;if(!t)return;const i="is-active-inputactive";document.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach(e=>{const t=e,n=t.closest("label");t.classList.remove(i),n?.classList.remove(i)}),e.classList.add(i);const n=e.closest("label");n?.classList.add(i),console.log(`üé® [CLEAN] Styled radio: ${e.name}`)}(i),Z(n)):console.warn("‚ö†Ô∏è [CLEAN] Radio missing data-go-to")});console.log("‚úÖ [CLEAN] Radio listeners setup")}(e),q=!0,console.log("‚úÖ [CLEAN] Initialization complete")):console.error("‚ùå [CLEAN] No steps found")}function W(){U.forEach(e=>{e.element.style.display="none",e.element.style.visibility="hidden",console.log(`üôà [CLEAN] Hiding: ${e.id}`)})}function j(e){if(e<0||e>=U.length)return void console.error("‚ùå [CLEAN] Invalid step index:",e);const t=U[e];W(),t.element.style.setProperty("display","block","important"),t.element.style.setProperty("visibility","visible","important"),t.element.style.setProperty("opacity","1","important"),B=e,console.log(`‚úÖ [CLEAN] Showing: ${t.id} at index ${e}`)}function Z(e){console.log(`üéØ [CLEAN] Navigate to: ${e}`);const t=U.findIndex(t=>t.id===e);if(-1===t)return console.error("‚ùå [CLEAN] Step not found:",e),void console.log("Available steps:",U.map(e=>e.id));j(t)}function Y(){return{initialized:q,currentStepIndex:B,currentStepId:U[B]?.id||"none",totalSteps:U.length,stepIds:U.map(e=>e.id)}}var K=!1,J=[],X=0;function Q(e,t){const i=(new Date).toISOString();console.log(`üîç [DIAGNOSTIC ${i}] ${e}`,t||"")}function ee(e,t){const i=(new Date).toISOString();console.error(`‚ùå [DIAGNOSTIC ${i}] ${e}`,t||"")}function te(e,t){const i=getComputedStyle(e);Q(`DOM ${t}:`,{element:e.tagName,id:e.id,className:e.className,inlineStyles:{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity},computedStyles:{display:i.display,visibility:i.visibility,opacity:i.opacity,position:i.position,zIndex:i.zIndex},dimensions:{offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight},parentInfo:{tagName:e.parentElement?.tagName,id:e.parentElement?.id,className:e.parentElement?.className}})}function ie(e=document){Q("=== DIAGNOSTIC INITIALIZATION START ==="),Q("Root element:",{isDocument:e===document,elementType:e.constructor.name,hasQuerySelector:"function"==typeof e.querySelector}),Q("Checking for existing form libraries:",{window_FormLib:typeof window.FormLib,window_formLibrary:typeof window.formLibrary,existing_scripts:Array.from(document.scripts).map(e=>e.src).filter(e=>e.includes("form"))}),Q("Searching for steps with selector:",o.STEP);const t=m(o.STEP,e);Q("Step search results:",{selector:o.STEP,foundCount:t.length,allElementsWithDataForm:Array.from(document.querySelectorAll("[data-form]")).map(e=>({tagName:e.tagName,id:e.id,className:e.className,dataForm:e.getAttribute("data-form")}))}),0!==t.length?(J=Array.from(t).map((e,t)=>{Q(`Analyzing step ${t}:`),te(e,`STEP_${t}_INITIAL`);const i=e.querySelector(".step_wrapper[data-answer]"),n=p(i||e,"data-answer");return Q(`Step ${t} data-answer analysis:`,{hasStepWrapper:!!i,stepWrapperDataAnswer:i?p(i,"data-answer"):null,directDataAnswer:p(e,"data-answer"),finalDataAnswer:n||`step-${t}`,allAttributes:Array.from(e.attributes).map(e=>({name:e.name,value:e.value}))}),{element:e,id:n||`step-${t}`,index:t}}),Q("All steps registered:",{totalSteps:J.length,stepMapping:J.map((e,t)=>({index:t,id:e.id,element:{tagName:e.element.tagName,id:e.element.id,className:e.element.className}}))}),ne(),Q("=== INITIAL STEP HIDING ==="),ae(),Q("=== SHOWING FIRST STEP ==="),oe(0),function(e){Q("=== SETTING UP RADIO LISTENERS ===");const t=document.querySelectorAll('input[type="radio"][data-go-to]');Q("Found radio buttons:",{count:t.length,buttons:Array.from(t).map((e,t)=>({index:t,name:e.name,value:e.value,dataGoTo:e.getAttribute("data-go-to"),id:e.id,className:e.className}))});E(e,"change",'input[type="radio"][data-go-to]',(e,t)=>{Q("=== RADIO BUTTON EVENT TRIGGERED ===");const i=t;if(Q("Radio button analysis:",{eventType:e.type,radioName:i.name,radioValue:i.value,isChecked:i.checked,dataGoTo:p(i,"data-go-to"),eventTarget:e.target,eventCurrentTarget:e.currentTarget,timestamp:(new Date).toISOString()}),!i.checked)return void Q("Radio not checked, ignoring event");const n=p(i,"data-go-to");n?(Q("Processing radio navigation:",{from:J[X]?.id,to:n,radioGroup:i.name}),function(e){Q("=== APPLYING RADIO STYLING ===");const t=e.name;if(!t)return;const i="is-active-inputactive",n=document.querySelectorAll(`input[type="radio"][name="${t}"]`);Q("Radio group styling:",{groupName:t,groupSize:n.length,activeClass:i}),n.forEach((t,n)=>{const a=t,o=a.closest("label"),s=a.classList.contains(i);a.classList.remove(i),o?.classList.remove(i),a===e?(a.classList.add(i),o?.classList.add(i),Q(`Applied active class to radio ${n}`)):s&&Q(`Removed active class from radio ${n}`)})}(i),Q("About to navigate..."),se(n),Q("=== RADIO BUTTON EVENT COMPLETE ===")):ee("Radio button missing data-go-to attribute")});Q("Radio listeners setup complete")}(e),Q("=== DIAGNOSTIC INITIALIZATION COMPLETE ===",{initialized:K=!0,totalSteps:J.length,currentStepIndex:X,currentStepId:J[X]?.id})):ee("No steps found - detailed analysis:",{searchRoot:e===document?"document":"custom element",allDataFormElements:document.querySelectorAll("[data-form]").length,allStepWrappers:document.querySelectorAll(".step_wrapper").length,allMultiFormSteps:document.querySelectorAll(".multi-form_step").length,possibleStepElements:Array.from(document.querySelectorAll("div")).filter(e=>e.className.includes("step")||e.id.includes("step")).map(e=>({tagName:e.tagName,id:e.id,className:e.className}))})}function ne(){Q("=== CHECKING FOR CONFLICTS ===");const e=document.querySelectorAll('input[type="radio"][data-go-to]');Q("Radio buttons found:",{count:e.length,details:Array.from(e).map((e,t)=>{const i=e;return{index:t,name:i.name,value:i.value,dataGoTo:e.getAttribute("data-go-to"),hasListeners:null!==i.onclick||null!==i.onchange}})});document.querySelectorAll('[data-form="step"]').forEach((e,t)=>{const i=getComputedStyle(e);"none"!==i.display&&"hidden"!==i.visibility||Q(`Step ${t} already hidden by CSS:`,{element:e,computedDisplay:i.display,computedVisibility:i.visibility,possibleCSSRules:"Check for conflicting CSS"})}),Q("Window object analysis:",{FormLib:typeof window.FormLib,formLibrary:typeof window.formLibrary,jQuery:typeof window.$,webflow:typeof window.Webflow,allFormLibKeys:Object.keys(window).filter(e=>e.toLowerCase().includes("form"))})}function ae(){Q("Hiding all steps - BEFORE state:"),J.forEach((e,t)=>{te(e.element,`BEFORE_HIDE_${t}`)}),J.forEach((e,t)=>{Q(`Hiding step ${t} (${e.id}):`);const i={display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:e.element.offsetHeight>0};e.element.style.setProperty("display","none","important"),e.element.style.setProperty("visibility","hidden","important");const n={display:e.element.style.display,visibility:e.element.style.visibility,computedDisplay:getComputedStyle(e.element).display,isVisible:e.element.offsetHeight>0};Q(`Step ${t} hide result:`,{stepId:e.id,before:i,after:n,hideSuccessful:!1===n.isVisible}),te(e.element,`AFTER_HIDE_${t}`)})}function oe(e){if(e<0||e>=J.length)return void ee("Invalid step index:",{stepIndex:e,totalSteps:J.length});const t=J[e];Q(`=== SHOWING STEP ${e} (${t.id}) ===`),Q("Hiding all other steps first..."),ae(),te(t.element,`BEFORE_SHOW_${e}`),Q(`Applying show styles to step ${e}:`),t.element.style.setProperty("display","block","important"),t.element.style.setProperty("visibility","visible","important"),t.element.style.setProperty("opacity","1","important"),t.element.offsetHeight,te(t.element,`AFTER_SHOW_${e}`);const i=t.element.offsetHeight>0&&t.element.offsetWidth>0;if(Q(`Step ${e} show result:`,{stepId:t.id,isVisible:i,offsetHeight:t.element.offsetHeight,offsetWidth:t.element.offsetWidth,computedDisplay:getComputedStyle(t.element).display,computedVisibility:getComputedStyle(t.element).visibility}),!i){ee(`STEP ${e} FAILED TO SHOW!`,{stepId:t.id,possibleCauses:["CSS override with higher specificity","Parent element hidden","JavaScript interference","Layout engine issue"]});let i=t.element.parentElement,n=0;for(;i&&n<5;)te(i,`PARENT_${n}`),i=i.parentElement,n++}X=e}function se(e){Q(`=== NAVIGATION REQUEST: ${e} ===`);const t=J.findIndex(t=>t.id===e);-1!==t?(Q(`Found step ${e} at index ${t}, navigating...`),oe(t)):ee("Step not found:",{searchedFor:e,availableSteps:J.map(e=>e.id),totalSteps:J.length,suggestion:"Check data-answer attributes match exactly"})}function le(){return{initialized:K,currentStepIndex:X,currentStepId:J[X]?.id||"none",totalSteps:J.length,stepIds:J.map(e=>e.id),allStepsVisible:J.map(e=>({id:e.id,isVisible:e.element.offsetHeight>0,computedDisplay:getComputedStyle(e.element).display,computedVisibility:getComputedStyle(e.element).visibility}))}}"undefined"!=typeof window&&(window.FormLibDiagnostic={showStep:oe,hideAll:ae,goToStep:se,getState:le,checkConflicts:ne,logAllSteps:()=>J.forEach((e,t)=>te(e.element,`MANUAL_CHECK_${t}`))});var re=new Map,de=new Map;function ce(e=document){u("Initializing error handling");e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||p(e,"data-step-field-name");t&&re.set(t,{fieldName:t,element:e,customMessage:p(e,"data-error-message")||void 0})}),u(`Error handling initialized for ${re.size} fields`)}function ue(e,t){const i=re.get(e);if(!i)return void u(`Cannot show error for unknown field: ${e}`);const n=t||i.customMessage||"This field has an error";u(`Showing error for field: ${e}`,{message:n}),f(i.element,l.ERROR_FIELD);const a=function(e){if(!e||!e.element)return u("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return u(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`${o.ERROR_DISPLAY}[data-field="${e.fieldName}"]`)}catch(t){return u(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.setAttribute("data-form","error"),t.setAttribute("data-field",e.fieldName);const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),u(`Created error element for field: ${e.fieldName}`)}catch(t){return u(`Error creating error element for field: ${e.fieldName}`,t),null}return t}(i);a&&(a.textContent=n,f(a,l.ACTIVE_ERROR),i.errorElement=a),function(e){const t=e.getBoundingClientRect();t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)||(e.scrollIntoView({behavior:"smooth",block:"center"}),u(`Scrolled to field with error: ${e.name||"unnamed"}`))}(i.element)}function me(e){const t=re.get(e);t?(u(`Clearing error for field: ${e}`),g(t.element,l.ERROR_FIELD),t.errorElement&&(t.errorElement.textContent="",g(t.errorElement,l.ACTIVE_ERROR))):u(`Cannot clear error for unknown field: ${e}`)}function pe(){u("Clearing all field errors"),re.forEach((e,t)=>{me(t)})}function fe(){const e={};return de.forEach((t,i)=>{e[i]={message:t.message}}),e}var ge=!1,ye=[],he=new Map;function Se(e=document){ge&&(u("Validation already initialized, cleaning up first"),u("Resetting validation"),ye.forEach(e=>e()),ye=[],u("Clearing all field validation"),he.forEach((e,t)=>{!function(e){const t=he.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,Ae(t.element,!0),u(`Cleared validation for field: ${e}`))}(t)}),he.clear(),ge=!1,u("Validation reset complete")),u("Initializing form validation");const t=m("input, select, textarea",e);u(`Found ${t.length} form inputs`),t.forEach(e=>{if(!S(e))return;const t=e,i=t.name||p(e,"data-step-field-name");if(!i)return void u("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:p(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:p(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=p(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=p(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=p(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(he.set(i,{element:e,rules:n,isValid:!0}),u(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):u(`No validation rules found for field: ${i}`)}),function(){const e=d.on("field:input",e=>{!function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}(()=>ve(e),s.VALIDATION_DELAY)()}),t=d.on("field:blur",ve),i=d.on("field:change",ve);ye.push(e,t,i),u("Validation module subscribed to centralized field events")}(),ge=!0,u("Validation initialization complete")}function ve(e){const{fieldName:t,element:i}=e;if(!t)return void u("Skipping validation - no field name found",{element:i,eventType:e.eventType});const n=i.closest(o.STEP);if(n){if(p(n,"data-answer")&&!h(n))return void u(`Skipping validation for field in hidden step: ${t}`)}Ee(t)}function Ee(e){const t=he.get(e);if(!t)return u(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return u(`No element found for field: ${e}`),!0;const n=v(i);u(`Validating field: ${e}`,{value:n,elementExists:!!i});for(const a of t.rules){const{isValid:o,message:s}=Ie(n,a);if(!o)return t.isValid=!1,t.errorMessage=s||"Invalid field",ue(e,t.errorMessage),Ae(i,!1,t.errorMessage),!1}return t.isValid=!0,me(e),Ae(i,!0),!0}var be={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1\s?)?(\([0-9]{3}\)|[0-9]{3})[\s\-]?[0-9]{3}[\s\-]?[0-9]{4}$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,zipCode:/^\d{5}(-\d{4})?$/,zipCodeCA:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,creditCard:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3[0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})$/,ssn:/^\d{3}-?\d{2}-?\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/};function Ie(e,t){switch(t.type){case"required":return{isValid:Array.isArray(e)?e.length>0:!!e&&""!==String(e).trim(),message:t.message};case"email":return{isValid:be.email.test(String(e)),message:t.message||"Please enter a valid email address"};case"phone":const i=String(e).replace(/[\s\-\(\)]/g,"");return{isValid:be.phone.test(i)||be.phoneUS.test(String(e)),message:t.message||"Please enter a valid phone number"};case"min":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length>=t.value,message:t.message||`Minimum ${t.value} characters required`};case"max":return"number"!=typeof t.value?{isValid:!0}:{isValid:String(e).length<=t.value,message:t.message||`Maximum ${t.value} characters allowed`};case"pattern":return t.value instanceof RegExp?{isValid:t.value.test(String(e)),message:t.message||"Please enter a valid format"}:{isValid:!0};case"custom":if(!t.validator)return{isValid:!0};try{return{isValid:t.validator(e),message:t.message||"Invalid value"}}catch(e){return u("Error in custom validator",{error:e,rule:t}),{isValid:!1,message:"Validation error occurred"}}default:return{isValid:!0}}}function Ae(e,t,i){const n=e.name||p(e,"data-step-field-name");n&&(t?me(n):ue(n,i))}function Ne(e){const t=function(e,t=document){if(t===document){const i=`single:${e}`;if(c.has(i))return c.get(i);const n=t.querySelector(e);return c.set(i,n),n}return t.querySelector(e)}(`[data-answer="${e}"]`);if(!t)return u(`Step not found with data-answer="${e}"`),!0;if(!h(t))return u(`Skipping validation for hidden step: ${e}`),!0;u(`Validating step: ${e}`);const i=t.querySelectorAll("input, select, textarea");let n=!0;return i.forEach(e=>{if(!S(e))return;const t=e.name||p(e,"data-step-field-name");if(t){Ee(t)||(n=!1)}}),u(`Step validation result: ${e}`,{isValid:n}),n}function Te(){u("Validating all visible fields");let e=!0;const t={};for(const[i,n]of he){const a=n.element.closest(o.STEP);let s=!0;if(a){p(a,"data-answer")&&!h(a)&&(s=!1)}if(s){const n=Ee(i);t[i]=n,n||(e=!1)}}return u("All visible fields validation complete",{allValid:e,results:t}),e}var Le=!1,Ce=[],we=[];function $e(e=document){Le&&(u("Summary already initialized, cleaning up first"),u("Resetting summary functionality"),Ce.forEach(e=>e()),Ce=[],we.forEach(e=>{_e(e.element,"")}),we=[],Le=!1,u("Summary reset complete")),u("Initializing summary functionality");const t=m(o.SUMMARY_FIELD,e);u(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=p(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=p(e,"data-join"),a=n&&n in s.JOIN_SEPARATOR?n:"space",o=p(e,"data-summary-type")||void 0,l=p(e,"data-summary-subtype")||void 0,r=p(e,"data-summary-number")||void 0,d={element:e,fieldNames:i,joinType:a,type:o,subtype:l,number:r};we.push(d),u("Summary field configured",{fieldNames:i,joinType:a,type:o,subtype:l,number:r})})}(t),function(){const e=d.on("field:change",Re),t=d.on("field:input",Re);Ce.push(e,t),u("Summary module subscribed to centralized field events")}(),De(),Le=!0,u("Summary initialization complete")}function Re(e){const{fieldName:t,value:i,eventType:n}=e;u(`Summary received field ${n}: ${t}`,{value:i}),Fe(t)}function Fe(e){we.forEach(t=>{t.fieldNames.includes(e)&&Oe(t)})}function Me(){u("Updating all summaries"),De()}function De(){we.forEach(e=>{Oe(e)})}function Oe(e){const t=[];e.fieldNames.forEach(e=>{const i=r.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=s.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);_e(e.element,i),u("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function _e(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}function ze(e){e?(u("Clearing specific summary fields",e),r.clearFields(e),e.forEach(e=>{Fe(e)})):(u("Clearing all summaries"),r.clear(),De())}function Pe(){const e={};return we.forEach((t,i)=>{const n=t.type&&t.subtype&&t.number?`${t.type}-${t.subtype}-${t.number}`:`summary-${i}`;e[n]={hasContent:(t.element.textContent||"").trim().length>0}}),e}console.log("üöÄ [FormLib] === SCRIPT VERSION CHECK ==="),console.log("üì¶ [FormLib] Script Version: CACHE_BUST_2025_01_10_14_45_FRESH"),console.log("üîó [FormLib] Expected URL: @9705259 or newer"),console.log("‚è∞ [FormLib] Load Time:",(new Date).toISOString());var Ve,xe=class e{constructor(){this.initialized=!1,this.rootElement=document,u("FormLibrary instance created")}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e=document){this.initialized&&(u("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,u("Initializing FormLibrary",{root:e===document?"document":"custom element"});const t=e.querySelectorAll(o.MULTISTEP),i=e.querySelectorAll(o.LOGIC),n=e.querySelectorAll(o.STEP);if(u("Form detection results",{multistepForms:t.length,logicForms:i.length,stepElements:n.length}),0!==t.length||0!==n.length)try{!function(e=document){b&&(u("Field coordinator already initialized, cleaning up first"),C()),u("Initializing centralized field coordinator");const t=E(e,"input","input, select, textarea",A),i=E(e,"change","input, select, textarea",N),n=E(e,"blur","input, select, textarea",T);I.push(t,i,n),b=!0,u("Field coordinator initialization complete")}(e),ce(e),Se(e),(t.length>0||n.length>0)&&O(e),$e(e),this.initialized=!0,u("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw u("FormLibrary initialization failed",e),e}else u("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){u("Destroying FormLibrary");try{C()}catch(e){u("Error during FormLibrary destruction",e)}r.clear(),c.clear(),this.initialized=!1,u("FormLibrary destruction complete")}else u("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:r.getDebugInfo(),multiStep:{note:"Simplified linear navigation - debug info removed"},validation:{initialized:ge,fieldValidations:Array.from(he.entries()).reduce((e,[t,i])=>(e[t]={isValid:i.isValid,errorMessage:i.errorMessage,rules:i.rules.map(e=>e.type)},e),{})},errors:fe(),summary:Pe()}}logCurrentState(){u("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return u("Cannot validate form - library not initialized"),!1;u("Validating entire form");const e=Te();return u("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){u("Resetting form to initial state"),pe(),r.clear(),ze();try{z(0)}catch(e){u("Could not go to first step during reset",e)}u("Form reset complete")}else u("Cannot reset form - library not initialized")}getFormData(){return r.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{r.setField(e,t)}),Me(),u("Form data set",e)}}.getInstance(),He=xe;if("undefined"!=typeof window){const e=()=>{const e=document.querySelectorAll(o.MULTISTEP),t=document.querySelectorAll(o.STEP);(e.length>0||t.length>0)&&(u("Auto-initializing FormLibrary via Webflow.push"),xe.init())},t=window;t.Webflow?.push?t.Webflow.push(e):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}return"undefined"!=typeof window&&(window.FormLib=xe,u("FormLib attached to window for debugging")),Ve=a,((a,o,s,l)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let r of i(o))n.call(a,r)||r===s||e(a,r,{get:()=>o[r],enumerable:!(l=t(o,r))||l.enumerable});return a})(e({},"__esModule",{value:!0}),Ve)})();