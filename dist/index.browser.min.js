/*!
 * Form Functionality Library v1.1.0
 * Browser-compatible bundle
 */
!function(e){"use strict";const t='[data-form="multistep"]',i="[data-logic]",n='[data-form="step"]',a="[data-answer]",o='[data-form="next-btn"]',s='[data-form="back-btn"]',r='[data-form="submit"]',l="[data-skip]",d="[data-go-to]",c="[data-step-field-name]",u="[data-summary-field]",p={START_STEP:1,DEBUG:!0,LOG_PREFIX:"[FormLib]",VALIDATION_DELAY:300,ANIMATION_DURATION:300,JOIN_SEPARATOR:{space:" ",comma:", ",dash:" - ",pipe:" | ",newline:"\n"}},m="active-step",f="hidden-step-item",g="error-field",h="error-message",y="disabled";function b(e,t){if(!p.DEBUG)return;const i=(new Date).toISOString().split("T")[1].split(".")[0],n=`${p.LOG_PREFIX} [${i}]`;void 0!==t?console.log(`${n} ${e}`,t):console.log(`${n} ${e}`)}function v(e,t=document){return t.querySelectorAll(e)}function S(e,t=document){return t.querySelector(e)}function $(e,t){return e.getAttribute(t)}function F(e,t){e.classList.add(t)}function E(e,t){e.classList.remove(t)}function L(e){return"none"!==e.style.display&&!function(e,t){return e.classList.contains(t)}(e,"hidden-step")}function I(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement}function A(e){return e instanceof HTMLInputElement?"checkbox"===e.type||"radio"===e.type?e.checked?e.value:"":e.value:e instanceof HTMLSelectElement&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}function w(e,t,i,n){const a=e=>{const t=e.target?.closest(i);t&&n(e,t)};return e.addEventListener(t,a),()=>{e.removeEventListener(t,a)}}class N{constructor(){this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},b("FormState initialized")}static getInstance(){return N.instance||(N.instance=new N),N.instance}setField(e,t){const i=this.data[e];this.data[e]=t,b(`Field updated: ${e}`,{oldValue:i,newValue:t}),this.onFieldChange(e,t,i)}getField(e){return this.data[e]}getAll(){return{...this.data}}clear(){const e={...this.data};this.data={},this.steps={},this.branchPath={currentStep:"",previousSteps:[],skippedSteps:[],activeConditions:{}},b("FormState cleared",{oldData:e})}clearFields(e){const t={};e.forEach(e=>{void 0!==this.data[e]&&(t[e]=this.data[e],delete this.data[e])}),Object.keys(t).length>0&&b("Fields cleared due to branch change",t)}setStepInfo(e,t){this.steps[e]||(this.steps[e]={visible:!1,visited:!1}),Object.assign(this.steps[e],t),b(`Step info updated: ${e}`,this.steps[e])}getStepInfo(e){return this.steps[e]}getAllSteps(){return{...this.steps}}setStepVisibility(e,t){this.setStepInfo(e,{visible:t}),b(`Step visibility updated: ${e}`,{visible:t})}setCurrentStep(e){this.branchPath.currentStep&&this.branchPath.currentStep!==e&&this.branchPath.previousSteps.push(this.branchPath.currentStep),this.branchPath.currentStep=e,this.setStepInfo(e,{visited:!0}),b(`Current step changed to: ${e}`,this.branchPath)}getCurrentStep(){return this.branchPath.currentStep}getBranchPath(){return{...this.branchPath}}addSkippedStep(e){this.branchPath.skippedSteps.includes(e)||(this.branchPath.skippedSteps.push(e),b(`Step skipped: ${e}`,this.branchPath.skippedSteps))}setActiveCondition(e,t){this.branchPath.activeConditions[e]=t,b(`Active condition set: ${e}`,t)}getActiveCondition(e){return this.branchPath.activeConditions[e]}getFieldsByStep(e,t,i){const n={};return Object.entries(this.data).forEach(([e,t])=>{n[e]=t}),n}onFieldChange(e,t,i){t!==i&&b(`Field change detected: ${e}`,{from:i,to:t})}goToPreviousStep(){const e=this.branchPath.previousSteps.pop();return e?(this.branchPath.currentStep=e,b(`Went back to previous step: ${e}`,this.branchPath),e):null}wasStepVisited(e){return this.steps[e]?.visited||!1}isStepVisible(e){return this.steps[e]?.visible||!1}getDebugInfo(){return{data:this.data,steps:this.steps,branchPath:this.branchPath,fieldCount:Object.keys(this.data).length,stepCount:Object.keys(this.steps).length}}}const C=N.getInstance();let k=!1,x=[];function T(e=document){k&&(b("Branching already branchingInitialized, cleaning up first"),O()),b("Initializing branching logic");b(`Found ${v(d,e).length} branch triggers`);b(`Found ${v(a,e).length} conditional steps`),function(e){console.log("[FormLib] Setting up branching event listeners on:",e);const t=w(e,"change",d,P);console.log("[FormLib] Set up CHANGE listener for:",d);const i=w(e,"input",d,P);console.log("[FormLib] Set up INPUT listener for:",d);const n=w(e,"click",d,P);console.log("[FormLib] Set up CLICK listener for:",d);const a=['input[type="radio"][data-go-to]',"label.radio_field","label.w-radio",'label:has(input[type="radio"][data-go-to])',".radio_label",".w-form-label",".w-radio-input",".radio_button",".radio-button",".form_checkbox-icon",".w-checkbox-input",".w-form-formradioinput",".radio_button-skip-step","[data-go-to]","label span","label div"];console.log("[FormLib] Setting up comprehensive radio button listeners for selectors:",a),a.forEach((t,i)=>{const n=e.querySelectorAll(t);console.log(`[FormLib] Selector ${i} "${t}" found ${n.length} elements`);const a=w(e,"click",t,q);x.push(a)});const o=w(e,"keydown","label.radio_field, label.w-radio, [data-go-to]",_);console.log("[FormLib] Set up KEYDOWN listener for radio elements");const s=w(e,"click","*",(e,t)=>{const i=t;("INPUT"===i.tagName||i.className.includes("radio")||i.closest("label")||$(t,"data-go-to"))&&console.log("[FormLib] GLOBAL CLICK detected on potentially relevant element:",{target:t,tagName:i.tagName,className:i.className,id:i.id,dataGoTo:$(t,"data-go-to"),isInput:"INPUT"===i.tagName,inputType:"INPUT"===i.tagName?i.type:null,closestLabel:i.closest("label"),event:e})});x.push(t,i,n,o,s),console.log("[FormLib] Total event listeners set up:",x.length)}(e),k=!0,b("Branching initialization complete")}function q(e,t){console.log("[FormLib] Universal radio click handler triggered",{target:t,tagName:t.tagName,className:t.className,id:t.id});let i=null;if("INPUT"===t.tagName&&"radio"===t.type){$(t,"data-go-to")&&(i=t,console.log("[FormLib] Direct radio input click detected"))}if(!i){const e=$(t,"data-go-to");e&&(i=document.querySelector(`input[type="radio"][data-go-to="${e}"]`),console.log("[FormLib] Found radio via data-go-to attribute",{goTo:e,radioInput:i}))}if(i||(i=t.querySelector('input[type="radio"][data-go-to]'),i&&console.log("[FormLib] Found radio input inside clicked element")),!i){let e=t.parentElement;for(;e&&!i;){if(i=e.querySelector('input[type="radio"][data-go-to]'),i){console.log("[FormLib] Found radio input in parent element",{parent:e});break}if(e=e.parentElement,"FORM"===e?.tagName||"BODY"===e?.tagName)break}}if(!i){const e=t.closest("label");e&&(i=e.querySelector('input[type="radio"][data-go-to]'),i&&console.log("[FormLib] Found radio input in closest label"))}if(!i){console.log("[FormLib] No radio input with data-go-to found after exhaustive search");const e=t.querySelector('input[type="radio"]')||t.closest("label")?.querySelector('input[type="radio"]');return void(e&&console.log("[FormLib] Found radio without data-go-to:",{radio:e,attributes:Array.from(e.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}))}const n=$(i,"data-go-to");console.log("[FormLib] Successfully found radio input",{radioInput:i,goTo:n,name:i.name,value:i.value,checked:i.checked}),e.preventDefault(),e.stopPropagation(),i.checked=!0,V(i);const a=new Event("change",{bubbles:!0});Object.defineProperty(a,"target",{value:i}),console.log("[FormLib] Triggering branch logic for data-go-to:",n),P(a,i)}function _(t,i){if("Enter"!==t.key&&" "!==t.key)return;console.log("[FormLib] Radio keyboard event",{key:t.key,target:i}),t.preventDefault();q(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:e}),i)}function P(e,t){if(console.log("[FormLib] handleBranchTrigger called",{target:t,tagName:t.tagName,type:t.type,isFormInput:I(t)}),!I(t))return void console.log("[FormLib] Target is not a form input, ignoring");const i=$(t,"data-go-to"),n=A(t);console.log("[FormLib] Branch trigger activated",{element:t,goTo:i,value:n,type:t.type||t.tagName,checked:t.checked,name:t.name,allAttributes:Array.from(t.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")});const a=t.name||$(t,"data-step-field-name");var o;a&&C.setField(a,n),t instanceof HTMLInputElement?"radio"===t.type&&t.checked?(function(e){if(!e.name)return;b(`Handling radio group selection for: ${e.name}`,{selectedValue:e.value,selectedGoTo:$(e,"data-go-to")});document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(t=>{const i=t,n=$(i,"data-go-to");i!==e&&n&&(b(`Deactivating radio option: ${n}`),B(n),n&&z(n))})}(t),V(t),D(i,t.value),i&&(b(`Triggering step_item visibility: ${o=i}`),function(e){try{const t=document.querySelector(`[data-answer="${e}"]`);if(!t)return void console.warn(`[FormLib] Step_item not found: ${e}`);t.style.display="",t.style.visibility="visible",t.style.opacity="1",t.classList.remove("hidden-step","hidden-step-item"),t.classList.contains("step_item")&&t.classList.add("visible-step-item"),C.setStepInfo(e,{visible:!0}),b(`Successfully showed step_item: ${e}`,{display:t.style.display,visibility:t.style.visibility,opacity:t.style.opacity,isStepItem:t.classList.contains("step_item"),classes:t.className})}catch(e){console.warn("[FormLib] Failed to show step_item:",e)}}(o))):"checkbox"===t.type?t.checked?D(i,t.value):B(i):"radio"!==t.type&&"checkbox"!==t.type&&(n?D(i,n):B(i)):n?D(i,n):B(i);const s=C.getBranchPath().activeConditions;Object.values(s).some(e=>null!=e&&""!==e)&&M()}function V(e){const t=$(e,"fs-inputactive-class")||"is-active-inputactive";if(e.name){document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(i=>{const n=i,a=n.closest("label");n!==e&&(n.classList.remove(t),a&&a.classList.remove(t))})}e.classList.add(t);const i=e.closest("label");i&&i.classList.add(t),b(`Applied active class to radio button: ${e.name}`,{activeClass:t,radioClasses:e.className,labelClasses:i?.className})}function z(e){b(`Hiding step_item: ${e}`),import("./multiStep.js").then(({hideStepItem:t})=>{t&&t(e)}).catch(t=>{b(`Manual step_item hiding for: ${e}`);document.querySelectorAll(`[data-answer="${e}"]`).forEach(e=>{const t=e;t.style.display="none",t.style.visibility="hidden",t.classList.add("hidden-step")})})}function D(e,t){e&&(b(`Activating branch: ${e}`,{value:t,valueType:typeof t,targetString:String(e)}),C.setActiveCondition(e,t),function(){const e=v(n),t=[],i=[];e.forEach(e=>{const n=$(e,"data-answer"),a=!n||C.isStepVisible(n);e.querySelectorAll("input, select, textarea").forEach(e=>{const n=e.name||$(e,"data-step-field-name");n&&(a?t.push(n):i.push(n))})});const a=i.filter(e=>!t.includes(e));a.length>0&&C.clearFields(a)}(),b("Active conditions after branch activation",{activeConditions:C.getBranchPath().activeConditions}))}function B(e){e&&(b(`Deactivating branch: ${e}`),C.setActiveCondition(e,null),function(e){const t=S(`[data-answer="${e}"]`);if(!t)return;const i=t.querySelectorAll("input, select, textarea"),n=[];i.forEach(e=>{const t=e.name||$(e,"data-step-field-name");t&&n.push(t)}),n.length>0&&(C.clearFields(n),b(`Cleared fields from branch ${e}`,n))}(e),M())}function M(){const e=v(a),t=C.getBranchPath().activeConditions;b("Updating step visibility",{activeConditions:t}),e.forEach(e=>{const i=$(e,"data-answer"),n=function(e,t){if(!e)return!0;for(const[i,n]of Object.entries(t))if(i===e&&null!=n&&""!==n)return!0;return!1}(i,t);i&&C.setStepInfo(i,{visible:n});const a=e;n?(a.style.display="",a.classList.remove("hidden-step"),b(`Step made visible: ${i}`)):(a.style.display="none",a.classList.add("hidden-step"),b(`Step hidden: ${i}`))})}function O(){b("Resetting branching logic"),x.forEach(e=>e()),x=[];const e=C.getBranchPath().activeConditions;Object.keys(e).forEach(e=>{C.setActiveCondition(e,null)});v(a).forEach(e=>{const t=e;t.style.display="none",t.classList.add("hidden-step")}),k=!1,b("Branching reset complete")}e.debugRadioButtons=function(){console.log("=== DEBUG: Radio Button Detection ===");const e=document.querySelectorAll('input[type="radio"][data-go-to]');console.log(`Found ${e.length} radio buttons with data-go-to:`),e.forEach((e,t)=>{const i=e,n=$(e,"data-go-to"),a=e.closest("label");console.log(`Radio ${t}:`,{element:e,name:i.name,value:i.value,goTo:n,checked:i.checked,parentLabel:a,parentLabelClasses:a?.className,style:i.style.cssText,allAttributes:Array.from(e.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")})});const t=document.querySelectorAll("label.radio_field, label.w-radio");console.log(`Found ${t.length} radio labels:`),t.forEach((e,t)=>{const i=e.querySelector('input[type="radio"]'),n=i?$(i,"data-go-to"):null;console.log(`Label ${t}:`,{element:e,className:e.className,radioInside:i,goTo:n,radioName:i?i.name:null})}),console.log("=== END DEBUG ===")},e.testRadioClick=function(e){console.log(`=== TESTING: Manual radio click for ${e} ===`);const t=document.querySelector(`input[type="radio"][data-go-to="${e}"]`);if(!t)return void console.error(`Radio button with data-go-to="${e}" not found`);console.log("Found radio button:",t),t.checked=!0,V(t);const i=new Event("change",{bubbles:!0}),n=new Event("click",{bubbles:!0});console.log("Dispatching events..."),t.dispatchEvent(n),t.dispatchEvent(i),console.log("Manually triggering branch logic..."),P(0,t),console.log("=== END TEST ===")},e.debugBranching=function(){const e=C.getBranchPath().activeConditions;b("=== DEBUG: Branching State ==="),b("Active Conditions:",e);const t=v(d);b("All Branch Triggers:"),t.forEach((e,t)=>{const i=$(e,"data-go-to");let n="",a=!1,o=e.tagName;if(I(e)){const t=A(e);n=Array.isArray(t)?t.join(", "):t,e instanceof HTMLInputElement&&(a=e.checked,o=e.type)}b(`Trigger ${t}:`,{element:e,goTo:i,value:n,checked:a,type:o})});const i=v(a);b("All Answer Steps:"),i.forEach((e,t)=>{b(`Answer Step ${t}:`,{element:e,dataAnswer:$(e,"data-answer"),visible:"none"!==e.style.display})}),b("=== END DEBUG ===")};let j=!1,R=[],U=[],H=[],G=0,Y=null;function J(e=document){j&&(b("MultiStep already multiStepInitialized, cleaning up first"),b("Resetting multi-step navigation"),R.forEach(e=>e()),R=[],U.forEach((e,t)=>{oe(t)}),U=[],G=0,j=!1,b("Multi-step reset complete")),b("Initializing multi-step navigation with step/step_item architecture");const t=v(n,e);b(`Found ${t.length} parent steps`),U=Array.from(t).map((e,t)=>{const i=e,n=$(e,"data-answer"),a=n||`step-${t}`,o={element:i,id:a,index:t,type:$(e,"data-step-type")||void 0,subtype:$(e,"data-step-subtype")||void 0,number:$(e,"data-step-number")||void 0,isStepItem:!1};return b(`Registering parent step ${t}`,{stepId:a,dataAnswer:n,type:o.type,element:i}),C.setStepInfo(a,{type:o.type,subtype:o.subtype,number:o.number,visible:0===t,visited:!1}),o}),H=[],U.forEach((e,t)=>{const i=e.element.querySelectorAll(".step_item, .step-item");console.log(`[FormLib] Found ${i.length} step_items in parent step ${t} (${e.id})`),i.forEach((i,n)=>{const a=i,o=$(i,"data-answer"),s=$(i,"data-go-to");if(console.log(`[FormLib] Processing step_item ${n}:`,{dataAnswer:o,dataGoTo:s,parentStepId:e.id,parentStepIndex:t,element:a,allAttributes:Array.from(a.attributes).map(e=>`${e.name}="${e.value}"`).join(" ")}),!o)return void console.warn(`[FormLib] Step item ${n} in parent step ${t} missing required data-answer attribute`);const r={element:a,id:o,index:H.length,type:$(i,"data-step-type")||void 0,subtype:$(i,"data-step-subtype")||void 0,number:$(i,"data-step-number")||void 0,isStepItem:!0,parentStepIndex:t};console.log("[FormLib] Registered step_item:",{stepId:o,parentStepIndex:t,globalIndex:H.length,type:r.type,element:a}),C.setStepInfo(o,{type:r.type,subtype:r.subtype,number:r.number,visible:!1,visited:!1}),H.push(r)})}),U.forEach((e,t)=>{K(e.element,`parent step ${t}`)}),H.forEach((e,t)=>{K(e.element,`step_item ${t} (${e.id})`)}),function(e){const t=w(e,"click",o,Z),i=w(e,"click",s,ee),n=w(e,"click",l,te),a=w(e,"click",r,ie);R.push(t,i,n,a)}(e),U.length>0&&ae(0),j=!0,b("Multi-step initialization complete",{parentStepCount:U.length,stepItemCount:H.length})}function K(e,t){const i=t.includes("step_item");i?(e.style.display="none !important",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden",e.style.position="absolute",e.style.left="-9999px",F(e,f)):(e.style.display="none",e.style.visibility="hidden"),F(e,"hidden-step"),E(e,m),e.setAttribute("data-step-hidden","true"),console.log(`[FormLib] Hiding ${t}:`,{display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity,isStepItem:i,classes:e.className,dataAnswer:$(e,"data-answer")})}function W(e,t){e.style.display="",e.style.visibility="",e.style.opacity="",e.style.height="",e.style.overflow="",e.style.position="",e.style.left="",E(e,"hidden-step"),E(e,f),F(e,m),e.removeAttribute("data-step-hidden"),console.log(`[FormLib] Showing ${t}:`,{display:e.style.display,visibility:e.style.visibility,classes:e.className,dataAnswer:$(e,"data-answer")})}function X(e,t=!0){const i=$(e,"data-step-subtype");if(!i)return;console.log(`[FormLib] ${t?"Enabling":"Disabling"} required fields for subtype: ${i}`);e.querySelectorAll("[data-require-for-subtypes]").forEach(e=>{const n=e.getAttribute("data-require-for-subtypes"),a=e;n&&n.split(",").map(e=>e.trim()).includes(i)&&(t?(a.required=!0,a.disabled=!1,console.log(`[FormLib] Enabled required field: ${a.name||a.id} for subtype: ${i}`)):(a.required=!1,a.disabled=!0,a.value="",console.log(`[FormLib] Disabled required field: ${a.name||a.id} for subtype: ${i}`)))})}function Q(e){console.log(`[FormLib] Attempting to show step_item: ${e}`),console.log("[FormLib] Available step_items:",H.map(e=>({id:e.id,dataAnswer:$(e.element,"data-answer"),element:e.element})));const t=H.find(t=>t.id===e);if(!t){console.warn(`[FormLib] Step item not found: ${e}`),console.log(`[FormLib] Looking for step_item with data-answer="${e}"`);const t=H.find(t=>$(t.element,"data-answer")===e);return t?(console.log(`[FormLib] Found step_item by data-answer: ${e}`,t),Q(t.id)):void 0}if(!U[t.parentStepIndex])return void console.warn(`[FormLib] Parent step not found for step_item: ${e}`);b(`Showing step_item ${e} in parent step ${t.parentStepIndex}`),console.log(`[FormLib] Hiding all step_items in parent step ${t.parentStepIndex}`);const i=H.filter(e=>e.parentStepIndex===t.parentStepIndex);console.log(`[FormLib] Found ${i.length} step_items to hide in parent step`),i.forEach(e=>{console.log(`[FormLib] Hiding step_item: ${e.id} (data-answer="${$(e.element,"data-answer")}")`),K(e.element,`step_item ${e.id}`),X(e.element,!1),C.setStepVisibility(e.id,!1)}),console.log(`[FormLib] Now showing target step_item: ${e}`),W(t.element,`step_item ${e}`),X(t.element,!0),C.setStepVisibility(e,!0),Y=e,console.log(`[FormLib] Successfully showed step_item: ${e}`,{currentStepItemId:Y,visibleStepItems:i.filter(t=>t.id===e).length})}function z(e){b(`Attempting to hide step_item: ${e}`);const t=H.find(t=>t.id===e);t?(b(`Hiding step_item: ${e}`),K(t.element,`step_item ${e}`),X(t.element,!1),C.setStepVisibility(e,!1),Y===e&&(Y=null),b(`Successfully hid step_item: ${e}`)):b(`Step item not found for hiding: ${e}`)}function Z(e,t){e.preventDefault(),b("Next button clicked");const i=re();if(!i)return;if(Y){const e=H.find(e=>e.id===Y);if(e&&!ne(e.element))return void b("Step item validation failed, staying on current step")}else if(!ne(i.element))return void b("Step validation failed, staying on current step");let n=null;if(Y){const e=H.find(e=>e.id===Y);e&&(n=$(e.element,"data-go-to"),b(`Step item ${Y} has data-go-to: ${n}`))}n||(n=function(e){const t=C.getBranchPath().activeConditions;b("Evaluating next step",{currentStep:e,activeConditions:t});for(const[e,i]of Object.entries(t))if(null!=i&&""!==i)return b(`Next step determined by branch: ${e}`),e;return b("No active branch conditions, using sequential navigation"),null}(i.id),b(`Branching logic determined next step: ${n}`)),n?function(e){b(`Attempting to navigate to step: ${e}`);const t=se(e);if(-1!==t)return b(`Found parent step: ${e} at index ${t}`),Y=null,void ae(t);const i=H.find(t=>t.id===e);if(i)return b(`Found step_item: ${e} in parent step ${i.parentStepIndex}`),void(void 0!==i.parentStepIndex&&(ae(i.parentStepIndex),Q(e)));console.warn(`[FormLib] Step not found: ${e}`),b("Step not found",{targetStepId:e,availableParentSteps:U.map(e=>e.id),availableStepItems:H.map(e=>e.id)})}(n):function(){const e=G+1;e<U.length?ae(e):b("Already at last step")}()}function ee(e,t){e.preventDefault(),b("Back button clicked"),function(){const e=C.goToPreviousStep();if(e){const t=se(e);if(-1!==t)return void ae(t)}const t=G-1;t>=0?ae(t):b("Already at first step")}()}function te(e,t){e.preventDefault();const i=$(t,"data-skip");if(b("Skip button clicked",{skipTarget:i}),i){const e=se(i);if(-1!==e){for(let t=G+1;t<e;t++)C.addSkippedStep(U[t].id);ae(e)}else b(`Skip target step not found: ${i}`)}}function ie(e,t){b("Submit button clicked");if(!function(){let e=!0;return U.forEach((t,i)=>{if(C.isStepVisible(t.id)){const i=t.element.querySelectorAll("[required]");for(const n of i){const i=n;i.value.trim()||(b(`Required field empty in step ${t.id}: ${i.name||"unnamed"}`),e=!1)}}}),e}())return e.preventDefault(),void b("Form validation failed, preventing submission");b("Form validation passed, allowing submission")}function ne(e){const t=e.querySelectorAll("input[required], select[required], textarea[required]");for(const e of t){const t=e;if(L(t)){if(!t.value||""===t.value.trim())return b("Validation failed: empty required field",{element:t,name:t.name,id:t.id}),t.focus(),!1;if("email"===t.type&&t.value){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value))return b("Validation failed: invalid email format",{element:t,value:t.value}),t.focus(),!1}}}return!0}function ae(e){if(e<0||e>=U.length)return void b(`Invalid step index: ${e}`);const t=G,i=U[e];b(`Navigating to step ${e}`,{from:t,to:e,stepId:i.id}),U[G]&&oe(G),G=e,function(e){if(e<0||e>=U.length)return;const t=U[e],i=t.element;W(i,`parent step ${e} (${t.id})`),C.setStepInfo(t.id,{visible:!0,visited:!0});const n=H.filter(t=>t.parentStepIndex===e);n.forEach(e=>{K(e.element,`step_item ${e.id} (keeping hidden on parent step show)`),C.setStepVisibility(e.id,!1)}),b(`Step shown: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className,stepItemsHidden:n.length})}(e),C.setCurrentStep(i.id),function(){const e=v(s),t=v(o),i=v(r);e.forEach(e=>{const t=e;0===G?(t.disabled=!0,F(e,y)):(t.disabled=!1,E(e,y))});const n=G===U.length-1;t.forEach(e=>{const t=e;n?t.style.display="none":(t.style.display="",t.disabled=!1,E(e,y))}),i.forEach(e=>{const t=e;n?(t.style.display="",t.disabled=!1,E(e,y)):t.style.display="none"}),b("Navigation buttons updated",{currentStepIndex:G,isLastStep:n,backButtonsCount:e.length,nextButtonsCount:t.length,submitButtonsCount:i.length})}(),b("Step navigation complete",{currentStep:i.id,currentIndex:e})}function oe(e){if(e<0||e>=U.length)return;const t=U[e],i=t.element;K(i,`parent step ${e} (${t.id})`),C.setStepInfo(t.id,{visible:!1}),b(`Step hidden: ${t.id} (index: ${e})`,{display:i.style.display,visibility:i.style.visibility,classes:i.className})}function se(e){return U.findIndex(t=>t.id===e)}function re(){return U[G]||null}e.debugFormSteps=function(){b("=== DEBUG: All Registered Steps ==="),U.forEach((e,t)=>{const i=e.element;b(`Step ${t}:`,{stepId:e.id,dataAnswer:i.getAttribute("data-answer"),elementId:i.getAttribute("id"),index:e.index,visible:"none"!==i.style.display,classes:i.className,element:i})}),b("=== END DEBUG ===")};let le=!1,de=[],ce=new Map;function ue(e=document){le&&(b("Validation already validationInitialized, cleaning up first"),b("Resetting validation"),de.forEach(e=>e()),de=[],b("Clearing all field validation"),ce.forEach((e,t)=>{!function(e){const t=ce.get(e);t&&(t.isValid=!0,t.errorMessage=void 0,ge(t.element,!0),b(`Cleared validation for field: ${e}`))}(t)}),ce.clear(),le=!1,b("Validation reset complete")),b("Initializing form validation");const t=v("input, select, textarea",e);b(`Found ${t.length} form inputs`),t.forEach(e=>{if(!I(e))return;const t=e,i=t.name||$(e,"data-step-field-name");if(!i)return void b("Skipping field validation setup - no field name",{element:e,name:t.name,dataStepFieldName:$(e,"data-step-field-name"),id:t.id,type:t.type});const n=function(e){const t=[];e.hasAttribute("required")&&t.push({type:"required",message:$(e,"data-error-message")||"This field is required"}),e instanceof HTMLInputElement&&"email"===e.type&&t.push({type:"email",message:"Please enter a valid email address"}),e instanceof HTMLInputElement&&"tel"===e.type&&t.push({type:"phone",message:"Please enter a valid phone number"});const i=$(e,"minlength");i&&t.push({type:"min",value:parseInt(i),message:`Minimum ${i} characters required`});const n=$(e,"maxlength");n&&t.push({type:"max",value:parseInt(n),message:`Maximum ${n} characters allowed`});const a=$(e,"pattern");return a&&t.push({type:"pattern",value:new RegExp(a),message:"Please enter a valid format"}),t}(e);0!==n.length?(ce.set(i,{element:e,rules:n,isValid:!0}),b(`Validation rules set for field: ${i}`,{rules:n.map(e=>e.type),rulesCount:n.length})):b(`No validation rules found for field: ${i}`)}),function(e){const t=function(e,t){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>e(...n),t)}}(pe,p.VALIDATION_DELAY),i=w(e,"input","input, select, textarea",t),n=w(e,"blur","input, select, textarea",pe),a=w(e,"change","input, select, textarea",pe);de.push(i,n,a)}(e),le=!0,b("Validation initialization complete")}function pe(e,t){if(!I(t))return;const i=t,a=i.name||$(t,"data-step-field-name");if(!a)return void b("Skipping validation - no field name found",{element:t,name:i.name,dataStepFieldName:$(t,"data-step-field-name")});const o=t.closest(n);if(o){const e=$(o,"data-answer");if(e&&!C.isStepVisible(e))return void b(`Skipping validation for field in hidden step: ${a}`)}me(a)}function me(e){const t=ce.get(e);if(!t)return b(`No validation rules found for field: ${e}`),!0;const i=t.element;if(!i)return b(`No element found for field: ${e}`),!0;const n=A(i);b(`Validating field: ${e}`,{value:n,elementExists:!!i});let a=!0,o="";for(const e of t.rules){const t=fe(n,e);if(!t.isValid){a=!1,o=t.message||"Validation failed";break}}t.isValid=a,t.errorMessage=o;try{ge(i,a,o)}catch(t){b(`Error updating visual state for field: ${e}`,t)}return C.setField(e,n),b(`Field validation result: ${e}`,{isValid:a,errorMessage:o,value:n}),a}function fe(e,t){switch(t.type){case"required":return{isValid:!(""===e||null==e||Array.isArray(e)&&0===e.length),message:t.message};case"email":return{isValid:!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e)),message:t.message};case"phone":return{isValid:!e||/^[\+]?[1-9][\d]{0,15}$/.test(String(e).replace(/\D/g,"")),message:t.message};case"min":return{isValid:!e||String(e).length>=t.value,message:t.message};case"max":return{isValid:!e||String(e).length<=t.value,message:t.message};case"pattern":return{isValid:!e||t.value.test(String(e)),message:t.message};case"custom":return{isValid:!t.validator||t.validator(e),message:t.message};default:return{isValid:!0}}}function ge(e,t,i){t?E(e,g):F(e,g);const n=he(e);n&&(t?(n.textContent="",n.style.display="none"):(n.textContent=i||"Validation failed",n.style.display="block"))}function he(e){if(!e)return b("Cannot create error element - no input element provided"),null;const t=e.name||$(e,"data-step-field-name");if(!t)return b("Cannot create error element - no field name found",{element:e,name:e.name,dataStepFieldName:$(e,"data-step-field-name")}),null;if(!e.parentElement)return b(`Cannot create error element for field: ${t} - no parent element`,{element:e,parentElement:e.parentElement,nodeName:e.nodeName,id:e.id}),null;let i=null;try{i=e.parentElement.querySelector(`.${h}[data-field="${t}"]`)}catch(e){return b(`Error finding existing error element for field: ${t}`,e),null}if(!i)try{i=document.createElement("div"),i.className=h,i.setAttribute("data-field",t),i.style.color="red",i.style.fontSize="0.875em",i.style.marginTop="0.25rem",i.style.display="none";const n=e.nextSibling;n?e.parentElement.insertBefore(i,n):e.parentElement.appendChild(i),b(`Created error element for field: ${t}`)}catch(e){return b(`Error creating error element for field: ${t}`,e),null}return i}function ye(){const e={validationInitialized:le,totalFields:ce.size,validFields:0,invalidFields:0,fields:{}};return ce.forEach((t,i)=>{e.fields[i]={isValid:t.isValid,errorMessage:t.errorMessage,rulesCount:t.rules.length},t.isValid?e.validFields++:e.invalidFields++}),e}let be=new Map;function ve(){b("Clearing all field errors"),be.forEach((e,t)=>{!function(e){const t=be.get(e);t?(b(`Clearing error for field: ${e}`),E(t.element,g),t.errorElement&&(t.errorElement.textContent="",t.errorElement.style.display="none")):b(`Cannot clear error for unknown field: ${e}`)}(t)})}function Se(){const e=[];return be.forEach((t,i)=>{(function(e){const t=be.get(e);return!!t&&t.element.classList.contains(g)})(i)&&e.push(i)}),e}function he(e){if(!e||!e.element)return b("Cannot create error element - no config or element provided"),null;if(!e.element.parentElement)return b(`Cannot create error element for field: ${e.fieldName} - no parent element`,{element:e.element,parentElement:e.element.parentElement,nodeName:e.element.nodeName,id:e.element.id}),null;let t=null;try{t=e.element.parentElement.querySelector(`.${h}[data-field="${e.fieldName}"]`)}catch(t){return b(`Error finding existing error element for field: ${e.fieldName}`,t),null}if(!t)try{t=document.createElement("div"),t.className=h,t.setAttribute("data-field",e.fieldName),t.style.color="red",t.style.fontSize="0.875em",t.style.marginTop="0.25rem",t.style.display="none";const i=e.element.parentElement,n=e.element.nextSibling;n?i.insertBefore(t,n):i.appendChild(t),b(`Created error element for field: ${e.fieldName}`)}catch(t){return b(`Error creating error element for field: ${e.fieldName}`,t),null}return t}function $e(){const e=Se(),t={totalFields:be.size,fieldsWithErrors:e.length,errors:{}};return e.forEach(e=>{const i=be.get(e);t.errors[e]={message:i?.errorElement?.textContent||"Unknown error",customMessage:i?.customMessage}}),t}let Fe=!1,Ee=[],Le=[];function Ie(e=document){Fe&&(b("Summary already summaryInitialized, cleaning up first"),b("Resetting summary functionality"),Ee.forEach(e=>e()),Ee=[],Le.forEach(e=>{ke(e.element,"")}),Le=[],Fe=!1,b("Summary reset complete")),b("Initializing summary functionality");const t=v(u,e);b(`Found ${t.length} summary fields`),function(e){e.forEach(e=>{const t=$(e,"data-summary-field");if(!t)return;const i=t.split("|").map(e=>e.trim()),n=$(e,"data-join"),a=n&&n in p.JOIN_SEPARATOR?n:"space",o=$(e,"data-summary-type")||void 0,s=$(e,"data-summary-subtype")||void 0,r=$(e,"data-summary-number")||void 0,l={element:e,fieldNames:i,joinType:a,type:o,subtype:s,number:r};Le.push(l),b("Summary field configured",{fieldNames:i,joinType:a,type:o,subtype:s,number:r})})}(t),function(e){const t=w(e,"input",c,Ae),i=w(e,"change",c,Ae),n=w(e,"blur",c,Ae);Ee.push(t,i,n)}(e),Ne(),Fe=!0,b("Summary initialization complete")}function Ae(e,t){if(!I(t))return;const i=$(t,"data-step-field-name");if(!i)return;const n=A(t);b(`Summary field changed: ${i}`,{value:n}),C.setField(i,n),we(i)}function we(e){Le.forEach(t=>{t.fieldNames.includes(e)&&Ce(t)})}function Ne(){Le.forEach(e=>{Ce(e)})}function Ce(e){const t=[];e.fieldNames.forEach(e=>{const i=C.getField(e);null!=i&&""!==i&&(Array.isArray(i)?t.push(...i.filter(e=>""!==e)):t.push(String(i)))});const i=function(e,t){if(0===e.length)return"";const i=p.JOIN_SEPARATOR[t];return e.join(i)}(t,e.joinType);ke(e.element,i),b("Summary field updated",{fieldNames:e.fieldNames,values:t,joinType:e.joinType,result:i})}function ke(e,t){e.textContent=t,""===t?(e.classList.add("summary-empty"),e.classList.remove("summary-filled")):(e.classList.remove("summary-empty"),e.classList.add("summary-filled"))}class xe{constructor(){this.initialized=!1,this.rootElement=document,b("FormLibrary instance created")}static getInstance(){return xe.instance||(xe.instance=new xe),xe.instance}init(e=document){this.initialized&&(b("FormLibrary already initialized, reinitializing..."),this.destroy()),this.rootElement=e,b("Initializing FormLibrary",{root:e===document?"document":"custom element"});const a=e.querySelectorAll(t),o=e.querySelectorAll(i),s=e.querySelectorAll(n);if(b("Form detection results",{multistepForms:a.length,logicForms:o.length,stepElements:s.length}),0!==a.length||0!==s.length)try{!function(e=document){b("Initializing error handling"),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name||$(e,"data-step-field-name");t&&be.set(t,{fieldName:t,element:e,customMessage:$(e,"data-error-message")||void 0})}),b(`Error handling errorsInitialized for ${be.size} fields`)}(e),ue(e),o.length>0&&T(e),(a.length>0||s.length>0)&&J(e),Ie(e),this.initialized=!0,b("FormLibrary initialization complete"),this.logCurrentState()}catch(e){throw b("FormLibrary initialization failed",e),e}else b("No compatible forms found, library will not initialize")}destroy(){if(this.initialized){b("Destroying FormLibrary");try{O()}catch(e){b("Error during FormLibrary destruction",e)}C.clear(),this.initialized=!1,b("FormLibrary destruction complete")}else b("FormLibrary not initialized, nothing to destroy")}isInitialized(){return this.initialized}getState(){return{initialized:this.initialized,formState:C.getDebugInfo(),branching:{branchingInitialized:k,activeConditions:C.getBranchPath().activeConditions,visibleSteps:Object.entries(C.getAllSteps()).filter(([e,t])=>t.visible).map(([e,t])=>e)},multiStep:{multiStepInitialized:j,currentStepIndex:G,totalSteps:U.length,steps:U.map(e=>({id:e.id,index:e.index,visible:L(e.element),type:e.type,subtype:e.subtype,number:e.number}))},validation:ye(),errors:$e(),summary:{summaryInitialized:Fe,totalSummaryFields:Le.length,summaryFields:Le.map(e=>({fieldNames:e.fieldNames,joinType:e.joinType,type:e.type,subtype:e.subtype,number:e.number,currentValue:e.element.textContent||""})),formStateData:C.getAll()}}}logCurrentState(){b("Current FormLibrary State",this.getState())}validateForm(){if(!this.initialized)return b("Cannot validate form - library not initialized"),!1;b("Validating entire form");const e=function(){b("Validating all visible fields");let e=!0;const t={};for(const[i,a]of ce){const o=a.element.closest(n);let s=!0;if(o){const e=$(o,"data-answer");e&&!C.isStepVisible(e)&&(s=!1)}if(s){const n=me(i);t[i]=n,n||(e=!1)}}return b("All visible fields validation complete",{allValid:e,results:t}),e}();return b("Form validation result",{isValid:e}),e}resetForm(){if(this.initialized){var e;b("Resetting form to initial state"),ve(),C.clear(),e?(b("Clearing specific summary fields",e),C.clearFields(e),e.forEach(e=>{we(e)})):(b("Clearing all summaries"),C.clear(),Ne());try{ae(0)}catch(e){b("Could not go to first step during reset",e)}b("Form reset complete")}else b("Cannot reset form - library not initialized")}getFormData(){return C.getAll()}setFormData(e){Object.entries(e).forEach(([e,t])=>{C.setField(e,t)}),b("Updating all summaries"),Ne(),b("Form data set",e)}}const Te=xe.getInstance();if(void 0!==e){const e=()=>{const e=document.querySelectorAll(t),i=document.querySelectorAll(n);(e.length>0||i.length>0)&&(b("Auto-initializing FormLibrary on DOM ready"),Te.init())};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}void 0!==e&&(e.FormLib=Te,b("FormLib attached to window for debugging")),void 0!==e&&(e.FormLibrary=xe,e.FormLib=Te)}("undefined"!=typeof window?window:this);